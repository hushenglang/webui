var FocusManage={dialogFocus:function(a,b){$(b).hide();$(a).dialog("open");$(b).show()}};$(function(){function a(d,g){var f=document.getElementsByTagName("link");for(var e=0;e<f.length;e++){if(f[e]&&f[e].href!=null&&f[e].href.indexOf(d)!=-1){var h=document.createElement("link");h.setAttribute("rel","stylesheet");h.setAttribute("type","text/css");h.setAttribute("href",f[e].href.replace(d,g));f[e].parentNode.replaceChild(h,f[e]);break}}}function c(){$("#btn_tab_div_back").hide();if(jq_ui_isMobile){$("#btn_menu_investment").parent("li").show();$("#index_tab_div").append($("#index_investment_div"));$("#index_connect_tip").hide()}else{$("#btn_menu_investment").parent("li").hide();$("#index_investment_div").show()}}function b(){var d=$("#investment-entrust-fl li[class='on-na']");if(d.length>0){$(".dataTables_scrollHeadInner",$("#investment-entrust-cont")).width("100%");$("#"+d.attr("tn")).width("100%");$("#"+d.attr("tn")).dataTable().fnAdjustColumnSizing()}}$("#menu-layer").click(function(){$(".menu-tan-box").toggle()});document.onclick=function(f){var f=f?f:window.event;var d=f.srcElement||f.target;if($(d).parents("#footer").length==0){$(".menu-tan-box").hide()}};$("#btn_menu_online_01,#btn_menu_online_02,#btn_box_online").on("click",function(){var d="http://www.onlineservice-hk.com/k800/chatClient/chatbox.jsp?companyID=209&enterurl=http%3A%2F%2Fwww%2E24k%2Ehk%2Findex%2Ehtml&tm=1346658342836";window.open(d,"Live800Chatindow","height=520,width=740,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")});$("#btn_menu_qq_01,#btn_menu_qq_02,#btn_box_qq").on("click",function(){window.open("http://crm2.qq.com/page/portalpage/wpa.php?uin=800018282&cref=&ref=&f=1&ty=1&ap=&as=","_blank","height=544, width=644,toolbar=no,scrollbars=no,menubar=no,status=no")});$("#btn_menu_logout_btn_01,#btn_menu_logout_btn_02").on("click",function(){$(".menu-tan-box").hide();$("#div_logout_confirm").dialog({closeOnEscape:false,resizable:false,minWidth:300,modal:true});$(".ui-dialog-titlebar-close",$("#div_logout_confirm").parent()).hide();$("#btn_logout_confirm").click(function(){location.href=Global.contextPath+"/LogOff.action?t="+new Date().getTime();return true});$("#btn_logout_cancel").click(function(){$("#div_logout_confirm").dialog("close")})});c();$("#btn_menu_index_home").on("click",function(){$("#index_tab_div").hide();$("#wrapper").show()});$("#footer ul li a[id^=btn_menu_][tn^=index_]").on("click",function(){$(".menu-tan-box").hide();var e="#"+$(this).attr("tn");var d=document.documentElement.clientHeight-($(".top-menubox").height()+$(".menu-box-con").height()+5);$("#index_tab_div").children("div").not(".top-menubox").not(e).hide();$("#tab_div_title").html($(this).text());$("#index_tab_div").show();$("#wrapper").hide();$(e).height(d).show();if("btn_menu_chart"==this.id&&$(e).attr("fc")=="f"){WebUiChart.init();$(e).attr("fc","t")}else{if("btn_menu_new_01"==this.id||"btn_menu_new_02"==this.id){news.conNewsSocket()}else{if("btn_menu_report_01"==this.id){Report.init()}else{if("btn_menu_investment"==this.id){b()}}}}});$("#btn_tab_div_back").on("click",function(){$("#btn_tab_div_back,#news_content").hide();$("#newsList").show()});$("#tab_back_home").on("click",function(){$("#index_tab_div").hide();$("#wrapper").show();b()});$(window).resize(function(){b()});$("#btn_menu_style_change_01,#btn_menu_style_change_02").on("click",function(){$(".menu-tan-box").hide();var d=$("#footer div ul li a[id^=btn_menu_style_change_0]");if($(this).attr("tn")=="night"){d.html("<i></i>"+i18n.nightcss);d.attr("tn","day");a("index-night.css","index.css");a("stx-demo-theme-2.css","stx-demo-theme-1.css");SystemCookie.setDayNight("day")}else{d.html("<i></i>"+i18n.daycss);d.attr("tn","night");a("index.css","index-night.css");a("stx-demo-theme-1.css","stx-demo-theme-2.css");SystemCookie.setDayNight("night")}});if("night"==SystemCookie.getDayNight()){$("#btn_menu_style_change_01").attr("tn","day");$("#btn_menu_style_change_01").click()}$("#btn_menu_language_01,#btn_menu_language_02").on("click",function(){$("#index_lang").val($(this).attr("tn"));document.getElementById("adminForm").submit()});$("#btn_menu_full_ver_01,#btn_menu_full_ver_02").on("click",function(){$("#index_version").val("dt");document.getElementById("adminForm").submit()})});var news={currSocket:null,currTitle:"",titleData:null,totalRows:null,init:function(){news.setSocket()},conNewsSocket:function(){if(news.currSocket){if(!news.currSocket.socket.connected){console.log("currSocket reconnect......");news.setSocket();setTimeout(function(){},2000)}setTimeout(function(){news.currSocket.emit("request",Constant.CMD_GET_NEWS_BY_PAGE,{page:0,language:newsLanguageValue()})},1000)}},setSocket:function(){$.ajax({type:"post",url:"InitGoldMain.action",dataType:"json",async:false,error:function(b,a,c){console.log(i18n.readDateError+":"+c.message)},success:function(a){var b=a.initConfig;if(!b){location.href="LogOff.action"}if(b.flag=="error"){location.href="LogOff.action"}news.currSocket=$.createSocket("news",b.newsUrl);$.listenSocket(news.currSocket);news.currSocket.listeners.$add({AccLogin:function(c,d){if(c.code!=0){if(debugui){alert("news mb 73: AccLogin error")}news.currSocket.disconnect()}}});news.currSocket.listeners.$add({loginR:function(c){console.log("news loginR",c)}});news.currSocket.listeners.$add({connect:function(){console.log("B connected");try{news.currSocket.emit("addme",b.loginname,b.pwd)}catch(c){console.log(i18n.connectionFail+"："+c)}}});news.currSocket.listeners.$add({reconnect:function(){console.log("news reconnect")}});news.currSocket.listeners.$add({disconnect:function(){console.log("news disconnect")}});news.currSocket.listeners.$add({OtherLogin:function(){console.log("news OtherLogin");if(news.currSocket){news.currSocket.disconnect();news.currSocket=null}}});news.currSocket.listeners.$add({newsTitleAck:function(c,g){var d="",h="";var f=8;$("#news_totalPages").val(Math.ceil(c.num/f));$("#news_pageNum").val(1);news.titleData=g;news.totalRows=c.num;for(var e=0;e<f;e++){h=g[e].title;h=h.length>21?(h.substring(0,20)):h;d+='<li nId="'+g[e].newsid+'" ntm="'+g[e].newstime+'" tn="'+g[e].title+'"><a href="javascript:">'+h+'<br/><span class="news-l-tim">'+Util.getUTCDateFromMis(g[e].newstime,"yyyy-MM-dd hh:mm:ss")+'</span><s class="jiant-icon"></s></a>'}$("#newsList ul").html(d);$("#newsList ul li").on("click",function(){news.currSocket.emit("request",Constant.CMD_GET_SINGLE_NEWS,{newsid:$(this).attr("nId"),language:newsLanguageValue(),newstime:$(this).attr("ntm")});news.currTitle=$(this).attr("tn")})}});news.currSocket.listeners.$add({newsContentAck:function(c,d){$("#news_content_title").html(news.currTitle);$("#btn_tab_div_back").show();$("#news_content").show();$("#newsList").hide();$("#news_content_time").html(Util.getUTCDateFromMis(c.newstime,"yyyy-MM-dd hh:mm:ss"));$("#news_content_detail").html(c.content)}});news.currSocket.listeners.$add({newsUpdate:function(c,e){if($("#news_pageNum").val()==1){$("#newsList ul li:last").remove();var d='<li nId="'+c.newsid+'" ntm="'+c.newstime+'" tn="'+c.title+'"><a href="javascript:">'+c.title+'<br/><span class="news-l-tim">'+Util.getUTCDateFromMis(c.newstime,"yyyy-MM-dd hh:mm:ss")+'</span><s class="jiant-icon"></s></a>';$("#newsList ul").prepend(d)}$("#newsList ul li[nId="+c.newsid+"]").on("click",function(){news.currSocket.emit("request",Constant.CMD_GET_SINGLE_NEWS,{newsid:$(this).attr("nId"),language:newsLanguageValue(),newstime:$(this).attr("ntm")});news.currTitle=$(this).attr("tn")})}})}})},gotoPage:function(g){var a=$("#news_totalPages").val();var f=$("#news_pageNum").val();if(Util.isBlank(f)){f=0}f=new Number(f);if(g=="first"){f=0}if(g=="pre"){f=f-1;if(f<0){f=0}}if(g=="next"){if(f<a){if(f==(a-1)){f=f}else{f=f+1}}else{f=a}}if(g=="last"){f=a-1}$("#news_pageNum").val(f);var e=news.titleData,b="";var d=(f+1)*8>news.totalRows?news.totalRows:(f+1)*8;for(var c=f*8;c<d;c++){dtitle=e[c].title;dtitle=dtitle.length>21?(dtitle.substring(0,20)):dtitle;b+='<li nId="'+e[c].newsid+'" ntm="'+e[c].newstime+'" tn="'+e[c].title+'"><a href="javascript:">'+dtitle+'<br/><span class="news-l-tim">'+Util.getUTCDateFromMis(e[c].newstime,"yyyy-MM-dd hh:mm:ss")+'</span><s class="jiant-icon"></s></a>'}$("#newsList ul").html(b);$("#newsList ul li").on("click",function(){news.currSocket.emit("request",Constant.CMD_GET_SINGLE_NEWS,{newsid:$(this).attr("nId"),language:newsLanguageValue(),newstime:$(this).attr("ntm")});news.currTitle=$(this).attr("tn")})}};var newsSocket;$(function(){news.init();newsSocket=news.currSocket});jQuery.extend({createSocket:function(c,b){var a;if(navigator.userAgent.indexOf("MSIE")!=-1){a=io.connect(b,{transports:["jsonp-polling"],reconnect:false,"try multiple transports":false,resource:"socket.io","force new connection":true})}else{a=io.connect(b,{reconnect:false,"try multiple transports":true,resource:"socket.io","force new connection":true})}a.$$name=c;return a},listenSocket:function(c){var f={i:9000000,next:function(){return this.i++}};function a(j){var i=null;var h=null;var g=j;this.setSeq=function(k){i=k;return this};this.setEvent=function(k){h=k;return this};this.listen=function(){a.list.push(this)};this.isMatch=function(k,m,l){if(i!=null&&!("undefinded"===typeof k)&&k!=null&&!("undefinded"===typeof k.seq)&&k.seq!=null){if(i==k.seq){return true}}else{if(h!=null&&h==l){return true}}return false};this.invoke=function(l,o,m){if(this.isMatch(l,o,m)){try{var k=g(l,o,m);if(k==false){return false}}catch(p){console.log(c.$$name,p)}return true}return false}}a.list=[];a.trigger=function(g,k,j){for(var h=0;h<a.list.length;h++){var l=a.list[h];if(l.invoke(g,k,j)){a.list.splice(h,1);break}}};function b(h){var g=h;this.call=function(i,j){a.trigger(i,j,g)}}var d={$add:function(h){for(var g in h){this.$register([g]);if("function"===typeof h[g]&&"function"===typeof this[g]){function i(l){var j=l;var k=d[j];var m=h[j];this.callback=function(o,p){try{if("function"===typeof k){k(o,p)}if("function"===typeof m){m(o,p)}}catch(q){}}}this[g]=new i(g).callback}}},$before:function(i){for(var h in i){this.$register([h]);if("function"===typeof i[h]&&"function"===typeof this[h]){var g=i[h];h="$before"+h;i[h]=g;function j(m){var k=m;var l=d[k];var o=i[k];this.callback=function(p,q){try{if("function"===typeof l){l(p,q)}if("function"===typeof o){o(p,q)}}catch(r){console.log(c.$$name,r)}}}this[h]=new j(h).callback}}},$after:function(i){for(var h in i){this.$register([h]);if("function"===typeof i[h]&&"function"===typeof this[h]){var g=i[h];h="$after"+h;i[h]=g;function j(m){var k=m;var l=d[k];var o=i[k];this.callback=function(p,q){try{if("function"===typeof l){l(p,q)}if("function"===typeof o){o(p,q)}}catch(r){console.log(c.$$name,r)}}}this[h]=new j(h).callback}}},$listenSeq:function(i,g,j){if(g==null){g={}}if(!("undefined"===typeof j)&&j!=null){var h=f.next();g.seq=h;new a(j).setSeq(h).listen()}console.log(c.$$name,">> "+i,g);c.emit("request",i,g)},$listenEvent:function(i,g,h,j){if(!("undefined"===typeof j)&&j!=null){new a(j).setEvent(h).listen()}console.log(c.$$name,">> "+i,g);c.emit("request",i,g)},$register:function(k){var h=k.length;for(var j=0;j<h;j++){var m=k[j];if(!("undefined"===typeof this[m])){continue}var g=new b(m).call;this[m]=g;var l=this;if(!(m.substring(0,1)=="$")){function o(p){var i=p;this.on=function(){c.on(i,function(q,r){l.$trigger(i,q,r)})}}new o(m).on()}}},$trigger:function(i,g,j){var h=d["$before"+i];if("function"===typeof h){if(i!="tick"){console.log(c.$$name,"trigger listener $before"+i)}h(g,j)}if(i!="tick"){console.log(c.$$name,"trigger listener "+i,g,j)}d[i](g,j);var k=d["$after"+i];if("function"===typeof k){if(i!="tick"){console.log(c.$$name,"trigger listener $after"+i)}k(g,j)}}};c.listeners=d;var e=c.$emit;c.$emit=function(h,g,i){if(!e.apply(c,arguments)){if(h!="HeartBeat"){console.log(c.$$name,"trigger not registered event "+h,g,i)}a.trigger(g,i,h)}}}});String.prototype.format=function(){if(arguments.length==0){return this}for(var b=this,a=0;a<arguments.length;a++){b=b.replace(new RegExp("\\{"+a+"\\}","g"),arguments[a])}return b};String.prototype.replaceAll=function(b,a){return this.replace(new RegExp(b,"gm"),a)};String.prototype.padLeft=function(b,d){var a=0;var c=this?this:"";d=d?d:"0";a=c.length;while(a<b){c=d+c;a++}return c};String.prototype.padRight=function(b,d){var a=0;var c=this?this:"";d=d?d:"0";a=c.length;while(a<b){c=c+d;a++}return c};String.prototype.movePointLeft=function(g){var e,c,b,d,f,a;d=".";a="";e=this?this:"";if(g<=0){return e}f=e.split(".");c=f[0]?f[0]:"";b=f[1]?f[1]:"";if(c.slice(0,1)=="-"){c=c.slice(1);a="-"}if(c.length<=g){d="0.";c=c.padLeft(g)}return a+c.slice(0,-g)+d+c.slice(-g)+b};String.prototype.movePointRight=function(f){var d,b,a,c,e;c=".";d=this?this:"";if(f<=0){return d}e=d.split(".");b=e[0]?e[0]:"";a=e[1]?e[1]:"";if(a.length<=f){c="";a=a.padRight(f)}return b+a.slice(0,f)+c+a.slice(f,a.length)};String.prototype.movePoint=function(a){if(a>=0){return this.movePointRight(a)}else{return this.movePointLeft(-a)}};String.prototype.toDate=function(){var a=this.toString();a=a.replace(/-/g,"/");var b=new Date(Date.parse(a));return b};Number.prototype.toFixed=function(d){var c,b,a,e;b=this+"";e=b.indexOf(".");c=b.movePoint(d);if(e>=0){a=Number(b.substr(e+d+1,1));if(a>=5&&this>=0||a<5&&this<0){c=Math.ceil(c)}else{c=Math.floor(c)}}return c.toString().movePoint(-d)};Array.prototype.remove=function(a){if(isNaN(a)||a>this.length){return false}this.splice(a,1)};Math.mod=function(j,i){var b=0;var a=0;var c,d;try{var h=j.toString();if(h.indexOf(".")!=-1){b=h.split(".")[1].length}}catch(g){b=0}try{var f=i.toString();if(f.indexOf(".")!=-1){a=f.split(".")[1].length}}catch(g){a=0}d=Math.max(b,a);c=Math.pow(10,d);return((Number(j).mul(c))%(Number(i).mul(c)))*Math.pow(10,-d)};var Util={accAdd:function(i,g){var c=0;var b=0;var a;try{var f=i.toString();if(f.indexOf(".")!=-1){c=f.split(".")[1].length}}catch(h){c=0}try{var d=g.toString();if(d.indexOf(".")!=-1){b=d.split(".")[1].length}}catch(h){b=0}a=Math.pow(10,Math.max(c,b));return Math.round(i*a+g*a)/a},accSub:function(i,g){var c=0;var b=0;var a;try{var f=i.toString();if(f.indexOf(".")!=-1){c=f.split(".")[1].length}}catch(h){c=0}try{var d=g.toString();if(d.indexOf(".")!=-1){b=d.split(".")[1].length}}catch(h){b=0}a=Math.pow(10,Math.max(c,b));n=(c>=b)?c:b;return(Math.round(i*a-g*a)/a).toFixed(n)},accDiv:function(h,f){var d,c,b,a;try{if(h.toString().indexOf(".")!=-1){d=h.toString().split(".")[1].length}else{d=0}}catch(g){d=0}try{if(f.toString().indexOf(".")!=-1){c=f.toString().split(".")[1].length}else{c=0}}catch(g){c=0}b=Number(h.toString().replace(".",""));a=Number(f.toString().replace(".",""));return(b/a)*Math.pow(10,c-d)},accMul:function(g,d){var a=0,c=g.toString(),b=d.toString();try{if(c.indexOf(".")!=-1){a+=c.split(".")[1].length}}catch(f){}try{if(b.indexOf(".")!=-1){a+=b.split(".")[1].length}}catch(f){}return Number(c.replace(".",""))*Number(b.replace(".",""))/Math.pow(10,a)},simpleOid:function(b){var a=b.length;if(a>6){return b.substring(a-6,a)}return b},html2Text:function(a){a=a.replace(/<[^>]+>/ig,"");return a},isSameOid:function(b,a){return(this.simpleOid(b)==this.simpleOid(a))},isEqual:function(c,b){for(var a in c){if(c[a]!=b[a]){return false}}return true},timestampToHHMMSS:function(a){var c=new Date(a);var b=(String(c.getHours()).length==1)?"0"+c.getHours():c.getHours();var d=(String(c.getMinutes()).length==1)?"0"+c.getMinutes():c.getMinutes();var e=(String(c.getSeconds()).length==1)?"0"+c.getSeconds():c.getSeconds();return b+":"+d+":"+e},isEmpty:function(a){return typeof(a)=="undefined"||a==""||a==null},isNotEmpty:function(a){return !this.isEmpty(a)},isBlank:function(a){return typeof(a)=="undefined"||a==null||a==""||a=="null"||a.toString().replaceAll("\\s","")==""},isNotBlank:function(a){return !this.isBlank(a)},fixToStr:function(b,g,d){g=(g||g==0)?g:2;var e=parseFloat(b);if(isNaN(e)){return""}var a=e.toFixed(g);if(d&&d>=0){var c=new RegExp("0{1,"+(g-d)+"}$");a=a.replace(c,"")}return a},fixToStrTwodecimal:function(a){var d=parseFloat(a);if(isNaN(d)){return"0.00"}var d=Math.round(a*100)/100;var c=d.toString();var b=c.indexOf(".");if(b<0){c+=".00"}else{while(c.length<=b+2){c+="0"}}return c},fixToNum:function(a,b){return parseFloat(this.fixToStr(a,b))},getSimpleTime:function(b,a){var c=new Date(b);return Util.isEmpty(a)?c:c.format(a)},getTime:function(b,a){var c=new Date(b*1000);return Util.isEmpty(a)?c:c.format(a)},getUTCDate:function(b,a){return this.getUTCDateFromMis(b*1000,a)},getUTCDateFromMis:function(b,a){var c=new Date(b+new Date().getTimezoneOffset()*60000);return Util.isEmpty(a)?c:c.format(a)},getRandomSeq:function(){return Math.round(Math.random()*(999999999-100000000))+100000000},getShowPrdCode:function(a){return a?a.substring(a.lastIndexOf("/")+1).substring(a.lastIndexOf("\\")+1):""},roundUp:function(c,b){if(Util.getDecimalLen(c)<=b){return c}var a=false;if(c<0){c=-c;a=true}c=c*Math.pow(10,b);c=Math.ceil(c)/Math.pow(10,b);return a?-c:c},roundDown:function(c,b){if(Util.getDecimalLen(c)<=b){return c}var a=false;if(c<0){c=-c;a=true}c=c*Math.pow(10,b);c=Math.floor(c)/Math.pow(10,b);return a?-c:c},allowNumKeyPress:function(a){var b=a.which;if(navigator.userAgent.indexOf("Firefox")>=0&&b==0){return true}if(b==46||b==8||(b>=48&&b<=57)){return true}else{return false}},allowMaxValueKeyPress:function(c,a,f){var e=c.which;if(navigator.userAgent.indexOf("Firefox")>=0&&e==0){return true}if(e!=46&&e!=8){if(e<48||e>57){return false}}if(Util.allowInputWhenSelectKeyPress(e,a)){return true}if(a!=null&&a!=""){var d=a.value;if(d!=null&&d!=""){var b=parseFloat(d)+parseFloat(String.fromCharCode(e));if(parseFloat(b)>parseFloat(f)){return false}}}return true},allowMaxDightsLenKeyPress:function(d,b,c){var f=d.which;if(navigator.userAgent.indexOf("Firefox")>=0&&f==0){return true}if(f!=46&&f!=8){if(f<48||f>57){return false}}if(Util.allowInputWhenSelectKeyPress(f,b)){return true}var e=b.value;if(e!=null&&e!=""){var a=String.fromCharCode(f)==""?"":String.fromCharCode(f);if(e.indexOf(".")!=-1){if(a=="."){return false}if(Util.getCursorPosition(b)>e.indexOf(".")&&a!=""&&Util.getDecimalLen(e+a)>c){return false}}if(c==0){if(a=="."){return false}}}return true},allowMaxIntLenKeyPress:function(e,d,c){var g=e.which;if(navigator.userAgent.indexOf("Firefox")>=0&&g==0){return true}if(g!=46&&g!=8){if(g<48||g>57){return false}}if(Util.allowInputWhenSelectKeyPress(g,d)){return true}var f=d.value;if(f!=null&&f!=""){var b=f.split(".")[0];var a=String.fromCharCode(g)==""?"":String.fromCharCode(g);if(f.indexOf(".")!=-1){if((Util.getCursorPosition(d)<=f.indexOf("."))&&Util.getIntLen(b+a)>c){return false}}else{if(Util.getIntLen(b+a)>c){return false}}}return true},allowInputWhenSelectKeyPress:function(c,a){var e=navigator.userAgent.toLowerCase();var d=((e.indexOf("msie")!=-1)&&(e.indexOf("opera")==-1)&&(e.indexOf("omniweb")==-1));var b="";if(!d){if(a.selectionStart!=undefined){b=a.value.substr(a.selectionStart,a.selectionEnd-a.selectionStart)}return b!=""?true:false}else{if(document.selection){b=document.selection.createRange().text}else{b=window.getSelection()}return b!=""?true:false}},getCursorPosition:function(a){if(navigator.userAgent.indexOf("MSIE")>0){var c=document.selection.createRange();var d=a.createTextRange();d.collapse(true);d.select();var b=document.selection.createRange();b.setEndPoint("EndToEnd",c);var e=b.text.length;c.select();return e}else{return a.selectionStart}},allowNumKeyUp:function(a){if(a!=null&&a!=""){var b=a.value;if(isNaN(b)){a.value=b.replace(/[^\d.]/g,"").replace(/^\./g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".")}}},allowNumKeyPressSpinner:function(){var a=/^\d+(?=\.{0,1}\d+$|$)/;if(!a.test($(this).val())){$(this).val("");$(this).focus();return}},getIntLen:function(b){b=$.trim(b);var a=b.toString().split(".");return a[0].length},getDecimalLen:function(b){var a=b.toString().split(".");if(a.length==1){return 0}else{return a[1].length}},maxLength:function(a){var b=this;b.unbind("input propertychange change");b.bind("input propertychange change",function(){var c=b.val().toString();if(c.length>a){b.val(c.substring(0,a))}})}};Date.prototype.format=function(b){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(b)){b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in c){if(new RegExp("("+a+")").test(b)){b=b.replace(RegExp.$1,RegExp.$1.length==1?c[a]:("00"+c[a]).substr((""+c[a]).length))}}return b};Number.prototype.add=function(a){return Util.accAdd(a,this)};Number.prototype.sub=function(a){return Util.accSub(this,a)};Number.prototype.mul=function(a){return Util.accMul(a,this)};Number.prototype.div=function(a){return Util.accDiv(this,a)};String.prototype.add=function(a){return Util.accAdd(a,this)};String.prototype.sub=function(a){return Util.accSub(this,a)};String.prototype.mul=function(a){return Util.accMul(a,this)};String.prototype.div=function(a){return Util.accDiv(this,a)};String.format=function(b){if(!b||arguments.length==0){return""}var a=Array.prototype.slice.call(arguments,1);return b.replace(/\{(\d+)\}/g,function(c,d){return a[d]})};var index={init:function(){this.tabClick();this.initDisclaimer()},tabClick:function(){$("#quoted-price-fl li").on("click",function(){$(".scroll-data").hide();var a=$("#quoted-price-fl li");a.removeClass("on-na");$($(".scroll-data").get(a.index(this))).show();$(this).addClass("on-na")});$("#investment-entrust-fl li").on("click",function(){var a=$("#investment-entrust-fl li");var c=a.index($(this));$(this).addClass("on-na").siblings().removeClass("on-na");$("#investment-entrust-cont").children("div").eq(c).show().siblings().hide();if(Util.isNotBlank($(this).attr("tn"))){var b=$("#"+$(this).attr("tn")).dataTable();if($(this).attr("tn")=="accountSummaryTable"){AccountSummary.onUpdate()}if(b.length>0){$(".dataTables_scrollHeadInner",$("#investment-entrust-cont")).width("100%");$("#"+$(this).attr("tn")).width("100%");b.fnAdjustColumnSizing()}}})},initDisclaimer:function(){var a=$("#disclaimerDiv");a.dialog({autoOpen:false,modal:true,resizable:false,width:600,height:450});$("#disclaimer").on("click",function(){a.dialog("open")})}};var MsgDialog={$alertDiv:null,$confirmDiv:null,init:function(){this._createMsgDialog()},_createMsgDialog:function(){this.$alertDiv=$('<div title="提示" class="dn"><p class="mm-fail-p content"></p><p class="more-lls-btn gez-btninfo del-wid btns"></p></div>').appendTo("body");this.$alertDiv.dialog({closeOnEscape:false,autoOpen:false,modal:true,resizable:false,minWidth:350});this.$confirmDiv=$('<div title="提示" class="dn"><p class="mm-fail-p content"></p><p class="more-lls-btn gez-btninfo btns"></p></div>').appendTo("body");this.$confirmDiv.dialog({closeOnEscape:false,autoOpen:false,modal:true,resizable:false,minWidth:350})}};$(function(){index.init();MsgDialog.init()});function Confirm(c){c=$.extend({$div:MsgDialog.$confirmDiv},c);var a=c.$div;var b=a.find(".content");var d=a.find(".btns");if(c.title){a.dialog("option","title",c.title)}if(c.content){b.html(c.content)}d.children().remove();if(c.isAlert){a.on("dialogclose",function(e,f){if($.isFunction(c.ok)){c.ok()}})}if(c.okValue){$('<a href="javascript:">'+c.okValue+"</a>").appendTo(d).on("click",function(){if($.isFunction(c.ok)){c.ok()}a.dialog("close")})}if(c.cancelValue){$('<a href="javascript:">'+c.cancelValue+"</a>").appendTo(d).on("click",function(){if($.isFunction(c.cancel)){c.cancel()}a.dialog("close")})}a.dialog("open")}var Alert=function(c,b){if($("#index_version").val()=="dt"){Confirm({$div:MsgDialog.$alertDiv,content:c,okValue:i18n.ok,ok:b||true,isAlert:true})}else{var a=$('<div class="layer-box dn"><div class="layer-con layer-con-weit"><h3 class="top-menubox">'+i18n.message+'</h3><div class="lay-kuang-fon"><div class="lay-kuang-con"><p tn="content" style="padding: 10px 5px 12px 5px;word-break:break-all"></p><p class="more-lls-btn gez-btninfo" style="margin-left:25%;"><a href="javascript:" class="gez-qx-btn">'+i18n.closed+"</a></p></div></div></div></div>");a.dialog({closeOnEscape:false,modal:true,autoOpen:false,resizable:false,minWidth:300});$("p[tn=content]",a).html(c);$(".ui-dialog-titlebar-close",a.parent()).hide();a.dialog("open");$(".gez-qx-btn",a).click(function(){if($.isFunction(b)){b()}a.dialog("close")})}};clearArray=function(a){if(a!=null&&a.length>0){a.splice(0,a.length)}};getPrdCodeByPrdId=function(a){var b;if(a=="0"){b="022"}else{if(a=="1"){b="023"}}return b};getPrdIdByPrdCode=function(b){var a;if(b=="022"){a="0"}else{if(b=="023"){a="1"}}return a};getUserMargin=function(c){var a;var b;if(c=="022"||c=="0"){a=Tick.gold.symbol;b=accountBaseInfo.goldinimargin}else{if(c=="023"||c=="1"){a=Tick.silver.symbol;b=accountBaseInfo.silverinimargin}}if(isHoliday){return Util.fixToStrTwodecimal(a.holidaymargin)}if(isWeekend){return Util.fixToStrTwodecimal(a.weekendmargin)}if(b==0){return Util.fixToStrTwodecimal(a.inimargin)}else{return Util.fixToStrTwodecimal(b)}};var SystemCookie={account:"",init:function(a){this.account=a},setTradeVol:function(b,a){$.cookie(this.account+"_tVolume_"+b,a,{expires:3650})},getTradeVol:function(a){return $.cookie(this.account+"_tVolume_"+a)},setDayNight:function(a){$.cookie(this.account+"_dayNight",a)},getDayNight:function(){return $.cookie(this.account+"_dayNight")},setMarginLevel:function(a){$.cookie(seesion_login_uid+"_MarginLevel",a)},getMarginLevel:function(){return $.cookie(seesion_login_uid+"_MarginLevel")}};var Log={debug:function(){if(window.console){if(console.log.apply){console.log.apply(console,arguments)}else{if(Function.prototype.call){Function.prototype.call.apply(console.log,[console].concat(Array.prototype.slice.call(arguments,0)))}}}}};var Logs=[];var LogsPrinter=false;(function(c){console=("undefined"===typeof console)?{}:console;var d=["log","info","debug","warn","error","assert"];for(var b=0;b<d.length;b++){var a=d[b];if(LogsPrinter==false){console[a]=function(){}}else{if("undifined"===typeof console[a]){console[a]=function(){if(arguments.length>0){if(c.length>100){c.shift()}c.push(a+": "+arguments[0])}}}}}})(Logs);var symbolArray=new Array();var amsSymbolConfigArray=new Array();var orderDealData={};var postList=[];var orderUpdateData={};var groupOrderlimit={};var symbolTradeArray=new Array();var isHoliday=false;var isWeekend=false;var isSymbolSessionLLG=false;var isSymbolSessionLLS=false;var llgTimerflagCount=0;var llsTimerflagCount=0;var ismarketSubmit=false;var tradeTimeOutObj;var ispendingSubmit;var setSymbolTradeArray=function(b){var a=true;for(var c in symbolTradeArray){var d=symbolTradeArray[c];if(d.prdid==b.prdid){symbolTradeArray.splice(c,1);symbolTradeArray.push(b);a=false;break}}if(a){symbolTradeArray.push(b)}};var isSymbolTradeOpen=function(a){if(a==0){return isSymbolSessionLLG}if(a==1){return isSymbolSessionLLS}return false};var getSymbolArray=function(){return symbolArray};var getSymbol4Code=function(b){var c=getSymbolArray();if(c){for(var a=0;a<c.length;a++){if(c[a]["source"]==b){return c[a]}}}};var getSymbolByPrdcode=function(b){var c=getSymbolArray();if(c&&c.length>0){b=Util.getShowPrdCode(b);for(var a=0;a<c.length;a++){if(Util.getShowPrdCode(c[a]["prdcode"])==b){return c[a]}}}};getAmsSymbolConfigArray=function(){return amsSymbolConfigArray};setAmsSymbolConfigArray=function(e){if(e){for(var b=0;b<e.length;b++){if(amsSymbolConfigArray.length==0){amsSymbolConfigArray.push(e[b])}else{var d=e[b];var a=false;for(var c=0;c<amsSymbolConfigArray.length;c++){if(amsSymbolConfigArray[c]["prdcode"]==d.prdcode){amsSymbolConfigArray[c]=d;a=true;break}}if(!a){amsSymbolConfigArray.push(d)}}}}};getAmsSymbolConfig4Code=function(b){var c=getAmsSymbolConfigArray();if(c){for(var a=0;a<c.length;a++){if(c[a].prdcode==b){return c[a]}}}};showSymbol4AmsConfig=function(b){var a=getAmsSymbolConfig4Code(b);if(a){if(a.flags&1){return true}else{return}}else{return false}};getOrderDealData=function(){return orderDealData};setOrderDealData=function(a){if(a){orderDealData=a}};getOrderDeal4OrderId=function(a){var b=getOrderDealData();if(b){if(b.order_id==a){return b}}};getOrderUpdateData=function(){return orderUpdateData};setOrderUpdateData=function(a){if(a){orderUpdateData=a}};getOrderUpdate4OrderId=function(a){var b=getOrderUpdateData();if(b){if(b.order_id==a){return b}}};getGroupOrderlimitData=function(){return groupOrderlimit};setGroupOrderlimitData=function(a){if(a){groupOrderlimit=a}};var Global={tick:null,bid_022:0,ask_022:0,bid_023:0,ask_023:0,newP_022:0,newP_023:0,time_022:0,time_023:0,last_chart_time_022:0,last_chart_time_023:0,sumNetProfit:0,netValue:0,validValue:0,depositLevel:0,loginResult:-1,last2DayQuotes_022:null,last2DayQuotes_023:null,accountBaseInfo:null,userInformation:null,symbolList:null,symbol_022:null,symbol_023:null,configs:null,config_022:null,config_023:null,loginname:$('meta[name="loginname"]').attr("content"),contextPath:$('meta[name="contextPath"]').attr("content"),currentLanguage:$('meta[name="currentLanguage"]').attr("content"),connectStatus:"disconnect",userStatus:0,maxloss:0};var Constant={PRDCODE_022:"GT1/PM/LLG",PRDCODE_023:"GT1/PM/LLS",SOURCE_022:"XAUUSD",SOURCE_023:"XAGUSD",CMD_LAST_TICK:66307,CMD_QUOTE_QUERY:66305,CMD_QUOTE_PERIOD_QUERY:66306,CMD_OPEN_MARKET:65792,CMD_CLOSE_MARKET:65793,CMD_PENDING_ORDER:65794,CMD_CANCEL_ORDER:65795,CMD_ALTER_WAGER:65801,CMD_MODIFY_ORDER:65796,CMD_GET_SINGLE_NEWS:66562,CMD_GET_NEWS_BY_PAGE:66561,CMD_ORDER_EXCUTED:65798,QUOTE_QUERY_SEQ_022:320022,QUOTE_QUERY_SEQ_023:320023,QUOTE_CHART_QUERY_022:210022,QUOTE_CHART_QUERY_023:210023,QUOTE_QUERY_PERIOD_TYPE_MIN:1,QUOTE_QUERY_PERIOD_TYPE_HOUR:2,QUOTE_QUERY_PERIOD_TYPE_DAY:3,QUOTE_QUERY_PERIOD_TYPE_WEEK:4,QUOTE_QUERY_PERIOD_TYPE_MONTH:5,QUOTE_QUERY_FLAG_NTO:0,QUOTE_QUERY_FLAG_OTN:1,LOGIN_RESULT_OK:0,TRADE_RIGHT_DISABLED:0,TRADE_RIGHT_BUY:1,TRADE_RIGHT_SELL:2,TRADE_RIGHT_CLOSE:3,TRADE_RIGHT_ALL:4,DIV_ID_OPEN_MARKET:"openMarketDiv",DIV_ID_CLOSE_MARKET:"closeMarketDiv",RET_CODE_SUCCESS:0,RET_CODE_BROKER:1011,RET_CODE_PENDING_SUCCESS:1000,RET_CODE_WRONG_PRICE:111,RET_CODE_ORDER_INVL_PRICE:1009,RET_CODE_INVL_VOLUME:1018,RET_CODE_ON_HOLIDAY:1013,RET_CODE_VOLUME:112,ENTRY_OPEN:0,ENTRY_CLOSE:1,GT1_LANG_CHINESE_SIMP:2052,GT1_LANG_CHINESE_TRAD:1028,GT1_LANG_ENGLISH:2057,INVALID_VAL:"---"};var Index={POSLIST_TD_PROFIT:4,POSLIST_TD_VOLUME:3,ORDERLIST_TD_STATE:4,ORDERLIST_TD_VOLUME:3};var Request={openMarket:{cmd:Constant.CMD_OPEN_MARKET,ret_cmd:Constant.CMD_ORDER_EXCUTED,seq:0,flag:true},pendingOrder:{cmd:Constant.CMD_PENDING_ORDER,ret_cmd:Constant.CMD_ORDER_EXCUTED,seq:0,flag:true},closeMarket:{cmd:Constant.CMD_CLOSE_MARKET,ret_cmd:Constant.CMD_ORDER_EXCUTED,seq:0,flag:true},cancelOrder:{cmd:Constant.CMD_CANCEL_ORDER,seq:0,flag:true},alterWager:{cmd:Constant.CMD_ALTER_WAGER,ret_cmd:Constant.CMD_ORDER_EXCUTED,seq:0,flag:true},modifyOrder:{cmd:Constant.CMD_MODIFY_ORDER,ret_cmd:Constant.CMD_ORDER_EXCUTED,seq:0,flag:true}};var OrderType={UNKNOWN:0,BUY:1,SELL:2,BUY_LIMIT:1,SELL_LIMIT:1,BUY_STOP:2,SELL_STOP:2,BUY_STOP_LIMIT:7,SELL_STOP_LIMIT:8,BUY_OCO:3,SELL_OCO:3,BUY_ANDVANCE:4,SELL_ANDVANCE:4};var pendingOrdertype={LIMIT:"L",STOP:"S",BUY_OCO:"B",ADVANCE:"A"};var OrderState={STARTED:1,PLACED:2,FILLED:4,CANCELED:-1,EXPIRED:-2};var pendingOrdertype={LIMIT:"L",STOP:"S",BUY_OCO:"B",ADVANCE:"A"};var mail={lastMailIdkey:"last_mail_id",Request_Mail:65800};var newsLanguageValue=function(){var a=3;if(Global.currentLanguage=="zh_TW"){a=3}else{if(Global.currentLanguage=="zh_CN"){a=2}else{a=1}}return a};var userNodeType={USER_RIGHT_TRADE_DISABLED:4,USER_RIGHT_SUSPENDED:8192,USER_RIGHT_LOCKED:2048,USER_RIGHT_ENABLED:1};checkUserAuth=function(a){if(Global.userStatus&userNodeType.USER_RIGHT_TRADE_DISABLED){return globelData.userStatus.error_msg_1}else{if(Global.userStatus&userNodeType.USER_RIGHT_SUSPENDED){if(a&&(a==globelData.action.delete_delegate||a==globelData.action.close_order)){}else{return globelData.userStatus["error_msg_-2"]}}else{if(Global.userStatus&userNodeType.USER_RIGHT_LOCKED){return globelData.userStatus.error_msg_1}else{if(!(Global.userStatus&userNodeType.USER_RIGHT_ENABLED)){return globelData.userStatus["error_msg_-1"]}}}}};var globelData={};globelData.getSymbolTradeState=function(g){var o={code:-1,msg:""};var j=g.showMsg;var e=g.action;var b=g.prdcode;if(Util.isEmpty(b)){b=g.prcode}if(b.indexOf("\\")>=0){b=Util.getShowPrdCode(b)}if(Global.connectStatus=="connect"){var a=Global.userStatus;if(a&globelData.userStatus.USER_RIGHT_SUSPENDED){a=globelData.userStatus.USER_RIGHT_SUSPENDED}else{if(a&globelData.userStatus.USER_RIGHT_TRADE_DISABLED){a=globelData.userStatus.USER_RIGHT_TRADE_DISABLED}}var l=e[a];if(l){if(b=="XAUUSD"){b="LLG"}if(b=="XAGUSD"){b="LLS"}var i=getSymbolByPrdcode(b);if(i){var k=getAmsSymbolConfig4Code(i.prdcode);var d=i.flags;var c=k.flags;var m=k.flags;if(d&globelData.symbolFlags.SYMBOL_FLAG_ABLE){if(m&8||c&1){if(d&globelData.symbolFlags.SYMBOL_FLAG_OUT_OF_SESSION||d&globelData.symbolFlags.SYMBOL_FLAG_HOLIDAY){o.msg=WebUIError["10202"]}else{if(e){var f=i.trade_right;var h=k.trade_right;if(f==globelData.tradeRight.all){o.code=1}else{if(f==globelData.tradeRight.close_position&&e.operate==globelData.tradeRight.close_position){o.code=1}else{o.msg=WebUIError["10211"]}}if(o.code==1){if(h==globelData.tradeRight.all){o.code=1}else{if(h==globelData.tradeRight.close_position&&e.operate==globelData.tradeRight.close_position){o.code=1}else{o.code=-1;o.msg=WebUIError["10211"]}}}}else{o.code=1}}}else{o.msg=WebUIError["10211"]}}else{o.msg=WebUIError["10202"]}}else{o.msg=WebUIError["10211"]}}else{o.msg=globelData.userStatus["error_msg_"+a];if(Util.isEmpty(o.msg)){o.msg=WebUIError["10206"]}}}else{o.msg=WebUIError["10204"]}if(o.code==-1){if(typeof j=="undefined"||j==null||j==true){Alert(o.msg)}}return o};globelData.tradeRight={close:0,long_position:1,short_position:2,close_position:3,all:4};globelData.symbolFlags={SYMBOL_FLAG_ABLE:2048,SYMBOL_FLAG_DISABLE:1,SYMBOL_FLAG_OUT_OF_SESSION:2,SYMBOL_FLAG_HOLIDAY:4,SYMBOL_FLAG_SOURCE:8};globelData.userStatus={error_msg_0:"",error_msg_4:WebUIError["10206"],error_msg_8192:WebUIError["10205"],USER_RIGHT_NONE:0,USER_RIGHT_ENABLED:1,USER_RIGHT_PASSWORD:2,USER_RIGHT_TRADE_DISABLED:4,USER_RIGHT_INVESTOR:8,USER_RIGHT_CONFIRMED:16,USER_RIGHT_TRAILING:32,USER_RIGHT_READONLY:512,USER_RIGHT_FORBIDDEN:1024,USER_RIGHT_LOCKED:2048,USER_RIGHT_EXPIRED:4096,USER_RIGHT_SUSPENDED:8192};globelData.action={add_order:{"1":true,"4":false,"8192":false,operate:globelData.tradeRight.all},add_delegate:{"1":true,"4":false,"8192":false,operate:globelData.tradeRight.all},update_delegate:{"1":true,"4":false,"8192":false,operate:globelData.tradeRight.all},delete_delegate:{"1":true,"4":false,"8192":true,operate:globelData.tradeRight.close_position},update_amount:{"1":true,"4":false,"8192":false,operate:globelData.tradeRight.all},close_order:{"1":true,"4":false,"8192":true,operate:globelData.tradeRight.close_position}};clearGlobalDataArrayAndObject=function(){clearArray(symbolArray);clearArray(amsSymbolConfigArray);clearTradeData()};var socket;var bodyShow=false;$(function(){var b=false;var d=jQuery.cookie("clientTime");if(d&&(Math.abs(new Date().getTime()-d)<2000)){$("body").hide();closeWindows();return}a();$("#logout_btn").click(function(){Confirm({title:i18n.logout,content:i18n.confirmLogout,okValue:i18n.ok,ok:function(){location.href=Global.contextPath+"/LogOff.action?t="+new Date().getTime();return true},cancelValue:i18n.cancel,cancel:true})});try{window.onunload=function(){console.log("window.onunload ...");jQuery.cookie("clientTime","")}}catch(c){}try{window.onbeforeunload=function(){b=true;console.log("window.onbeforeunload ...");jQuery.cookie("clientTime","")}}catch(c){}function a(){setTimeout(function(){if(SystemConnection.login==false){if(debugui){alert("SystemConnection.login == false")}location.href="Login.action?errorcode=10101"}},60000);$.ajax({type:"post",url:"InitGoldMain.action",dataType:"json",async:false,error:function(g,f,h){console.log(i18n.readDateError+":"+h.message)},success:function(e){var f=e.initConfig;if(!f||f.flag=="error"){location.href="LogOff.action"}socket=$.createSocket("trade",f.nodeUrl);$.listenSocket(socket);socket.listeners.$add({connect:function(){try{socket.emit("addme",f.loginname,f.pwd)}catch(h){console.log(i18n.connectionFail+"："+h)}}});socket.listeners.$add({AccLogin:function(h,i){if(h.code!=0){if(debugui){alert("para.code != 0")}socket.disconnect();location.href="Login.action?errorcode="+h.code}}});var g=false;socket.listeners.$add({OrderEnd:function(h,i){if(g==true){return}g=true;if(h.code==0){setTimeout(function(){$("#body").show();bodyShow=true;$("#loading").hide();WebUiChart.orderDisplayed=true;var j=($("#index_chart_div").length==0);if(!WebUiChart.chartShowed&&WebUiChart.newsSocketConnected&&j){console.log("CHART: starting WebUiChart.init()");if("night"==SystemCookie.getDayNight()){swapStyleSheet({id:"change_to_night"})}WebUiChart.init()}$("#investment-entrust-fl li[tn='accountPositionsTable']").click();weekendHandler();browserHistory.setKey()},500)}isLogined=true}});socket.listeners.$add({reload_info:function(h,i){if(f.loginname==h.loginname){window.location.href=window.location.href}}});socket.listeners.$add({reconnect:function(){console.log("reconnect");clearGlobalDataArrayAndObject();SystemConnection.updateConnectStatus("connect")}});socket.listeners.$add({disconnect:function(){console.log(socket.$$name+" disconnect");if("trade"==socket.$$name){clearGlobalDataArrayAndObject();if(!b){if(debugui){alert("core 152: disconnect, refresh")}}}}});socket.listeners.$add({OtherLogin:function(h){console.log("OtherLogin");SystemConnection.updateConnectStatus("disconnect");if(socket){socket.disconnect();socket=null}clearGlobalDataArrayAndObject();logoutAjax();var i=i18n.accReconnection;if(h.code===1){i=i18n.accReconnection}else{if(h.code===2){i=i18n.accReconnection}else{if(h.code===3){i=i18n.accTraderOccupied}}}setTimeout("location.href = 'Login.action'",5000);Alert(i,function(){location.href="Login.action"})}});socket.listeners.$add({loginR:function(h){console.log("loginR",h);loginReturn(h)}});socket.listeners.$add({SymbolList:function(h,i){QuotationGTS.init(h,i)}});socket.listeners.$add({group_orderlimit:function(h,i){setGroupOrderlimitData(h)}});socket.listeners.$add({AmsSymbolConfig:function(h,i){i.length=h.num;setAmsSymbolConfigArray(i);Quotation.updateSymbolConfig(i)}});socket.listeners.$add({ondeal:function(h,i){setOrderDealData(h)}});socket.listeners.$add({order_update:function(h){setOrderUpdateData(h);Investment.businessMethod.replacePostByOrder(h);Investment.businessMethod.refreshSuccessClosePos(h)}});socket.listeners.$add({bulletin_remove:function(h,i){deleteBulletinFromArray(h)}});socket.listeners.$add({MarketBuildRet:function(h,i){console.log("MarketBuildRet",h,i);GTShandleMarketRequestR(h)}});socket.listeners.$add({PendingOrderRet:function(h,i){if(ispendingSubmit){GTShandlePendingOrderRequestR(h)}}});socket.listeners.$add({AdvOrderRet:function(h,i){console.log("AdvOrderRet",h,i);GTShandleAdvancePendingOrderRequestR(h,i);GTShandleModifyAdvPendingOrderRequestR(h,i)}});socket.listeners.$add({ModifyOrderRet:function(h,i){console.log("ModifyOrderRet",h,i);GTShandleModifyPendingOrderRequestR(h,i)}});socket.listeners.$add({MarketCloseRet:function(h,i){try{if(MarketClose.isSubmit){MarketClose.GTShandleMarketRequestR(h)}}catch(j){alert(j)}}});socket.listeners.$add({userRight:function(h,i){Global.userStatus=h.user_right;if(!(Global.userStatus&userNodeType.USER_RIGHT_ENABLED)){logoutAjax();Alert(WebUIError["10212"],function(){if(debugui){alert("core 281: userRight err")}socket=null;location.href="Login.action"})}}});socket.listeners.$add({HolidayItem:function(q,o){var h=q.begintime;var i=q.endtime;var k=new Date();var l=h-k.getTime();var p=i-k.getTime();setTimeout(j,l);setTimeout(m,p);function j(){isHoliday=true;DynamicUpdates.onClear();$("#closedPositionTable").dataTable().fnClearTable();AccountPositions.refresh()}function m(){isHoliday=false}}})}})}});function logoutAjax(a){$.ajax({type:"POST",url:Global.contextPath+"/LogOff.action?t="+new Date().getTime(),cache:false,success:function(){if(a){a()}}})}function loginReturn(a){try{Global.loginResult=a;var d=a.ret;if(d!=Constant.LOGIN_RESULT_OK){var b=WebUIError[d];if(b){Alert(b)}else{Alert(i18n.loginFail+"："+d);location.href="Login.action"}SystemConnection.updateConnectStatus("disconnect");socketLoginReconnect();return}else{SystemConnection.updateConnectStatus("connect")}}catch(c){}}var count=0;function socketLoginReconnect(){if(count>2){console.log("home....");clearInterval(intervalConn);clearGlobalDataArrayAndObject();logoutAjax();if(debugui){alert("core 417: count > 2: "+count)}location.href="Login.action"}if(Global.connectStatus=="disconnect"){count++;socket.socket.reconnect();console.log("io.reconnect ...")}else{if(Global.connectStatus=="connect"){return}}}function closeWindows(){var a=navigator.appName;if(a=="Netscape"){window.open("","_parent","");window.close()}else{if(a=="Microsoft Internet Explorer"){window.opener="whocares";window.close()}}setTimeout(function(){window.location.href="about:blank "},(500))}function weekendHandler(){var f=QuotationGTS.getSymbolArrayByPrdcode("022");if(f.tradestatus=="0"||!isSymbolSessionLLG){var h=e().getTime();var a=b().getTime();var g=new Date();if(typeof SystemTime!="undefined"&&SystemTime!=null){g=SystemTime.time}if(g>=h&&g<=a){c()}else{d()}}function c(){isWeekend=true;DynamicUpdates.onClear();$("#closedPositionTable").dataTable().fnClearTable();AccountPositions.refresh()}function d(){isWeekend=false}function e(){var j=new Date(SystemTime.time);var i=j.getDay();var k=6-i;if(k>0){j.setDate(j.getDate()+k);j.setHours(3);j.setMinutes(0);j.setSeconds(0)}return j}function b(){var j=new Date(SystemTime.time);var i=j.getDay();var k=8-i;if(k>0){j.setDate(j.getDate()+k);j.setHours(8);j.setMinutes(0);j.setSeconds(0)}return j}setTimeout(weekendHandler,60*60*1000)}var utils={changeTwoDecimal:function(a){var b=parseFloat(a);if(isNaN(b)){alert("function:changeTwoDecimal->parameter error");return false}var b=Math.round(a*100)/100;return b},timestampToHHMMSS:function(a){var b=new Date(a);return b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()}};var Tick={gold:{prdcode:"022"},silver:{prdcode:"023"},usdinx:{prdcode:"050"},oil:{prdcode:"00E"}};$(function(){var a={ask:0,bid:0,price:0,priceHigh:0,priceLow:0,time:0,buySpread:0,sellSpread:0,spread:0,lastClose:0,open:0,symbol:{},lastTickData:{},lastTickPara:{}};a.prdcode="022";var f=jQuery.extend(true,{},a);f.prdcode="023";var h=jQuery.extend(true,{},a);h.prdcode="050";var g=jQuery.extend(true,{},a);g.prdcode="00E";var b=[a,f];Tick.$get=function(l){for(var j=0;j<b.length;j++){var k=b[j];if(l==k.prdcode){return k}}return null};function d(){Tick.gold.askTrend=a.ask-Tick.gold.ask;Tick.gold.bidTrend=a.bid-Tick.gold.bid;Tick.gold.priceTrend=a.price-Tick.gold.price;Tick.silver.askTrend=f.ask-Tick.silver.ask;Tick.silver.bidTrend=f.bid-Tick.silver.bid;Tick.silver.priceTrend=f.price-Tick.silver.price;for(var i in a){Tick.gold[i]=a[i]}for(var i in f){Tick.silver[i]=f[i]}}var e={"022":false,"023":false};socket.listeners.$add({SymbolList:function(j,l){for(var k=0;k<j.num;k++){var m=l[""+k];if(m.prdcode=="022"){a.buySpread=m.buyspread;a.sellSpread=m.sellspread;a.symbol=m}if(m.prdcode=="023"){f.buySpread=m.buyspread;f.sellSpread=m.sellspread;f.symbol=m}}d()}});socket.listeners.$before({tick:function(k,o){for(var m=0;m<k+1;m++){var l=o[m];if(e[l.symbol]==false||(!isHoliday&&!isWeekend)){if(e[l.symbol]==false){console.info("fist tick received.",l.symbol)}var j=Tick.$get(l.symbol);if(j==null){continue}j.time=l.dtime*1000;j.ask=l.ask+j.sellSpread;j.bid=l.bid+j.buySpread;j.price=l.newP;j.priceHigh=l.high;j.priceLow=l.low;j.spread=Util.fixToStr(Math.round((j.bid-j.ask)*100),0,0);j.lastTickData=o;j.lastTickPara=k;e[l.symbol]=true}}d()}});function c(){function j(m){var i=m;this.call=function(o,r){if(r==0){return}var q=r[0]["begin"];i.open=q;var p=r[1]["end"];i.lastClose=p;d();if(e[i.prdcode]==true){console.log("trigger tick symbol "+i.prdcode);socket.listeners.$trigger("tick",i.lastTickPara,i.lastTickData)}}}for(var k=0;k<b.length;k++){var l=b[k].prdcode;newsSocket.listeners.$listenSeq(Constant.CMD_QUOTE_QUERY,{time:0,num:2,period_num:1,period_type:3,flag:0,symbol:l},new j(b[k]).call)}setTimeout(c,600000)}socket.listeners.$add({OrderEnd:function(){for(var i in e){if(e[i]==false){console.log("get last tick "+i);socket.emit("request",Constant.CMD_LAST_TICK,{"0":i})}}}});newsSocket.listeners.$add({loginR:function(i,j){c()}});Tick.getClosedPrice=function(i,k){var j=0;if(i==0){if(k==0){j=a.ask}if(k==1){j=a.bid}}if(i==1){if(k==0){j=f.ask}if(k==1){j=f.bid}}return j}});var Validator={checkMarketPrice:function(c){var b=Tick.$get(c);var a=Math.abs(SystemTime.time-b.time);if(a>60000){Alert(WebUIError["26"]);return false}else{return true}}};var AccountPositions={orders:[],refresh:function(){},onAddOrder:function(a){},onUpdateOrder:function(a){},onDeleteOrder:function(a){},updateOrderBySystemPOrderClose:function(b,a){}};$(function(){var d=[];function c(){AccountPositions.orders=d.slice(0)}function h(j){var l=false;for(var k=0;k<d.length;k++){if(j.oid==d[k].oid){l=true;d[k]=j;a(j);AccountPositions.onUpdateOrder(j);break}}if(!l){d.push(j);a(j);AccountPositions.onAddOrder(j)}}function e(j){for(var k=0;k<d.length;k++){if(j.orderid==d[k].oid){console.log(j.interest);d[k].interest=j.interest;a(d[k]);AccountPositions.onUpdateOrder(d[k]);break}}}function g(k){var l=-1;var m=false;for(l=0;l<d.length;l++){if(k==d[l].oid){m=true;break}}if(m==true){var j=d[l];d.splice(l,1);AccountPositions.onDeleteOrder(j.oid)}}function b(l){for(var k=0;k<d.length;k++){var j=d[k];if(j.oid==l.targetoid){if(j.lot==l.lot){g(j.oid)}else{j.lot=Util.accSub(j.lot,l.lot);a(j);AccountPositions.onUpdateOrder(j)}}}}function f(k){for(var j=0;j<d.length;j++){if(d[j].oid==k){return d[j]}}return null}function a(i){if(!("undefined"===typeof Tick.getClosedPrice)){if(i.flag!=1){i.closedprice=Tick.getClosedPrice(i.prdid,i.tradedir);i.closedprice=Math.round(i.closedprice*100)/100}else{i.closedprice=i.UAprice}if(i.flag==1&&i.closedprice==0){i.profit=0;i.netprofit=i.interest}else{if(i.tradedir==0){i.profit=(i.closedprice-i.doneprice)*(i.lot*i.tradeunit)}if(i.tradedir==1){i.profit=(i.doneprice-i.closedprice)*(i.lot*i.tradeunit)}i.netprofit=i.profit+i.interest}}i.margin=parseFloat(i.lot)*getUserMargin(i.code)}AccountPositions.refresh=function(m){for(var k=0;k<d.length;k++){var j=d[k];if(!(typeof m==="undefined")){var l=0;if(m=="022"){l=0}else{if(m=="023"){l=1}}if(j.prdid!=l){continue}}a(j);AccountPositions.onUpdateOrder(j)}c()};socket.listeners.$add({tick:function(j,m){for(var l=0;l<j+1;l++){var k=m[l];AccountPositions.refresh(k.symbol)}},PosItem:function(i,j){h(i);c()},MarketBuildRet:function(i,j){if(i.code==0){h(i);c()}},MarketCloseRet:function(j,l){if(j.code==0){var k=j.targetoid;var i=f(k);if(i!=null){if(j.lot==i.lot){g(k)}else{i.lot=Util.accSub(i.lot,j.lot);i.margin=Util.accSub(i.margin,j.margin);h(i)}c()}}},ForceClosedPos:function(j,l){for(var k=0;k<j.num;k++){g(l[""+k].targetoid)}c()},interest_notify:function(j,l){for(var k=0;k<j.num;k++){e(l[""+k])}},ClosedPos:function(k,m){for(var l=0;l<PendingOrder.orders.length;l++){var j=PendingOrder.orders[l];if(k.targetoid==j.oid){b(j);break}}}})});var AccountSummary={onUpdate:function(a){}};$(function(){var c={prdid:0,tradedir:0,lot:0,openedprice:0,closedprice:0,profit:0,interest:0,netprofit:0,margin:0,tradeunit:0,totalInvest:0};var a=jQuery.extend(true,{},c);var f=jQuery.extend(true,{},c);var e=jQuery.extend(true,{},c);c.prdid=0;c.tradedir=0;a.prdid=0;a.tradedir=1;f.prdid=1;f.tradedir=0;e.prdid=1;e.tradedir=1;var j=[c,a,f,e];var h=jQuery.extend(true,{},c);var g=jQuery.extend(true,{},c);var q=jQuery.extend(true,{},c);var p=jQuery.extend(true,{},c);h.prdid=0;h.tradedir=0;g.prdid=0;g.tradedir=1;q.prdid=1;q.tradedir=0;p.prdid=1;p.tradedir=1;var b=[h,g,q,p];var l=0;var r=0;function s(t){t.summaries=j.slice(0);t.urSummaries=b.slice(0);t.goldBuild=c;t.goldClose=a;t.silverBuild=f;t.silverClose=e;t.investTotalAmount=l;t.investTotalProfitLoss=r}function m(t){for(var v=0;v<j.length;v++){var u=j[v];if(t.prdid==u.prdid&&t.tradedir==u.tradedir){return j[v]}}return null}function d(t){for(var v=0;v<b.length;v++){var u=b[v];if(t.prdid==u.prdid&&t.tradedir==u.tradedir){return b[v]}}return null}function o(){var t=j.concat(b);for(var u=0;u<t.length;u++){t[u].lot=0;t[u].openedprice=0;t[u].closedprice=0;t[u].profit=0;t[u].interest=0;t[u].netprofit=0;t[u].margin=0;t[u].tradeunit=0;t[u].totalInvest=0}}function k(){l=0;r=0;for(var u=0;u<j.length;u++){var t=j[u];if(t.lot==0){continue}if(!("undefined"===typeof Tick.getClosedPrice)){t.closedprice=Tick.getClosedPrice(t.prdid,t.tradedir);l+=t.closedprice*t.lot*t.tradeunit;r+=t.netprofit}}}function i(){o();var w=AccountPositions.orders;if(!("undefined"===typeof w)){for(var v=0;v<w.length;v++){var t=w[v];var u=null;if(t.flag==1){u=d(t)}else{u=m(t)}u.totalInvest+=Util.accMul(t.lot,t.doneprice);u.lot=Util.accAdd(u.lot,t.lot);u.openedprice=Util.accDiv(u.totalInvest,u.lot);u.interest=Util.accAdd(u.interest,t.interest);u.margin=Util.accAdd(u.margin,t.margin);u.tradeunit=t.tradeunit;u.profit=Util.accAdd(u.profit,t.profit);u.netprofit=Util.accAdd(u.netprofit,t.netprofit)}}}socket.listeners.$add({tick:function(t,u){i();k();s(AccountSummary);AccountSummary.onUpdate()}});socket.listeners.$after({PosItem:function(t,u){i();k();s(AccountSummary);AccountSummary.onUpdate()},MarketBuildRet:function(t,u){i();k();s(AccountSummary);AccountSummary.onUpdate()},MarketCloseRet:function(t,u){i();k();s(AccountSummary);AccountSummary.onUpdate()}})});var accountBaseInfo={balance:0,netValue:0,availDisposableCapital:0,availWithdrawCapital:0,floatPl:0,marginLevel:0,cutMargin:0,warnratio:0,userstatus:0,goldinimargin:0,silverinimargin:0,lockedcredit:0,comlpatedLoad:false,onUpdate:function(a){}};$(function(){var a=0;var d=0;var f=0;var p=0;var l=0;var g=0;var k=0;var e=0;var r=0;var h=0;var s=0;var m=0;var c=0;var q=0;var o=false;function t(){accountBaseInfo.balance=a;accountBaseInfo.netValue=d;accountBaseInfo.availDisposableCapital=f;accountBaseInfo.availWithdrawCapital=p;accountBaseInfo.floatPl=l;accountBaseInfo.marginLevel=g;accountBaseInfo.cutMargin=(r!=0)?r:k;accountBaseInfo.warnratio=(h!=0)?h:e;accountBaseInfo.userstatus=s;accountBaseInfo.goldinimargin=m;accountBaseInfo.silverinimargin=c;accountBaseInfo.lockedcredit=q;accountBaseInfo.comlpatedLoad=o}function j(){if(AccountPositions.orders==undefined||AccountPositions.orders==null){return 0}var v=[];for(var y=0;y<AccountPositions.orders.length;y++){var w=AccountPositions.orders[y];var B={prdid:w.prdid,marginPerUnit:Util.accDiv(w.margin,w.lot)};var z=null;for(var x=0;x<v.length;x++){if(Util.isEqual(B,v[x].type)){z=v[x];break}}if(z==null){z={type:B,buy:0,sell:0};v.push(z)}if(w.tradedir==0){z.buy+=w.margin}if(w.tradedir==1){z.sell+=w.margin}}var C=0;for(var y=0;y<v.length;y++){var z=v[y];var A=0;var u=0;if(z.buy<z.sell){A=z.buy;u=z.sell-z.buy}else{A=z.sell;u=z.buy-z.sell}C+=((A*0.5)+u)}return C}function i(){if(!("undefined"===typeof AccountSummary.summaries)){var w=AccountSummary.summaries.concat(AccountSummary.urSummaries);var x=0;for(var v=0;v<w.length;v++){var u=w[v];x+=u.netprofit}l=Util.fixToStrTwodecimal(x);f=j();p=Util.fixToStrTwodecimal(a+x-f);d=Util.fixToStrTwodecimal(a+x);if(f==0){g="--"}else{g=Util.fixToStrTwodecimal(Util.accMul(Util.accDiv(d,f),100))}}}var b=false;socket.listeners.$add({OrderEnd:function(u,v){if(b==true){return}b=true;setTimeout(function(){var w=function(x,y){i();t();accountBaseInfo.onUpdate()};w();socket.listeners.$after({tick:w,PosItem:w,MarketBuildRet:w,MarketCloseRet:w});o=true},500)}});socket.listeners.$add({AccBasInfo:function(u,v){a=u.credit;q=u.lockedcredit;h=u.warnratio;r=u.minratio;s=u.userstatus;m=u.goldinimargin;c=u.silverinimargin;q=u.lockedcredit;i();t();accountBaseInfo.onUpdate()},balance_change:function(u,v){a=u.credit;q=u.lockedcredit;i();t();accountBaseInfo.onUpdate()},trade_config_notify:function(u,v){e=u.warnratio;k=u.minratio;t();accountBaseInfo.onUpdate()}})});var PendingOrder={orders:[],onAddOrder:function(a,b){},onUpdateOrder:function(a,b){},onDeleteOrder:function(a){},getOptypeByOid:function(b){for(var a=0;a<PendingOrder.orders.length;a++){if(b==PendingOrder.orders[a].oid){return PendingOrder.orders[a].optype}}return""}};$(function(){var e=[];var b=[];function d(){PendingOrder.orders=e.slice(0)}function a(j,k){var o=false;console.log("order id:"+j.oid+",  roid:"+j.roid+" , optype:"+j.optype);if(Util.isEmpty(j.oid)&&Util.isEmpty(j.roid)){return}if((j.validflag==1||j.validflag==2)&&j.positiondir==1){if(k){j.roid=k[0].oid}else{j.roid=j.oid}}for(var l=0;l<e.length;l++){if(j.oid==e[l].oid){o=true;var p=e[l].targetoid;var m=e[l].roid;e[l]=j;if(p){e[l].targetoid=p}if(m){e[l].roid=m}PendingOrder.onUpdateOrder(j,k);break}}if(!o&&j!=null&&typeof j!="undefined"){e.push(j);PendingOrder.onAddOrder(j,k)}d()}function h(k){var l=-1;var m=false;for(l=0;l<e.length;l++){if(k==e[l].oid){m=true;break}}if(m==true){var j=e[l];e.splice(l,1);PendingOrder.onDeleteOrder(j.oid)}d()}function c(l){for(var k=0;k<e.length;k++){var j=e[k];if(l==j.oid){j.tradestatus=1;PendingOrder.onUpdateOrder(j);break}}d()}function g(j){var l=false;for(var k=0;k<b.length;k++){if(j.oid==b[k].oid){l=true;b[k]=j;break}}if(!l){b.push(j)}}function f(l){var j=null;var k=-1;var m=false;for(k=0;k<b.length;k++){if(l==b[k].roid){m=true;break}}if(m==true){j=b[k];b.splice(k,1)}return j}socket.listeners.$add({OrderItem:function(j,l){if(j.validflag!=1&&j.validflag!=2){a(j)}else{if(Util.isNotBlank(j.roid)){g(j)}else{var i=f(j.oid);if(i!=null){var k=[i,j];a(k[0],k);a(k[1],k)}}}},AdvOrderRet:function(i,j){if(i.code==0){a(j["0"],j);a(j["1"],j)}},PendingOrderRet:function(i,j){if(i.code==0){a(i)}},CancelOrderRet:function(i,j){if(i.code==0){h(i.oid)}else{i.tradestatus=-1;a(i)}},ModifyOrderRet:function(i,j){if(i.code==0){a(i)}},PosItem:function(i,j){c(i.targetoid)},ClosedPos:function(i,j){c(i.targetoid)}})});var DynamicUpdates={records:[],onAdd:function(a){},clear:function(){console.log("clear dynamicUpdates records.");while(this.records.length>0){this.records.pop()}this.onClear()},onClear:function(){}};$(function(){var a=[];var c=[];function f(){DynamicUpdates.records=a.slice(0)}function j(l){c.push(l)}function h(m){var o=-1;var p=false;for(o=0;o<c.length;o++){if(m==c[o].oid){p=true;break}}if(p==true){var l=c[o];c.splice(o,1);return l}return}function i(m){var o=-1;var p=false;for(o=0;o<c.length;o++){if(m==c[o].oid){p=true;break}}if(p==true){var l=c[o];return l}return}function g(m){var l="";switch(m){case 0:l=i18n.dynamic.marketprice;break;case 1:l=i18n.dynamic.limitprice;break;case 2:l=i18n.dynamic.stop;break;case 3:l=i18n.dynamic.autoreplace;break;default:l=""}return l}function k(B,r,q,A,z,s,x,t,w,m){var v=true;if(t==1||t==2){if(m==0){v=true}else{if(m==1){v=false}else{if(Util.isNotBlank(w)){v=true}else{v=false}}}}else{if(Util.isNotBlank(r)){v=false}}var y="";if($.isArray(x)){for(var u=0;u<x.length;u++){var l=x[u];if(l!=0){if(y.length>0){y+=i18n.dynamic.or}y+="@"+Util.fixToStrTwodecimal(l)}}}else{y="@"+Util.fixToStrTwodecimal(x)}var o;if(t==1||t==2){o=i18n.dynamic.advpending+(v?i18n.dynamic.openposition:i18n.dynamic.closeposition)+"#"+Util.simpleOid(q)+" "+((A==0)?i18n.dynamic.buy:i18n.dynamic.sell)+Util.fixToStrTwodecimal(z)+"*"+((s==0)?i18n.dynamic.llg:i18n.dynamic.lls)+y}else{o=g(B)+(v?i18n.dynamic.openposition:i18n.dynamic.closeposition)+"#"+Util.simpleOid(q)+" "+((A==0)?i18n.dynamic.buy:i18n.dynamic.sell)+Util.fixToStrTwodecimal(z)+"*"+((s==0)?i18n.dynamic.llg:i18n.dynamic.lls)+y}return o}function d(l){console.log("Add dynamicUpdates record",l);a.unshift(l);f();DynamicUpdates.onAdd(l)}function b(m){console.log("getValidFlag:"+m);for(var l in c){var o=c[l];if(o.oid==m){return o.validflag}}return 0}var e=false;socket.listeners.$add({OrderEnd:function(l,m){if(e==true){return}e=true;socket.listeners.$add({MarketBuildRet:function(o,p){j(o);if(o.code==0){var q={time:o.time,status:i18n.dynamic.done,message:k(0,o.targetoid,o.oid,o.tradedir,o.lot,o.prdid,o.doneprice)};d(q)}},MarketCloseRet:function(p,q){if(p.code==0){var o=h(p.oid);var r={time:p.closedtime,status:i18n.dynamic.done,message:k(0,p.targetoid,p.oid,p.tradedir,p.lot,p.prdid,p.closedprice)};d(r)}},ForceClosedPos:function(p,r){for(var q in r){var o=h(r[q].oid);var s={time:r[q].closedtime,status:i18n.dynamic.done,message:k(r[q].optype,r[q].targetoid,r[q].oid,r[q].tradedir,r[q].lot,r[q].prdid,r[q].closedprice)};d(s)}},OrderItem:function(o,q){j(o);var p=i18n.dynamic.wait;if(o.validflag==1){p=i18n.dynamic.invalid}else{p=(o.tradestatus==1)?i18n.dynamic.done:i18n.dynamic.wait}var r={time:o.time,status:p,message:k(o.optype,o.targetoid,o.oid,o.tradedir,o.lot,o.prdid,[o.limitprice,o.price],o.validflag,o.roid,o.positiondir)};d(r)},PendingOrderRet:function(o,p){if(o.code==0){j(o);var q={time:o.time,status:i18n.dynamic.wait,message:k(o.optype,o.targetoid,o.oid,o.tradedir,o.lot,o.prdid,[o.limitprice,o.price],b(o.oid),o.targetoid,o.positiondir)};d(q)}},CancelOrderRet:function(p,q){if(p.code==0){var o=h(p.oid);if(!o){o=p}var r={time:p.time,status:i18n.dynamic.cancel,message:k(o.optype,o.targetoid,o.oid,o.tradedir,o.lot,o.prdid,[p.limitprice,p.price],p.validflag,p.roid,p.positiondir)};d(r)}else{if(Util.isNotEmpty(p.oid)){var o=i(p.oid);if(o){var r={time:p.time,status:i18n.dynamic.cancel,message:k(o.optype,o.targetoid,o.oid,o.tradedir,o.lot,o.prdid,o.limitprice)};d(r)}}}},ModifyOrderRet:function(o,p){if(o.code==0){j(o);var q={time:o.time,status:i18n.dynamic.altered,message:k(o.optype,o.targetoid,o.oid,o.tradedir,o.lot,o.prdid,[o.limitprice,o.price])};d(q)}},ClosedPos:function(o,q){if(o.code==0&&o.targetoid!=""){var p=PendingOrder.getOptypeByOid(o.targetoid);if(""!=p){j(o);var r={time:o.closedtime,status:i18n.dynamic.done,message:k(p,o.targetoid,o.targetoid,o.tradedir,o.lot,o.prdid,o.closedprice)};d(r)}}},PosItem:function(o,q){if(o.code==0&&o.targetoid!=""){var p=PendingOrder.getOptypeByOid(o.targetoid);if(""!=p){j(o);var r={time:o.time,status:i18n.dynamic.done,message:k(p,"",o.targetoid,o.tradedir,o.lot,o.prdid,o.doneprice,b(o.targetoid),o.oid,0)};d(r)}}},AdvOrderRet:function(o,s){if(o.code==0){for(var q=0;q<o.num;q++){var p=r(s[q].oid);j(s[q]);var t={time:s[q].time,status:(p)?i18n.dynamic.altered:(s[q].validflag==1)?i18n.dynamic.invalid:((s[q].tradestatus==1)?i18n.dynamic.done:i18n.dynamic.wait),message:k(s[q].optype,s[q].targetoid,s[q].oid,s[q].tradedir,s[q].lot,s[q].prdid,(s[q].optype==3)?[s[q].limitprice,s[q].price]:(s[q].optype==1)?s[q].limitprice:s[q].price,s[q].validflag,s[q].roid,s[q].positiondir)};d(t)}}function r(v){for(var u in c){var w=c[u];if(w.oid==v){return true}}return false}}})}})});$(function(){var f=$("#index_lang").val()=="zh_CN"?"":"-tw";function b(i){if(i=="022"){$("#box_022_bid").html(Util.fixToStrTwodecimal(Tick.gold.ask));$("#box_022_ask").html(Util.fixToStrTwodecimal(Tick.gold.bid));$("#box_022_low").html(Util.fixToStrTwodecimal(Tick.gold.priceLow));$("#box_022_high").html(Util.fixToStrTwodecimal(Tick.gold.priceHigh));$("#box_022_localTime").html(Util.timestampToHHMMSS(Tick.gold.time));$("#box_022_spread").html(Tick.gold.spread);var h=(Tick.gold.bidTrend==0)?"bs-jiaqian lls-box-fon5"+f+" fl":((Tick.gold.bidTrend>0)?"bs-jiaqian lls-box-fon3"+f+" fl":"bs-jiaqian lls-box-fon1"+f+" fl");var g=(Tick.gold.askTrend==0)?"bs-count lls-box-fon6"+f+" fr":((Tick.gold.askTrend>0)?"bs-count lls-box-fon4"+f+" fr":"bs-count lls-box-fon2"+f+" fr");$("#box_022_bid").parent("p").attr("class",h);$("#box_022_ask").parent("p").attr("class",g);if(!("undefined"===typeof Tick.gold.symbol.buyinterest)){$("#box_022_buyinterest").html(Tick.gold.symbol.buyinterest)}if(!("undefined"===typeof Tick.gold.symbol.buyinterest)){$("#box_022_sellinterest").html(Tick.gold.symbol.sellinterest)}}if(i=="023"){$("#box_023_bid").html(Util.fixToStrTwodecimal(Tick.silver.ask));$("#box_023_ask").html(Util.fixToStrTwodecimal(Tick.silver.bid));$("#box_023_low").html(Util.fixToStrTwodecimal(Tick.silver.priceLow));$("#box_023_high").html(Util.fixToStrTwodecimal(Tick.silver.priceHigh));$("#box_023_localTime").html(Util.timestampToHHMMSS(Tick.silver.time));$("#box_023_spread").html(Tick.silver.spread);var h=(Tick.silver.bidTrend==0)?"bs-jiaqian lls-box-fon5"+f+" fl":((Tick.silver.bidTrend>0)?"bs-jiaqian lls-box-fon3"+f+" fl":"bs-jiaqian lls-box-fon1"+f+" fl");var g=(Tick.silver.askTrend==0)?"bs-count lls-box-fon6"+f+" fr":((Tick.silver.askTrend>0)?"bs-count lls-box-fon4"+f+" fr":"bs-count lls-box-fon2"+f+" fr");$("#box_023_bid").parent("p").attr("class",h);$("#box_023_ask").parent("p").attr("class",g);if(!("undefined"===typeof Tick.silver.symbol.buyinterest)){$("#box_023_buyinterest").html(Tick.silver.symbol.buyinterest)}if(!("undefined"===typeof Tick.silver.symbol.buyinterest)){$("#box_023_sellinterest").html(Tick.silver.symbol.sellinterest)}}}function e(h,g){if(h==0&&g==0){$("#trade_swicth_div1_llg,#trade_swicth_div2_llg").show();$("#timer_div1_llg,#timer_div2_llg").hide();isSymbolSessionLLG=false}else{if(h==0&&g==1){$("#trade_swicth_div1_llg,#trade_swicth_div2_llg").hide()}}if(h==1&&g==0){$("#trade_swicth_div1_lls,#trade_swicth_div2_lls").show();$("#timer_div1_lls,#timer_div2_lls").hide();isSymbolSessionLLS=false}else{if(h==1&&g==1){$("#trade_swicth_div1_lls,#trade_swicth_div2_lls").hide()}}}function a(h,g,i){if(h){if(i=="0"){llgTimerflagCount++;$("#timer_div1_llg,#timer_div2_llg").show();$("#trade_swicth_div1_llg,#trade_swicth_div2_llg").hide();j(g,"timer_time_llg",llgTimerflagCount)}else{if(i=="1"){llsTimerflagCount++;$("#timer_div1_lls,#timer_div2_lls").show();$("#trade_swicth_div1_lls,#trade_swicth_div2_lls").hide();j(g,"timer_time_lls",llsTimerflagCount)}}}else{if(i=="0"){$("#timer_div1_llg,#timer_div2_llg").hide()}if(i=="1"){$("#timer_div1_lls,#timer_div2_lls").hide()}}function j(k,p,q){var l=new Date(SystemTime.time);var r=k.getTime()-l.getTime();if(r>=0){var m=parseInt(r/1000/60/60,10);var o=parseInt(r/1000/60%60,10);var t=parseInt(r/1000%60,10);m=s(m);o=s(o);t=s(t);if(p=="timer_time_llg"&&q==llgTimerflagCount){$("#"+p).text(m+":"+o+":"+t);setTimeout(function(){j(k,p,q)},1000)}else{if(p=="timer_time_lls"&&q==llsTimerflagCount){$("#"+p).text(m+":"+o+":"+t);setTimeout(function(){j(k,p,q)},1000)}}}else{$("#"+p).text("00:00:00")}function s(u){if(u<10){u="0"+u}return u}}}function d(g){var j=g.begintime.toDate();var k=new Date(SystemTime.time);var h=j.getTime()-k.getTime();if(h>0){if(g.prdid=="0"){isSymbolSessionLLG=false}else{if(g.prdid=="1"){isSymbolSessionLLS=false}}a(true,j,g.prdid);setTimeout(i,h)}else{if(g.prdid=="0"){isSymbolSessionLLG=true}else{if(g.prdid=="1"){isSymbolSessionLLS=true}}}function i(){a(false,null,g.prdid);if(g.prdid=="0"){isSymbolSessionLLG=true}else{if(g.prdid=="1"){isSymbolSessionLLS=true}}}}function c(g){var i=g.endtime.toDate();var j=new Date(SystemTime.time);var h=i.getTime()-j.getTime();if(h<86400000){setTimeout(k,h)}function k(){if(g.prdid=="0"){isSymbolSessionLLG=false}else{if(g.prdid=="1"){isSymbolSessionLLS=false}}for(var m in symbolTradeArray){var p=symbolTradeArray[m];if(p.endtime!=undefined){var l=p.endtime.toDate();var o=new Date();if(l<o){e(p.prdid,0)}}}}}socket.listeners.$add({tick:function(g,j){for(var h=0;h<g+1;h++){b(j[h].symbol)}}});socket.listeners.$add({AmsSymbolSessionList:function(g,h){setSymbolTradeArray(g);e(g.prdid,g.status);if(isLogined&&g.status==1){d(g);c(g)}else{socket.listeners.$add({OrderEnd:function(){if(g.status==1){d(g);c(g)}}})}}});socket.listeners.$add({SymbolList:function(g,j){for(var h=0;h<g.num;h++){var k=j[""+h];if(k.prdcode=="022"){e(0,k.tradestatus)}if(k.prdcode=="023"){e(1,k.tradestatus)}}QuotationGTS.refreshMarketAndPendingTradeDialog(j)}})});$(function(){var c={gold:{prdcode:"022",prdname:i18n.llg,newP:"---",ask:"---",bid:"---",open:"---",high:"---",low:"---",lastclose:"---",change:"---",changePercent:"---",buyinterest:"---",sellinterest:"---",localtime:"---"},silver:{prdcode:"023",prdname:i18n.lls,newP:"---",ask:"---",bid:"---",open:"---",high:"---",low:"---",lastclose:"---",change:"---",changePercent:"---",buyinterest:"---",sellinterest:"---",localtime:"---"}};var a=new Object2Array({prdname:function(e){return e},ask:function(e){return e},bid:function(e){return e},newP:function(e){return e},high:function(e){return e},low:function(e){return e},open:function(e){return e},lastclose:function(e){return e},sellinterest:function(e){return e},buyinterest:function(e){return e},change:function(e){return e},changePercent:function(e){return e},localtime:function(e){return e},prdcode:function(e){return e+"00"}});function b(g){var l=d(g);if(l==null){return}$("#symbol"+g+"Price").html(l.newP);$("#symbol"+g+"PriceChange").html(l.change);var o=$("#quotationTableId").dataTable();var e=o.fnGetNodes();for(var h=0;h<e.length;h++){var f=e[h];var m=o.fnGetData(f);if(m[13].substring(0,3)==g){var k=o.fnGetPosition(f);m=a.toArray(l);o.fnUpdate(m,k);if($("#quotationTableId").attr("tip")=="open"){var j=$("#quotationTableId [symbol='"+g+"']").html();$("#tick2ListTip [symbol='"+g+"']").html(j);break}}}}function d(g){var m={};var i={};if(g=="022"){m=c.gold;i=Tick.gold}else{if(g=="023"){m=c.silver;i=Tick.silver}else{return null}}m.newP=Util.fixToStrTwodecimal(i.price);m.open=(i.open!=0)?Util.fixToStrTwodecimal(i.open):"---";m.high=Util.fixToStrTwodecimal(i.priceHigh);m.low=Util.fixToStrTwodecimal(i.priceLow);m.lastclose=(i.lastClose!=0)?Util.fixToStrTwodecimal(i.lastClose):"---";if(i.lastClose!=0){var e=i.ask-i.lastClose;var l=(e>0)?"maij-fon2":(e<0)?"maij-fon1":"maij-fon3";m.ask='<span class="'+l+'" onclick="QuotationGTS.callModifyFun(\''+g+"', 1);\">"+Util.fixToStrTwodecimal(i.ask)+"</span>";var j=i.bid-i.lastClose;var f=(j>0)?"maij-fon2":(j<0)?"maij-fon1":"maij-fon3";m.bid='<span class="'+f+'" onclick="QuotationGTS.callModifyFun(\''+g+"', 0);\">"+Util.fixToStrTwodecimal(i.bid)+"</span>";var k=i.price-i.lastClose;m.change=Util.fixToStrTwodecimal(k);if(k>0){m.change='<font color = "green">'+m.change+"</font>"}else{if(k<0){m.change='<font color = "red">'+m.change+"</font>"}}var h=(i.price-i.lastClose)*100/i.price;m.changePercent=Util.fixToStrTwodecimal(h);if(h>0){m.changePercent='<font color = "green">'+m.changePercent+"%</font>"}else{if(h<0){m.changePercent='<font color = "red">'+m.changePercent+"%</font>"}}}m.buyinterest=("undefined"===typeof i.symbol.buyinterest)?"---":Util.fixToStrTwodecimal(i.symbol.buyinterest*100)+"%";m.sellinterest=("undefined"===typeof i.symbol.buyinterest)?"---":Util.fixToStrTwodecimal(i.symbol.sellinterest*100)+"%";m.localtime=Util.timestampToHHMMSS(i.time);return m}socket.listeners.$add({tick:function(e,g){for(var f=0;f<e+1;f++){b(g[f].symbol)}}});socket.listeners.$after({quote_query:function(f,e){if(c.gold.open=="---"){b(c.gold.prdcode)}if(c.silver.open=="---"){b(c.silver.prdcode)}}});$("#quotationTableId").dataTable({aaData:a.toArrays([c.gold,c.silver]),bPaginate:false,bFilter:false,bInfo:false,bAutoWidth:false,asStripeClasses:["","tr-bg"],fnRowCallback:function(g,f,e){$(g).attr("symbol",f[13]);return g}})});$(function(){$("#accountPositions").html('<table id="accountPositionsTable"  cellpadding="0" cellspacing="0" class="liebiao-tabox weituo-tabox"></table>');var a=$("#accountPositionsTable").dataTable({aaData:[],aoColumns:[{sTitle:"",sClass:"ta-le"},{sTitle:i18n.acposition.orderno,sClass:"ta-le"},{sTitle:i18n.acposition.ct,sClass:"ta-le"},{sTitle:i18n.acposition.buysell},{sTitle:i18n.acposition.lot},{sTitle:i18n.acposition.openprice},{sTitle:i18n.acposition.closeprice},{sTitle:i18n.acposition.pl},{sTitle:i18n.acposition.interest},{sTitle:i18n.acposition.netpl},{sTitle:i18n.acposition.unit},{sTitle:i18n.acposition.margin},{sTitle:i18n.acposition.opentime}],sScrollY:"198px",sScrollX:"100%",bScrollCollapse:false,bPaginate:false,bFilter:false,bInfo:false,bAutoWidth:false,aaSorting:[[1,"desc"]],asStripeClasses:["","tr-bg"],oLanguage:{sEmptyTable:" "}});$("#accountPositions th").unbind("click");function e(f,g){if(f){return'<font color="red">'+g+"</font>"}else{return g}}var d=new Object2Array({operations:function(f,g){if(g.lot>0&&g.flag!=1){return'<ul class="weit-list"><li><a id="ClosePos'+g.oid+'" href="javascript:">'+i18n.closeposition+"</a></li></ul>"}else{return""}},oid:function(f,g){return e((g.flag==1),Util.simpleOid(f))},prdid:function(f,g){return e((g.flag==1),(f==0)?i18n.llg:i18n.lls)},tradedir:function(f,g){return e((g.flag==1),(f==0)?i18n.buy:i18n.sell)},lot:function(f,g){return e((g.flag==1),Util.fixToStrTwodecimal(f))},doneprice:function(f,g){return e((g.flag==1),Util.fixToStrTwodecimal(f))},closedprice:function(f,g){if(g.flag==1&&g.closedprice==0){return e((g.flag==1),"--")}else{if(g.flag==1){return'<font color="red">'+Util.fixToStrTwodecimal(f)+"</font>"}else{if(g.profit>0){return'<font color="green">'+Util.fixToStrTwodecimal(f)+"</font>"}else{if(g.profit<0){return'<font color="red">'+Util.fixToStrTwodecimal(f)+"</font>"}else{return Util.fixToStrTwodecimal(f)}}}}},profit:function(f,g){if(g.flag==1&&g.closedprice==0){return e((g.flag==1),"--")}else{return e((g.flag==1),Util.fixToStrTwodecimal(f))}},interest:function(f,g){return e((g.flag==1),Util.fixToStrTwodecimal(f))},netprofit:function(f,g){if(g.flag==1&&g.closedprice==0){return e((g.flag==1),"--")}else{return e((g.flag==1),Util.fixToStrTwodecimal(f))}},tradeunit:function(f,g){return e((g.flag==1),Util.fixToStrTwodecimal(f*g.lot))},margin:function(f,g){return e((g.flag==1),Util.fixToStrTwodecimal(f))},time:function(f,g){return e((g.flag==1),Util.getSimpleTime(f,"yyyy-MM-dd hh:mm:ss"))}});function c(f){var g=f;this.close=function(){CloseCommon.closePost(g)}}AccountPositions.onAddOrder=function(f){var g=d.toArray(f);if(a!=null&&a!=undefined){a.fnAddData(g,true);$("#ClosePos"+f.oid).click(new c(f).close)}};AccountPositions.onUpdateOrder=function(h){var p="";if(bodyShow==true){p=$("#accountPositions").parent().css("display")}if(p!="none"){var f=a.fnGetNodes();for(var m=0;m<f.length;m++){var g=f[m];var l=a.fnGetData(g);if(Util.isSameOid(Util.html2Text(l[1]),h.oid)){var o=a.fnGetPosition(g);l=d.toArray(h);for(var j=1;j<l.length;j++){a.fnUpdate(l[j],o,j,false,false)}var q=$("#ClosePos"+h.oid);q.unbind("click");q.click(new c(h).close);break}}}};AccountPositions.onDeleteOrder=function(k){var f=a.fnGetNodes();for(var h=0;h<f.length;h++){var j=f[h];var l=a.fnGetData(j);if(Util.isSameOid(Util.html2Text(l[1]),k)){var g=a.fnGetPosition(j);a.fnDeleteRow(g);break}}};var b=false;socket.listeners.$after({OrderEnd:function(f,g){if(b==true){return}b=true;setTimeout(function(){a.fnAdjustColumnSizing()},500)}})});$(function(){var a=new Object2Array({prdid:function(b){return(b==0)?i18n.llg:i18n.lls},tradedir:function(b){return(b==0)?i18n.buy:i18n.sell},buglot:function(b,c){return(c.tradedir==0)?Util.fixToStrTwodecimal(c.lot):""},selllot:function(b,c){return(c.tradedir==1)?Util.fixToStrTwodecimal(c.lot):""},openedprice:function(b){return Util.fixToStrTwodecimal(b)},closedprice:function(b,c){if(c.profit>0){return'<font color="green">'+Util.fixToStrTwodecimal(b)+"</font>"}else{if(c.profit<0){return'<font color="red">'+Util.fixToStrTwodecimal(b)+"</font>"}else{return Util.fixToStrTwodecimal(b)}}},profit:function(b){return Util.fixToStrTwodecimal(b)},interest:function(b){return Util.fixToStrTwodecimal(b)},netprofit:function(b){return Util.fixToStrTwodecimal(b)},margin:function(b){return Util.fixToStrTwodecimal(b)},tradeunit:function(b,c){return Util.fixToStrTwodecimal(b*c.lot)}});AccountSummary.onUpdate=function(){var g=$("#accountSummary").parent().css("display");if(g!="none"){var e=AccountSummary.summaries;var f=$("#accountSummaryTable").dataTable();f.fnClearTable();for(var c=0;c<e.length;c++){var b=e[c];if(b.lot==0){continue}f.fnAddData(a.toArray(b),true);function d(i){var h=i;this.close=function(){Alert("click  #Close"+h.prdid+h.tradedir)}}$("#Close"+b.prdid+b.tradedir).click(new d(b).close)}}};$("#accountSummary").html('<table id="accountSummaryTable"  cellpadding="0" cellspacing="0" class="liebiao-tabox weituo-tabox"></table>');$("#accountSummaryTable").dataTable({aaData:[],aoColumns:[{sTitle:i18n.accountsummary.ct},{sTitle:i18n.accountsummary.buysell},{sTitle:i18n.accountsummary.buylot},{sTitle:i18n.accountsummary.selllot},{sTitle:i18n.accountsummary.openprice},{sTitle:i18n.accountsummary.closeprice},{sTitle:i18n.accountsummary.pl},{sTitle:i18n.accountsummary.interest},{sTitle:i18n.accountsummary.netpl},{sTitle:i18n.accountsummary.margin},{sTitle:i18n.accountsummary.unit}],sScrollY:"198px",sScrollX:"100%",bScrollCollapse:false,bPaginate:false,bFilter:false,bInfo:false,bAutoWidth:false,asStripeClasses:["","tr-bg"],oLanguage:{sEmptyTable:" "}});$("#accountSummary th").unbind("click")});$(function(){var b=$("#accountBaseInfo");var a=false;accountBaseInfo.onUpdate=function(){var d=accountBaseInfo;b.find("#balance").html(Util.fixToStrTwodecimal(d.balance));b.find("#netValue").html(d.netValue);b.find("#availDisposableCapital").html(Util.fixToStrTwodecimal(d.availDisposableCapital));b.find("#availWithdrawCapital").html(d.availWithdrawCapital);b.find("#floatPl").html(d.floatPl);b.find("#marginLevel").html((d.marginLevel=="--"||d.warnratio*100<d.marginLevel)?d.marginLevel:'<font color="red">'+d.marginLevel+"</font>");b.find("#cutMargin").html(Util.fixToStrTwodecimal(d.cutMargin*100));if(d.comlpatedLoad){if(d.marginLevel!="--"&&d.warnratio*100>d.marginLevel){if(a==false){a=true;var c=SystemCookie.getMarginLevel();if(Util.isBlank(c)){$("#marginLevelWarning").show();SystemCookie.setMarginLevel(true);setTimeout(function(){$("#marginLevelWarning").hide()},5000)}}}else{a=false}}};$("#marginLevelWarning").hide();$("#marginLevelWarningConfirm").click(function(){$("#marginLevelWarning").hide()})});$(function(){$("#dialog:ui-dialog").dialog("destroy");$("#marketAndPendingOrderDiv").dialog({closeOnEscape:false,resizable:false,autoOpen:false,minWidth:315,width:315,closable:true,modal:true});$("#advance_close_limitPrice,#advance_open_orderVolumeInput,#advance_open_limitPrice,#advance_open_stopPrice,#advance_close_stopPrice").blur(function(){var a=$(this).val();$(this).val(a.replace(/[^\d.]/g,""))})});openTradeWindowDiv=function(a){enableTradeLi();marketAndOrderObj.isSubmittingMarket=false;marketAndOrderObj.isResponseMarket=false;marketAndOrderObj.isSubmittingorder=false;marketAndOrderObj.isResponseorder=false;marketAndOrderObj.isAllowCloseTradeWindow=true;showCloseBtn("#marketAndPendingOrderDiv");marketAndOrderObj.setMarketAndPendingOrderData(a);$("#trade-prd-name").html(marketAndOrderObj.produceName);initMarketDiv(a);initPendingOrderDiv(a);changeToMarketDiv();FocusManage.dialogFocus("#marketAndPendingOrderDiv","#marketTable");hideCloseBtn("#marketAndPendingOrderDiv");hideVolList()};hideVolList=function(){$("ul[id$=VolumeSel]").hide()};changeToMarketDiv=function(){hideVolList();$("#marketLi").addClass("on-na");$("#pendingOrderLi").removeClass("on-na");$("#pendingOrderLi").html(i18n.tradeCommon_title);$("#marketTable").show();$("#marketP").show();$("#pendingOrderTable").hide();$("#pendingOrderP").hide();$("#submitedSuccessMarketTable").hide();$("#marketC").hide();$("#submitedSuccessPendingOrderTable").hide();$("#submitedSuccessAdvancePendingOrderTable").hide();$("#submitedFailedAdvancePendingOrderTable").hide();$("#pendingOrderC").hide();$("#advance_pendingOrderC").hide();$("#submitedFailMarketTable").hide();$("#marketFC").hide();$("#submitedFailedPendingOrderTable").hide();$("#pendingOrderFC").hide();$("#advance_pendingOrderFC").hide();$("#advamcePendingOrderP").hide()};changeToPendingOrderDiv=function(){hideVolList();$("#pendingOrderLi").addClass("on-na");$("#pendingOrderLi").html(i18n.tradeCommon_title);$("#marketLi").removeClass("on-na");$("#pendingOrderTable").show();$("#pendingOrderP").show();$("#marketTable").hide();$("#marketP").hide();$("#submitedSuccessMarketTable").hide();$("#marketC").hide();$("#submitedSuccessPendingOrderTable").hide();$("#submitedSuccessAdvancePendingOrderTable").hide();$("#submitedFailedAdvancePendingOrderTable").hide();$("#pendingOrderC").hide();$("#submitedFailMarketTable").hide();$("#marketFC").hide();$("#submitedFailedPendingOrderTable").hide();$("#pendingOrderFC").hide();var a=getPendingOrderTypeValue();if(a==OrderType.BUY_advance||a==OrderType.SELL_advance){$("#pendingOrderP").hide();$("#advamcePendingOrderP").show()}else{$("#pendingOrderP").show();$("#advamcePendingOrderP").hide()}};refreshTrade=function(){if(marketAndOrderObj&&marketAndOrderObj.symbol!=null){var a=getSymbol4Code(marketAndOrderObj.symbol);refreshMarketDiv(a);refreshPendingOrderDiv(a)}};clearTradeData=function(){amsSymbolConfigInfo={};marketAndOrderObj.clear();QuotationGTS.currentSymbolKey=""};closeWindowDiv=function(a){if(marketAndOrderObj.isAllowCloseTradeWindow){$(a).dialog("close");clearTradeData()}};_setVolumeList=function(h,g,e,c){var b="";if(marketAndOrderObj.volumeListSize==0){$(c).hide();$(c).next("span").addClass("shous-lay-con2-nd");$(g).addClass("sel-shous-inp-nd");$(g).val(Util.fixToStr(marketAndOrderObj.minimalVolume));marketAndOrderObj.defaultVolume=Util.fixToStr(marketAndOrderObj.minimalVolume)}else{$(c).show();$(c).next("span").removeClass("shous-lay-con2-nd");$(g).removeClass("sel-shous-inp-nd");var a=false;var f=marketAndOrderObj.volumeLotinfo;for(var d=0;d<marketAndOrderObj.volumeListSize;d++){if(f[d]==marketAndOrderObj.minimalVolume){b+="<li tv='"+f[d]+"' class='sxc-lihov'>"+Util.fixToStr(f[d])+"</li>";$(g).val(Util.fixToStr(f[d]));marketAndOrderObj.defaultVolume=Util.fixToStr(f[d]);a=true}else{b+="<li tv='"+f[d]+"'>"+Util.fixToStr(f[d])+"</li>"}}if(!a){$(g).val(Util.fixToStr(marketAndOrderObj.minimalVolume))}}$(h).children().remove();$(h).append(b);$(e).html(Util.fixToStr(marketAndOrderObj.minimalVolume)+"-"+Util.fixToStr(marketAndOrderObj.maximalVolume));$("li",h).on("click",function(){$(this).parent("ul").hide();$(g).val($(this).attr("tv"));if(h=="#omVolumeSel"){calculateOMMargin($(this).attr("tv"))}else{if(h=="#orderVolumeSel"){calculatePendingMargin($(this).attr("tv"),"pendingMargin")}else{if(h=="#advance_open_orderVolumeSel"){calculateAdvancePendingMargin($(this).attr("tv"))}}}})};_validateVolume=function(c){var b=marketAndOrderObj.minimalVolume;var a=marketAndOrderObj.maximalVolume;var e=$(c).val();var d=Util.accMul(marketAndOrderObj.volumeStep,100);if(e==b){return true}if(e==null||isNaN(e)||Util.getDecimalLen(e)>2){Alert(i18n.trade.volumeValid.format(marketAndOrderObj.volumeStep));return false}if(e<b||e>a){Alert(i18n.trade["10119"].format(b,a));return false}if(e!=marketAndOrderObj.defaultVolume){if(Util.accMul(e,100)%d!=0){Alert(i18n.trade.volumeValid.format(marketAndOrderObj.volumeStep));return false}}return true};calculateInvestmentQuotaStep=function(){var d=marketAndOrderObj.investmentQuotaMin;var c=marketAndOrderObj.investmentQuotaMax;var b=Util.roundUp((c-d)/100,0);var a=Util.roundUp(b,-Util.getIntLen(b));return a};calculateInvestmentQuota=function(e,d,b,g,f){var c=$(d).spinner({numberFormat:"n",step:marketAndOrderObj.investmentQuotaStep,min:0,mix:99999});var i=parseFloat(marketAndOrderObj.investmentQuotaMin).toFixed(2);var a=parseFloat(marketAndOrderObj.investmentQuotaMax).toFixed(2);if(marketAndOrderObj.isInvestment){var h=parseFloat(marketAndOrderObj.positionOrder.amount).toFixed(2);if(parseFloat(h)<parseFloat(i)){c.spinner("disable");$(b).show();$(b).attr("checked",false);$(f).hide();$(d).val(h);$(g).html(i+"-"+a)}else{if(parseFloat(h)>parseFloat(a)){c.spinner("disable");$(b).hide();$(f).hide();$(d).val(h);$(g).html(i+"-"+a)}else{$(d).val(h);marketAndOrderObj.investmentQuotaMin=h;c.spinner("disable");$(b).show();$(f).hide();$(b).attr("checked",false);$(g).html(h+"-"+a)}}}else{$(d).val(i);c.spinner("enable");$(b).hide();$(f).hide();$(g).html(i+"-"+a)}return c};refreshInvestmentQuota=function(e,d,b,c){if(marketAndOrderObj.isInvestment){var a=parseFloat(marketAndOrderObj.positionOrder.amount).toFixed(2);if(parseFloat(a)<parseFloat(marketAndOrderObj.investmentQuotaMin)){$(d).show();$(e).spinner("disable");if($(d).is(":checked")){$(e).spinner("enable")}else{$(e).spinner("disable")}$(c).html(marketAndOrderObj.investmentQuotaMin+"-"+marketAndOrderObj.investmentQuotaMax)}else{if(parseFloat(a)>parseFloat(marketAndOrderObj.investmentQuotaMax)){$(e).spinner("disable");$(d).hide();$(b).hide();$(c).html(marketAndOrderObj.investmentQuotaMin+"-"+marketAndOrderObj.investmentQuotaMax)}else{if(parseFloat(a)!=parseFloat($(c).html().split("-")[0])){$(e).val(a)}$(c).html(a+"-"+marketAndOrderObj.investmentQuotaMax);$(d).show()}}}else{if(parseFloat(marketAndOrderObj.investmentQuotaMin)!=parseFloat($(c).html().split("-")[0])){$(e).val(marketAndOrderObj.investmentQuotaMin)}$(c).html(marketAndOrderObj.investmentQuotaMin+"-"+marketAndOrderObj.investmentQuotaMax)}};disableTradeLi=function(){$("#marketLi").off();$("#pendingOrderLi").off();$("#marketLi").css("color","#ccc");$("#pendingOrderLi").css("color","#ccc")};enableTradeLi=function(){$("#marketLi").on("click",changeToMarketDiv);$("#pendingOrderLi").on("click",changeToPendingOrderDiv);$("#marketLi").css("color","");$("#pendingOrderLi").css("color","")};hideCloseBtn=function(a){$(".ui-dialog-titlebar-close",$(a).parent()).hide()};showCloseBtn=function(a){};initBaseSpinnerById=function(a){$(a).spinner({numberFormat:"n"})};_validateInvestmentQuota=function(k,e,g,f){var d=$(k).spinner("value");if(d==null||isNaN(d)||Util.getDecimalLen(d)>2){Alert(i18n.trade.investmentValid.format($(e).html()));return false}var h=parseFloat(d);var j=parseFloat($(e).html().split("-")[0]);var b=parseFloat($(e).html().split("-")[1]);if(marketAndOrderObj.isInvestment){var i=parseFloat(marketAndOrderObj.positionOrder.amount);if(h!=i){if(!_commonInvestmentQuotaAlert(h,j,b,e)){return false}}if(i<j){if(marketAndOrderObj.isPosition){var l=parseInt(marketAndOrderObj.positionOrder.type);var a=parseFloat(marketAndOrderObj.positionOrder.handNum);var c=parseFloat($(f).val());if((g=="0"&&l==2)||(g=="1"&&l==1)){if(c<=a){return true}else{if(!_commonInvestmentQuotaAlert(h,j,b,e)){return false}}}else{if(!_commonInvestmentQuotaAlert(h,j,b,e)){return false}}}else{if(!_commonInvestmentQuotaAlert(h,j,b,e)){return false}}}else{if(i>b){return true}else{if(!_commonInvestmentQuotaAlert(h,j,b,e)){return false}}}}else{if(!_commonInvestmentQuotaAlert(h,j,b,e)){return false}}return true};_commonInvestmentQuotaAlert=function(c,d,b,a){if(c<d||parseFloat(c)>b){Alert(i18n.trade.investmentValid.format($(a).html()));return false}return true};checkIsMoreThan60sAfterSubmit=function(){if(marketAndOrderObj.isSubmittingorder&&!marketAndOrderObj.isResponseorder){showCloseBtn("#marketAndPendingOrderDiv");marketAndOrderObj.isSubmittingorder=false;marketAndOrderObj.isResponseorder=true;marketAndOrderObj.isAllowCloseTradeWindow=true;$("#pendingOrderErrorMessage").html(WebUIError[10116]);$("#submitedFailedPendingOrderTable").show();$("#pendOrderPreSubmittingMsg").hide();$("#pendOrderSuccessMsg").hide();$("#pendingOrderFC").show();$("#submitedSuccessPendingOrderTable").hide();$("#submitedSuccessAdvancePendingOrderTable").hide();$("#submitedFailedAdvancePendingOrderTable").hide();$("#pendingOrderC").hide();$("#pendingOrderTable").hide();$("#pendingOrderP").hide()}else{if(marketAndOrderObj.isSubmittingMarket&&!marketAndOrderObj.isResponseMarket){showCloseBtn("#marketAndPendingOrderDiv");marketAndOrderObj.isSubmittingMarket=false;marketAndOrderObj.isResponseMarket=true;marketAndOrderObj.isAllowCloseTradeWindow=true;$("#marketErrorMessage").html(WebUIError[10116]);$("#marketPreSubmittingMsg").hide();$("#marketSuccessMsg").hide();$("#submitedFailMarketTable").show();$("#submitedSuccessMarketTable").hide();$("#marketC").hide();$("#marketFC").show();$("#marketTable").hide();$("#marketP").hide()}}};$(function(){var a=new Object2Array({oid:function(b){return Util.simpleOid(b)},prdid:function(b){return(b==0)?i18n.llg:i18n.lls},tradedir:function(b){return(b==1)?i18n.buy:i18n.sell},lot:function(b){return Util.fixToStrTwodecimal(b)},openedprice:function(b){return b},closedprice:function(b){return b},_profit:function(b,c){return Util.fixToStrTwodecimal(c.profit-c.interest)},interest:function(b){return Util.fixToStrTwodecimal(b)},profit:function(b){return Util.fixToStrTwodecimal(b)},tradeunit:function(b,c){return Util.fixToStrTwodecimal(b*c.lot)},cashback:function(b){return Util.fixToStrTwodecimal(b)},openedtime:function(b){return Util.getSimpleTime(b,"yyyy-MM-dd hh:mm:ss")},closedtime:function(b){return Util.getSimpleTime(b,"yyyy-MM-dd hh:mm:ss")}});socket.listeners.$add({ClosedPos:function(b,c){var c=a.toArray(b);$("#closedPositionTable").dataTable().fnAddData(c)},MarketCloseRet:function(b,c){if(b.code==0){var c=a.toArray(b);$("#closedPositionTable").dataTable().fnAddData(c)}},ForceClosedPos:function(b,c){if(b.code==0){var d=a.toArray(c[0]);$("#closedPositionTable").dataTable().fnAddData(d)}}});$("#closedPosition").html('<table id="closedPositionTable"  cellpadding="0" cellspacing="0" class="liebiao-tabox weituo-tabox"></table>');$("#closedPositionTable").dataTable({aaData:[],aoColumns:[{sTitle:i18n.closedposition.cid,sClass:"ta-le"},{sTitle:i18n.closedposition.ct,sClass:"ta-le"},{sTitle:i18n.closedposition.buysell},{sTitle:i18n.closedposition.lot},{sTitle:i18n.closedposition.openprice},{sTitle:i18n.closedposition.closeprice},{sTitle:i18n.closedposition.pl},{sTitle:i18n.closedposition.interest},{sTitle:i18n.closedposition.netpl},{sTitle:i18n.closedposition.unit},{sTitle:i18n.closedposition.coupon},{sTitle:i18n.closedposition.opentime,sClass:"ta-le"},{sTitle:i18n.closedposition.closetime,sClass:"ta-le"}],sScrollY:"198px",sScrollX:"100%",bScrollCollapse:false,bPaginate:false,bFilter:false,bInfo:false,bAutoWidth:false,aaSorting:[[0,"desc"]],asStripeClasses:["","tr-bg"],oLanguage:{sEmptyTable:" "}})});$(function(){var a=new Object2Array({operation:function(b,c){if(c.tradestatus==0){return'<ul class="weit-list"><li><a id="EditPO'+c.oid+'" href="javascript:">修改</a></li><li><a id="CanclePO'+c.oid+'" href="javascript:" >取消</a></li></ul>'}else{return""}},oid:function(b){return Util.simpleOid(b)},prdid:function(b){return(b==0)?i18n.llg:i18n.lls},positiondir:function(b){return(b==0)?i18n.pendingorder.openposition:i18n.pendingorder.closeposition},tradedir:function(b){return(b==0)?i18n.buy:i18n.sell},lot:function(b){return Util.fixToStrTwodecimal(b)},limitprice1:function(b,c){return(c.optype==1||c.optype==3)?Util.fixToStrTwodecimal(c.limitprice):"--"},limitprice2:function(b,c){return(c.optype==2||c.optype==3)?Util.fixToStrTwodecimal(c.price):"--"},tradestatus:function(c,d){if(d.validflag==1){return i18n.pendingorder.invalid}else{var b="";if(c==1){b=i18n.pendingorder.done}if(c==-1){b=i18n.pendingorder.cancel}if(c==0){b=i18n.pendingorder.wait}return b}},validtype:function(b){return(b==0)?i18n.pendingorder.day:i18n.pendingorder.week},time:function(b){return Util.getSimpleTime(b,"yyyy-MM-dd hh:mm:ss")},targetoid:function(b){return Util.simpleOid(b)},roid:function(b,c){return((c.targetoid)||(c.positiondir==1&&(c.validflag==1||c.validflag==2)))?Util.simpleOid(b):""}});PendingOrder.onAddOrder=function(b,c){var d=a.toArray(b);$("#pendingOrderTables").dataTable().fnAddData(d);$("#EditPO"+b.oid).click(function(){QuotationGTS.callModifyPendingOrderFun(b,c)});$("#CanclePO"+b.oid).click(function(){QuotationGTS.callCancelPendingOrderFun(b,c)})};PendingOrder.onUpdateOrder=function(b,d){var j=$("#pendingOrderTables").dataTable();var c=j.fnGetNodes();for(var f=0;f<c.length;f++){var g=c[f];var h=j.fnGetData(g);if(Util.isSameOid(Util.html2Text(h[1]),b.oid)){var e=j.fnGetPosition(g);h=a.toArray(b);j.fnUpdate(h,e,undefined,false,false);break}}$("#EditPO"+b.oid).click(function(){QuotationGTS.callModifyPendingOrderFun(b,d)});$("#CanclePO"+b.oid).click(function(){QuotationGTS.callCancelPendingOrderFun(b)})};PendingOrder.onDeleteOrder=function(f){var h=$("#pendingOrderTables").dataTable();var b=h.fnGetNodes();for(var d=0;d<b.length;d++){var e=b[d];var g=h.fnGetData(e);if(Util.isSameOid(Util.html2Text(g[1]),f)){var c=h.fnGetPosition(e);h.fnDeleteRow(c);break}}};$("#pendingOrders").html('<table id="pendingOrderTables"  cellpadding="0" cellspacing="0" class="liebiao-tabox weituo-tabox"></table>');$("#pendingOrderTables").dataTable({aaData:[],aoColumns:[{sTitle:"",sClass:"ta-le"},{sTitle:i18n.pendingorder.oid,sClass:"ta-le"},{sTitle:i18n.pendingorder.unit,sClass:"ta-le"},{sTitle:i18n.pendingorder.ct,sClass:"ta-le"},{sTitle:i18n.pendingorder.buysell},{sTitle:i18n.pendingorder.lot},{sTitle:i18n.pendingorder.limitprice},{sTitle:i18n.pendingorder.lost},{sTitle:i18n.pendingorder.status},{sTitle:i18n.pendingorder.limittime},{sTitle:i18n.pendingorder.ordertime},{sTitle:i18n.pendingorder.relatedid},{sTitle:i18n.pendingorder.remark}],sScrollY:"198px",sScrollX:"100%",bScrollCollapse:false,bPaginate:false,bFilter:false,bInfo:false,bAutoWidth:false,aaSorting:[[1,"desc"]],asStripeClasses:["","tr-bg"],oLanguage:{sEmptyTable:" "}});$("#pendingOrders th").unbind("click")});$(function(){var a=new Object2Array({time:function(b){return Util.getSimpleTime(b,"yyyy-MM-dd hh:mm:ss")},status:function(b){return b},message:function(b){return b}});DynamicUpdates.onAdd=function(b){$("#lastDynamicUpdate").html(Util.getSimpleTime(b.time,"yyyy-MM-dd hh:mm:ss")+"&nbsp;&nbsp;"+b.status+"&nbsp;&nbsp;"+b.message);var c=$("#dynamicUpdatesTable").dataTable();c.fnClearTable();c.fnAddData(a.toArrays(DynamicUpdates.records))};DynamicUpdates.onClear=function(){var b=$("#dynamicUpdatesTable").dataTable();b.fnClearTable()};$("#dynamicUpdates").html('<table id="dynamicUpdatesTable"  cellpadding="0" cellspacing="0" class="liebiao-tabox weituo-tabox"></table>');$("#dynamicUpdatesTable").dataTable({aaData:[],aoColumns:[{sTitle:i18n.dynamic.time},{sTitle:i18n.dynamic.status},{sTitle:i18n.dynamic.info}],sScrollY:"198px",sScrollX:"100%",bScrollCollapse:false,bPaginate:false,bFilter:false,bInfo:false,bAutoWidth:false,aaSorting:[[0,"desc"],[1,"desc"]],asStripeClasses:["","tr-bg"],oLanguage:{sEmptyTable:" "}});$("#dynamicUpdates th").unbind("click")});var SystemTime={};$(function(){var e=0;var b=0;var g=0;var a=0;socket.listeners.$add({servertime:function(i,k){var j=new Date().getTime();b=j;e=i.time*1000}});function f(){d();h()}function d(){var i=new Date().getTime();if(a>0&&(a>i||a+5000<i)){b+=i-a}g=(i-b)+e;a=i;$("#sp_service_time").html(Util.getSimpleTime(g,"hh:mm:ss"));c();setTimeout(d,1000)}function c(){SystemTime.time=g}function h(){socket.emit("request",65807,{param1:0});setTimeout(h,60*1000)}f()});var SystemConnection={login:false,status:"disconnect"};$(function(){socket.listeners.$before({tick:function(b,c){SystemConnection.updateConnectStatus("connect")},OrderEnd:function(b,c){SystemConnection.login=true}});SystemConnection.updateConnectStatus=function(b){SystemConnection.status=b;a()};function a(){var b=SystemConnection.status;Global.connectStatus=b;if(b=="connect"){$("#sp_conn_status").html(i18n.connStatusFine);$("#sp_conn_status").parent().removeClass("frtimt-red");$("#sp_conn_status").prev().addClass("dn")}else{if(b=="disconnect"){$("#sp_conn_status").html(i18n.connStatusFail);$("#sp_conn_status").parent().addClass("frtimt-red");$("#sp_conn_status").prev().removeClass("dn")}}}});var QuotationGTS={symbolKey:"prdcode",headers:new Array(),currentSymbolKey:"",dynamicsNames:["newP","localTime","spread","bid","ask","low","high","buyinterest","sellinterest","lastbid","lastask"],init:function(a,b){b.length=a.num;this.setSymbolArray(b);this.getLastTick()},setSymbolArray:function(b){if(b){for(var a=0;a<b.length;a++){c(b[a]["prdcode"]);if(b[a]["prdcode"]=="022"){b[a]["prdname"]=i18n.llg}else{if(b[a]["prdcode"]=="023"){b[a]["prdname"]=i18n.lls}else{b[a]["prdname"]="--"}}b[a].ask="";b[a].bid="";b[a].newP="";b[a].low="";b[a].high="";symbolArray.push(b[a])}}function c(f){for(var d in symbolArray){var e=symbolArray[d];if(e.prdcode==f){symbolArray.splice(d,1);break}}}},refreshMarketAndPendingTradeDialog:function(b){if($("#marketAndPendingOrderDiv").dialog("isOpen")){if(Number(b.length)===1&&b[0].prdcode===marketAndOrderObj.prdcode){marketAndOrderObj.refreshMarketAndPendingOrderData(b[0]);_setVolumeList("#omVolumeSel","#omVolumeInput","#volumeRange","#omVolumeSelSpan",true);_setVolumeList("#orderVolumeSel","#orderVolumeInput","#orderVolumeRange","#orderVolumeSelSpan",true);_setVolumeList("#advance_open_orderVolumeSel","#advance_open_orderVolumeInput","#advance_open_orderVolumeRange","#advance_open_orderVolumeSelSpan",true)}refreshTransactionRange("transactionRange","transactionRangeSpan");var d=getUserMargin(marketAndOrderObj.prdcode);var c=parseFloat($("#omVolumeInput").val())*d;$("#omMargin").html(c);var a=parseFloat($("#orderVolumeInput").val())*d;$("#pendingMargin").html(a);$("#advance_open_pendingMargin").html(a);marketAndOrderObj.orderspread=b[0].orderspread;marketAndOrderObj.maxrange=b[0].maxrange;marketAndOrderObj.maxmprange=b[0].maxmprange;marketAndOrderObj.limitspread=b[0].limitspread;marketAndOrderObj.triggerspread=b[0].triggerspread}if($("#c_marketAndPendingOrderDiv").dialog("isOpen")){if(Number(b.length)===1&&b[0].prdcode===marketAndOrderObj.prdcode){marketAndOrderObj.refreshMarketAndPendingOrderData(b[0]);_setVolumeList("#c_omVolumeSel","#c_omVolumeInput","#c_volumeRange","#c_omVolumeSelSpan",true);_setVolumeList("#c_orderVolumeSel","#c_orderVolumeInput","#c_orderVolumeRange","#c_orderVolumeSelSpan",true)}refreshTransactionRange("c_transactionRange","c_transactionRangeSpan");marketAndOrderObj.orderspread=b[0].orderspread;marketAndOrderObj.maxrange=b[0].maxrange;marketAndOrderObj.maxmprange=b[0].maxmprange;marketAndOrderObj.limitspread=b[0].limitspread;marketAndOrderObj.triggerspread=b[0].triggerspread}},getLastTick:function(){var b={};var c=getSymbolArray();if(c){for(var a=0;a<c.length;a++){b[a]=c[a]["prdcode"]}socket.emit("request",Constant.CMD_LAST_TICK,b)}},getOpenClosePrice:function(){for(var a in QuotationGTS.symbolSeq){socket.emit("request",Constant.CMD_QUOTE_QUERY,{time:0,num:2,period_num:1,period_type:3,flag:0,symbol:a,seq:QuotationGTS.symbolSeq[a]})}},saveTickToSymbol:function(b){if(b==null){return}var a=this.getSymbolArrayByPrdcode(b.prdcode);if(a==null||a==undefined){return}a.lastask=a.ask;a.lastbid=a.bid;a.ask=b.ask;a.bid=b.bid;a.dtime=b.time;if(a.prdcode==this.currentSymbolKey){refreshMarketDiv(a);refreshPendingOrderDiv(a);refreshModifyPendingOrderDiv(a);refreshModifyAdvPendingOrderDiv(a)}},getSymbolArrayByPrdcode:function(b){var c=getSymbolArray();if(c){for(var a=0;a<c.length;a++){if(c[a]["source"]==b||c[a]["prdcode"]==b){return c[a]}}}},clearQuotationArray:function(){this.currentSymbolKey=""},callModifyFun:function(c,a){if(isHoliday||isWeekend){Alert(WebUIError["10113"]);return false}if(accountBaseInfo.userstatus==4){Alert(WebUIError["10120"]);return false}var b=this.getSymbolArrayByPrdcode(c);if(!isSymbolTradeOpen(b.prdid)){alert(WebUIError["10113"]);return false}try{if(b){b.buySell=a;this.currentSymbolKey=b[this.symbolKey];openTradeWindowDiv(b);b=null}}catch(d){alert("line 1054, error:"+d)}},callModifyPendingOrderFun:function(a,e){if(isHoliday||isWeekend){Alert(WebUIError["10113"]);return false}if(accountBaseInfo.userstatus==4){Alert(WebUIError["10120"]);return false}if(!isSymbolTradeOpen(a.prdid)){Alert(WebUIError["10113"]);return false}var c=a.prdid;var d=getPrdCodeByPrdId(c);var b=this.getSymbolArrayByPrdcode(d);this.currentSymbolKey=b[this.symbolKey];openModifyTradeWindowDiv(a,e,b)},callCancelPendingOrderFun:function(b,a,c){if(isHoliday||isWeekend){Alert(WebUIError["10113"]);return false}if(accountBaseInfo.userstatus==4){Alert(WebUIError["10120"]);return false}if(!isSymbolTradeOpen(b.prdid)){Alert(WebUIError["10113"]);return false}cancelPendingOrder(b,a,c)},callCancelPendingOrderWithoutConfirm:function(a,b){if(isHoliday||isWeekend){Alert(WebUIError["10113"]);return false}if(accountBaseInfo.userstatus==4){Alert(WebUIError["10120"]);return false}if(!isSymbolTradeOpen(a[0].prdid)){Alert(WebUIError["10113"]);return false}cancelPendingOrdersRequest(a,b)}};$(function(){socket.listeners.$after({tick:function(a,e){for(var d=0;d<a+1;d++){var c=e[d];var b=Tick.$get(c.symbol);QuotationGTS.saveTickToSymbol(b)}}})});$(function(){Report.btnEventBind()});var Report={tmpData:null,pageCount:10,transCodeMap:{NETPAY:"存款",MDEPOSIT:"存款",CANCELDRAW:"存款",WITHDRAW:"取款",PC:"盈亏",FEE:"手续费",FEE_MA_FAULT:"手续费",FEE_MA_DEPOSIT:"手续费",FEE_MA_WITH:"手续费",FEE_MA_CLEAR:"手续费",FEE_MA_TRANSFER:"手续费",FEE_MA_ST:"手续费",FEE_MA_COMMIS:"手续费",FEE_MA_WPRICE:"手续费",FEE_MA_OTHER:"手续费",FEE_MONEYADJUST:"手续费",BET_YJ:"佣金",PC_YJ:"佣金",SYSCLEARZERO:"系统清零",CASH_BACK:"回赠金额",COUPON_IN:"代币优惠",COUPON_OUT:"代币到期",AC_DRAW:"自動取消取款",FEE_SYSADJUST:"特殊金额调整",PRESENT:"優惠",TRANS_OUT:"轉賬",TRANS_IN:"轉賬",CGSE_FEE:"交易编码費",MISPAID_PAYMENT:"補繳交易編碼費",PC_CB:"返佣",BFN:"贈金",BFA:"贈金"},init:function(){this.initArray()},btnEventBind:function(){var a=$("#report_tab_container").children("li");a.on("click",function(){var b=a.index($(this));$(this).addClass("on-na").siblings().removeClass("on-na");$("#report_content_container").children().eq(b).removeClass("dn").siblings().addClass("dn")});$("#report_btn_weituo_search").on("click",{obj:this},this.searchWeituo);$("#report_btn_weituo_download").on("click",{obj:this,id:"report_weituo_where",type:"downloadWeituo"},this.downloadReport);$("#report_btn_trade_search").on("click",{obj:this},this.searchTrade);$("#report_btn_trade_download").on("click",{obj:this,id:"report_trade_where",type:"downloadTradeReport"},this.downloadReport);$("#report_btn_profit_search").on("click",{obj:this},this.searchProfit);$("#report_btn_profit_download").on("click",{obj:this,id:"report_profit_where",type:"downloadProfitReport"},this.downloadReport);$("#report_btn_balance_search").on("click",{obj:this},this.searchBalance);$("#report_btn_balance_download").on("click",{obj:this,id:"report_balance_where",type:"downloadBalanceReport"},this.downloadReport);$("#report_btn_cashback_search").on("click",{obj:this},this.searchCashBack);$("#report_btn_cashback_download").on("click",{obj:this,id:"report_cashback_where",type:"downloadCashBackReport"},this.downloadReport);$("#btn_report_detail_back").on("click",function(){$("#report_detail_table tbody").html("");$("#report_detail_div").hide();$("#report_container_sub").show()})},initArray:function(){$("#report_weituo_table > tbody").html("");$("#report_trade_table > tbody").html("");$("#report_profit_table > tbody").html("");$("[id^='report_profit_subtotal_'],[id^='report_profit_total_']").html("--");$("#report_balance_table > tbody").html("");$("[id^='report_balance_subtotal_'],[id^='report_balance_total_']").html("--");$("#report_cashback_table > tbody").html("");$("#report_cashback_total_01").html("--");$('[id="productId"]').val("");$('[id="dealType"]').val("");$("#cusTranCode").val("");$("#rebateType").val("");var a=Util.getSimpleTime(new Date(),"yyyy-MM-dd");if(typeof SystemTime!="undefined"&&SystemTime!=null){a=Util.getSimpleTime(SystemTime.time,"yyyy-MM-dd")}$('[id$="_beiginTime"]').val(a);$('[id$="_endTime"]').val(a)},downloadReport:function(e){var d=e.data.id;var b=e.data.type;var g=e.data.obj;var f=$("#"+d+" > form").serialize();f=f+"&pageCount="+g.pageCount;var c=document.getElementById("downloadiframe");var a="downloadReport.action?reportType="+b+"&"+f+"&_d="+(new Date()).getTime();$.get(a,function(){c.src=a}).error(function(){this.sessionInvalidLogout()})},showDetailRow:function(c,a){$("#report_detail_table tbody").html("");for(var b=0;b<a.length;b++){$("#report_detail_table tbody").append('<tr><th class="t-bnone">'+$(c+" span").get(b).innerHTML+'</th><td class="t-bnone r-nonebor">'+a[b]+"</td></tr>")}$("#report_detail_title").html($('#report_tab_container li[class="on-na"]').html());$("#report_container_sub").hide();$("#report_detail_div").show()},searchWeituo:function(b){var c=b.data.obj;var a=$("#report_weituo_where > form").serialize();a=a+"&pageCount="+c.pageCount;$.ajax({url:"ReportForm.action?check=ajax&reportType=searchWeituo",data:a+"&_d="+(new Date()).getTime(),timeout:10000,type:"get",success:function(f){var g=f;var e=g==""?0:g.returnObj[0].totalResult;g=g==""?[]:g.returnObj[0].list;var h=new Object2Array({orderId:function(i){return i.substr(i.length-6)},productId:function(i){return(i==0)?i18n.llg:i18n.lls},direction:function(i){return(i=="open")?i18n.openposition:i18n.closeposition},ordertype:function(i){return(i==0)?i18n.report.buy:i18n.report.sell},validflag:function(i,j){if(i==1){return i18n.dynamic.advpending}else{if(j.optype=="1"){return i18n.report.limitPrice}else{if(j.optype=="2"){return i18n.report.stopLoss}else{if(j.optype=="3"){return i18n.report.autoChange}else{if(j.optype=="0"||j.optype=="4"){return i18n.report.marketPrice}else{return""}}}}}},lot:function(i){return Util.isBlank(i)?"--":Util.fixToStrTwodecimal(i)},limitprice:function(i){return Util.isBlank(i)?"--":Util.fixToStrTwodecimal(i)},price:function(i){return(Util.isBlank(i)||i<0.0001)?"--":Util.fixToStrTwodecimal(i)},flag:function(j){var i="";if(j==-1||j==-7||j==-8){i="手动取消"}else{if(j<-1){i="系统取消"}else{i="執行"}}return i},validtype:function(j){var i="";if(j==0){i=i18n.report.effectiveInDate}else{i=i18n.report.effectiveInWeekly}return i},opentime:function(i){if(Util.isEmpty(i)){return""}else{return Util.getSimpleTime(new Date(i.time),"yyyy-MM-dd hh:mm:ss")}},invalidtime:function(i){if(Util.isEmpty(i)){return""}else{return Util.getSimpleTime(new Date(i.time),"yyyy-MM-dd hh:mm:ss")}},borderId:function(i){return i.substr(i.length-6)},closeOrderId:function(i){return i.substr(i.length-6)}}).toArrays(g);$("#report_weituo_table").dataTable({aaData:h,bPaginate:false,bFilter:false,bInfo:false,bDestroy:true,aaSorting:[],fnRowCallback:function(k,j,i){Report.tmpData=j;$(k).on("click",function(){Report.showDetailRow("#report_weituo_title",j)});return k}});var d=Math.ceil(e/c.pageCount);$("#totalPagesWeituo").val(d);$("#report_weituo_table").dataTable().fnAdjustColumnSizing();$(".dataTables_empty").html(i18n.report.noRecord)},error:function(){Alert("Invalid session, please login again!");location.href="Login.action"}})},searchTrade:function(b){var c=b.data.obj;var a=$("#report_trade_where > form").serialize();a=a+"&pageCount="+c.pageCount;$.ajax({url:"ReportForm.action?check=ajax&reportType=searchTradeReport",data:a+"&_d="+(new Date()).getTime(),timeout:10000,type:"get",success:function(g){var h=g;var f=h==""?0:h.returnObj[0].totalResult;h=h==""?[]:h.returnObj[0].list;var d=new Object2Array({tradetime:function(i){if(Util.isEmpty(i)){return""}else{return Util.getSimpleTime(new Date(i.time),"yyyy-MM-dd hh:mm:ss")}},orderid:function(i){return i.substr(i.length-6)},consigntype:function(i){return(i=="open")?i18n.openposition:i18n.closeposition},productcode:function(i){return(i=="022")?i18n.llg:i18n.lls},type1:function(i,j){if(j.advancedConsign=="1"){return"进阶委托"}else{if(j.optype=="1"){return"限价"}else{if(j.optype=="2"){return"停损"}else{if(j.optype=="3"){return"自动替代"}else{if(j.optype=="0"||j.optype=="4"){return"市价"}else{return""}}}}}},ordertype:function(i){return(i==0)?i18n.report.buy:i18n.report.sell},lot:function(i){return Util.fixToStrTwodecimal(i)},tradeprice:function(i){return Util.fixToStrTwodecimal(i)},closeorderid:function(i){return i.substr(i.length-6)},cgse_code:function(i){return(i.indexOf("REJECT")!=-1)?"":i},cgse_fee:function(i){return $.isNumeric(i)&&parseFloat(i)!=0?Util.fixToStrTwodecimal(i)+" USD":""},channel:function(i){return i=="8"?"紧急平仓":""}}).toArrays(h);$("#report_trade_table").dataTable({aaData:d,bPaginate:false,bFilter:false,bInfo:false,bDestroy:true,aaSorting:[],fnRowCallback:function(k,j,i){$(k).on("click",function(){Report.showDetailRow("#report_trade_title",j)});return k}});var e=Math.ceil(f/c.pageCount);$("#totalPagesTrade").val(e);$("#report_trade_table").dataTable().fnAdjustColumnSizing();$(".dataTables_empty").html(i18n.report.noRecord)},error:function(){Alert("Invalid session, please login again!");location.href="Login.action"}})},searchProfit:function(b){var c=b.data.obj;var a=$("#report_profit_where > form").serialize();a=a+"&pageCount="+c.pageCount;$.ajax({url:"ReportForm.action?check=ajax&reportType=searchProfitReport",data:a+"&_d="+(new Date()).getTime(),timeout:10000,type:"get",success:function(g){var h=g;var f=h==""?0:h.returnObj[0].totalResult;var d=h==""?[]:h.returnObj[0];h=h==""?[]:h.returnObj[0].list;var i=new Object2Array({productcode:function(j){return(j=="022")?i18n.llg:i18n.lls},closedprice:function(j){return Util.fixToStrTwodecimal(j)},profit:function(j){return Util.fixToStrTwodecimal(j)},closedtime:function(j){if(Util.isEmpty(j)){return""}else{return Util.getSimpleTime(new Date(j.time),"yyyy-MM-dd hh:mm:ss")}},type1:function(j,k){if(k.advancedConsign=="1"){return i18n.dynamic.advpending}else{if(k.optype=="1"){return i18n.dynamic.limitprice}else{if(k.optype=="2"){return i18n.dynamic.stop}else{if(k.optype=="3"){return i18n.dynamic.autoreplace}else{if(k.optype=="0"||k.optype=="4"){return i18n.dynamic.marketprice}else{return""}}}}}},orderid:function(j){return j.substr(j.length-6)},ordertype:function(j){return(j==0)?i18n.report.sell:i18n.report.buy},lot:function(j){return Util.fixToStrTwodecimal(j)},borderid:function(j){return j.substr(j.length-6)},oldlot:function(j){return Util.fixToStrTwodecimal(j)},openedprice:function(j){return Util.fixToStrTwodecimal(j)},interest:function(j){return Util.fixToStrTwodecimal(j)},cashback:function(j){return(j<0.0001)?"0.00":Util.fixToStrTwodecimal(j)},openedtime:function(j){if(Util.isEmpty(j)){return""}else{return Util.getSimpleTime(new Date(j.time),"yyyy-MM-dd hh:mm:ss")}},remark:function(j){return(j>3||j<0)?"系统平仓":""}}).toArrays(h);$("#report_profit_table").dataTable({aaData:i,bPaginate:false,bFilter:false,bInfo:false,bDestroy:true,aaSorting:[],fnRowCallback:function(l,k,j){$(l).on("click",function(){Report.showDetailRow("#report_profit_title",k)});return l}}).fnAdjustColumnSizing();$("#report_profit_subtotal_01").html(Util.fixToStrTwodecimal(d.pageclosedlot));$("#report_profit_subtotal_02").html(Util.fixToStrTwodecimal(d.pageopenlot));$("#report_profit_subtotal_03").html(Util.fixToStrTwodecimal(d.pageinterest));$("#report_profit_subtotal_04").html(Util.fixToStrTwodecimal(d.pageprofit));$("#report_profit_total_01").html(Util.fixToStrTwodecimal(d.totalclosedlot));$("#report_profit_total_02").html(Util.fixToStrTwodecimal(d.totalopenlot));$("#report_profit_total_03").html(Util.fixToStrTwodecimal(d.totalinterest));$("#report_profit_total_04").html(Util.fixToStrTwodecimal(d.totalprofit));var e=Math.ceil(f/c.pageCount);$("#totalPagesProfit").val(e);$(".dataTables_empty").html(i18n.report.noRecord)},error:function(){Alert("Invalid session, please login again!");location.href="Login.action"}})},searchBalance:function(b){var c=b.data.obj;var a=$("#report_balance_where > form").serialize();a=a+"&pageCount="+c.pageCount;$.ajax({url:"ReportForm.action?check=ajax&reportType=searchBalanceReport",data:a+"&_d="+(new Date()).getTime(),timeout:10000,type:"get",success:function(g){var h=g;var f=h==""?0:h.returnObj[0].totalResult;var d=h==""?[]:h.returnObj[0];h=h==""?[]:h.returnObj[0].list;var i=new Object2Array({jointime:function(j){if(Util.isEmpty(j)){return""}else{return Util.getSimpleTime(new Date(j.time),"yyyy-MM-dd hh:mm:ss")}},code:function(j){return c.transCodeMap[j]},src_amount:function(j){return Util.fixToStrTwodecimal(j)},income:function(j){return Util.fixToStrTwodecimal(j)},expend:function(j){return Util.fixToStrTwodecimal(j)},dst_amount:function(j){return Util.fixToStrTwodecimal(j)},tradeno:function(j){return j.substr(j.length-6)},remark:function(j){return Util.simpleOid(j)}}).toArrays(h);$("#report_balance_table").dataTable({aaData:i,bPaginate:false,bFilter:false,bInfo:false,bDestroy:true,aaSorting:[],fnRowCallback:function(l,k,j){$(l).on("click",function(){Report.showDetailRow("#report_balance_title",k)});return l}}).fnAdjustColumnSizing();$("#report_balance_subtotal_01").html(Util.fixToStrTwodecimal(d.pageincome));$("#report_balance_subtotal_02").html(Util.fixToStrTwodecimal(d.pageexpend));$("#report_balance_total_01").html(Util.fixToStrTwodecimal(d.totalincome));$("#report_balance_total_02").html(Util.fixToStrTwodecimal(d.totalexpend));var e=Math.ceil(f/c.pageCount);$("#totalPagesBalance").val(e);$(".dataTables_empty").html(i18n.report.noRecord)},error:function(){Alert("Invalid session, please login again!");location.href="Login.action"}})},searchCashBack:function(b){var c=b.data.obj;var a=$("#report_cashback_where > form").serialize();a=a+"&pageCount="+c.pageCount;$.ajax({url:"ReportForm.action?check=ajax&reportType=searchCashBackReport",data:a+"&_d="+(new Date()).getTime(),timeout:10000,type:"get",success:function(g){var h=g;var f=h==""?0:h.returnObj[0].totalResult;var d=h==""?[]:h.returnObj[0];h=h==""?[]:h.returnObj[0].list;var i=new Object2Array({temp_method:function(j,k){if(k.cashbacktype==1){if(k.method==1){return"汇赠钱"}else{if(k.method==2){return"网赠钱"}}}else{if(k.cashbacktype==2){if(k.method==1){return"代币优惠"}else{if(k.method==2){return"代币到期"}else{if(k.method==3){return"代币佣金"}else{if(k.method==4){return"代币盈亏"}else{if(k.method==5){return"代币经纪佣金"}}}}}}else{return""}}},ablelot:function(j){return j},ableamount:function(j){return j},temp_tradedate:function(j,k){if(k.cashbacktype==2){if(Util.isEmpty(k.jointime)){return""}else{return Util.getSimpleTime(new Date(k.jointime.time),"yyyy-MM-dd hh:mm:ss")}}else{return""}},amountPL:function(j){return j},backlot:function(j){return j},usedlot:function(j){return j},deadline:function(j){if(Util.isEmpty(j)){return""}else{return Util.getSimpleTime(new Date(j.time),"yyyy-MM-dd")}}}).toArrays(h);$("#report_cashback_table").dataTable({aaData:i,bPaginate:false,bFilter:false,bInfo:false,bDestroy:true,fnRowCallback:function(l,k,j){$(l).on("click",function(){Report.showDetailRow("#report_cashback_title",k)});return l}}).fnAdjustColumnSizing();$("#report_cashback_total_01").html(Util.fixToStrTwodecimal(d.totalAbleamount));var e=Math.ceil(f/c.pageCount);$("#totalPagesCashBack").val(e);$(".dataTables_empty").html(i18n.report.noRecord)},error:function(){Alert("Invalid session, please login again!");location.href="Login.action"}})},sessionInvalidLogout:function(){Alert("Invalid session, please login again!");browserHistory.setKey(browserHistory.logoutKey);location.href="Login.action"},gotoPage:function(g){var c=["searchWeituo","searchTrade","searchProfit","searchBalance","searchCashBack"];var f=0,b=0,e=0,d;$("#report_content_container").children().each(function(a){if($(this).css("display")=="block"){f=a;d=$(this).find("input[name=pangeNo]");e=$(this).find("input[name=pangeNo]").val();b=$(this).find("input[name=totalPages]").val()}});if(e==null){e=1}e=new Number(e);if(g=="first"){e=1}if(g=="pre"){e=e-1;if(e<1){e=1}}if(g=="next"){if(e<b){if(e==b){e=e}else{e=e+1}}else{e=b}}if(g=="last"){e=b}d.val(e);if(c[f]=="searchWeituo"){$("#report_btn_weituo_search").click()}if(c[f]=="searchTrade"){$("#report_btn_trade_search").click()}if(c[f]=="searchProfit"){$("#report_btn_profit_search").click()}if(c[f]=="searchBalance"){$("#report_btn_balance_search").click()}if(c[f]=="searchCashBack"){$("#report_btn_cashback_search").click()}}};var bulletionArray=[];var bulletionArray_temp=[];$(function(){var a=false;socket.listeners.$add({OrderEnd:function(b,c){if(b.code==0){if(a==true){return}a=true;setTimeout(function(){if(isLogined&&bulletionArray.length>0&&$("#index_leftGg").attr("tn")!="true"){$("#btn_menu_bulletin_01").click()}},500)}}})});saveBulletinToArray=function(c){var d={id:c.id,lang:c.lang,flags:c.flags,time:c.time,subject:c.subject,text:c.text,curLang:Global.currentLanguage};if(bulletionArray.length==0){bulletionArray.push(d)}else{var a=false;for(var b=0;b<bulletionArray.length;b++){if(bulletionArray[b]["id"]==c.id){bulletionArray[b]=d;a=true;break}}if(!a){bulletionArray.push(d)}}findBulletinList()};clearBulletinFromArray=function(){bulletionArray=[];bulletionArray_temp=[]};deleteBulletinFromArray=function(b){for(var a=0;a<bulletionArray.length;a++){if(bulletionArray[a].id==b.bulletinid){bulletionArray.remove(a);break}}findBulletinList()};initBulletinAsk=function(){var a=Constant.GT1_LANG_CHINESE_TRAD;if(Global.currentLanguage=="zh_CN"){a=Constant.GT1_LANG_CHINESE_SIMP}if(Global.currentLanguage=="zh_TW"){a=Constant.GT1_LANG_CHINESE_TRAD}};findBulletinList=function(){var a=bulletionArray.length;if(a>0){bulletionArray.sort(compareTo);$("#bulletinUL").show();$("#noRecord").hide();$("#bulletinUL li").remove();var e="",d="";for(var c=0;c<a;c++){var b=bulletionArray[c];if(b.flags==1||i18n.lang!=b.lang){continue}d+="<li style='background:none;padding:6px 0px 6px 2px;'>"+b.text+"&nbsp;&nbsp;&nbsp"+Util.getUTCDate(b.time/1000,"yyyy-MM-dd")+"</li>";e+="<li style='background:none;padding:6px 0px 6px 2px;'>";e+="<p class='gg-time'>"+Util.getUTCDate(b.time/1000,i18n.bulletin.dateFormat)+"</p><p class='gg-coninfo'>"+b.text+"</p>";e+="</li>"}if(e==""){$("#noRecord").show();$("#bulletinUL").hide();$("#newsGong ul li").remove();$("#newsGong ul").append("<li style='background:none;padding:6px 0px 6px 2px;'>"+i18n.bulletin.noRecord+"</li>")}else{$("#bulletinUL").append(e);$("#newsGong ul li").remove();$("#newsGong ul").append(d==""?"<li style='background:none;padding:6px 0px 6px 2px;'>"+i18n.bulletin.noRecord+"</li>":d);$(".gg-coninfo a").each(function(){$(this).attr("target","_blank")})}}else{$("#noRecord").show();$("#bulletinUL").hide();$("#newsGong ul li").remove();$("#newsGong ul").append("<li style='background:none;padding:6px 0px 6px 2px;'>"+i18n.bulletin.noRecord+"</li>")}};compareTo=function(d,c){var f=parseInt(d.time);var e=parseInt(c.time);if(f<e){return 1}else{if(f>e){return -1}else{return 0}}};function bulletionArray_temp_push(){bulletionArray_temp=[];if(bulletionArray.length>0){for(var a=0;a<bulletionArray.length;a++){bulletionArray_temp.push(bulletionArray[a])}}}$(function(){socket.listeners.$add({bulletin_add:function(d,e){bulletionArray_temp_push();saveBulletinToArray(d)}});socket.listeners.$add({bulletin_del:function(d,e){deleteBulletinFromArray(d);bulletionArray_temp_push()}});$("#bulletinNotice").hide();var a=false;$("#bulletinNotice_never").click(function(){$("#bulletinNotice").hide();a=true});$("#bulletinNotice_check").click(function(){$("#bulletinNotice").hide();$("#btn_menu_bulletin_01").click()});function b(){if(a==false){$("#bulletinNotice").show();setTimeout(function(){$("#bulletinNotice").hide()},"8000")}}var c=false;socket.listeners.$after({OrderEnd:function(){if(c==true){return}c=true;if(isLogined&&bulletionArray.length>0){}socket.listeners.$after({bulletin_add:function(d,f){if((d.flags==0||d.flags==2)&&i18n.lang==d.lang){for(var e=0;e<bulletionArray_temp.length;e++){if(bulletionArray_temp[e].id==d.id){return}}b()}}})}})});var WebUiChart={};$(function(){WebUiChart.newsSocketConnected=false;var g={Date:"",Open:0,High:0,Low:0,Close:0,Volume:0};var y=null;var j=600;var m="";var C="";var d=null;var f=null;var A="yyyy-MM-dd hh:mm";var E="yyyy-MM-dd";var u=new STXChart($$("chartContainer"));STXChart.prototype.prepend("headsUpHR",h);STXMenuManager.makeMenus();STXMenuManager.registerChart(u);function q(){g={Date:"",Open:0,High:0,Low:0,Close:0,Volume:0}}WebUiChart.changeChartBySymbol=function(G){if(G.value=="022"||G.value=="023"){if(u.intervalType=="month"){k(G.value)}else{if(u.intervalType=="week"){F(G.value)}else{if(u.intervalType=="daily"){b(G.value)}else{p(C,G.value)}}}WebUiChart.setChartType($("#stx-chart-type-select").val());$("#stx-chart-type-select").val($("#stx-chart-type-select").val());$("#stx-chart-tool-select").val("");c(G.value)}};WebUiChart.init=function(){u.ma05_study={cancelled:false,name:"MA ("+5+","+WebUiChartWords.wordLists.defaultWord.Close+","+WebUiChartWords.wordLists.defaultWord.Simple+")"};u.ma10_study={cancelled:false,name:"MA ("+10+","+WebUiChartWords.wordLists.defaultWord.Close+","+WebUiChartWords.wordLists.defaultWord.Simple+")"};u.ma20_study={cancelled:false,name:"MA ("+20+","+WebUiChartWords.wordLists.defaultWord.Close+","+WebUiChartWords.wordLists.defaultWord.Simple+")"};u.ma30_study={cancelled:false,name:"MA ("+30+","+WebUiChartWords.wordLists.defaultWord.Close+","+WebUiChartWords.wordLists.defaultWord.Simple+")"};u.ma60_study={cancelled:false,name:"MA ("+60+","+WebUiChartWords.wordLists.defaultWord.Close+","+WebUiChartWords.wordLists.defaultWord.Simple+")"};u.macd_study={cancelled:false,name:"MACD ("+12+","+9+","+26+")"};u.setMasterLine(true);WebUiChart.setChartToolCrossHair();WebUiChart.setChartType("candle");b("022");WebUiChart.setChartType("candle");$("#stx-chart-type-select").val("candle");c("022")};function c(G){$("#iconsTitle").hide();$("#symbol_select_pcode").html(G)}function x(K,J){var G=J=="minute"?A:E;var I=[];for(var H=Object.keys(K).length-1;H>=0;H--){var M=K[H];var L=null;if(!M.begin||M.begin<0.1||!M.highest||M.highest<0.1||!M.lowest||M.lowest<0.1||!M.end||M.end<0.1){continue}I.push({Dm:L,Date:Util.getTime(M.tm,G),Open:parseFloat(Util.fixToStrTwodecimal(M.begin)),High:parseFloat(Util.fixToStrTwodecimal(M.highest)),Low:parseFloat(Util.fixToStrTwodecimal(M.lowest)),Close:parseFloat(Util.fixToStrTwodecimal(M.end)),Volume:0})}return I}function r(L,J){if(J=="month"||J=="week"){var H=new Date(L*1000);var K=H.getMonth();var I=H.getFullYear();var G=H.getDate();if(J=="month"){if(H){if(H.getDay()==0){return new Date(I,K+1==12?11:K+1,G-2).getTime()/1000}else{if(H.getDay()==6){return new Date(I,K+1==12?11:K+1,G-1).getTime()/1000}else{return new Date(I,K+1==12?11:K+1,0).getTime()/1000}}}else{return L}}else{if(J=="week"){var H=new Date(L*1000);if(H){return new Date(I,K+1==12?11:K+1,G-1).getTime()/1000}else{return L}}}}else{return L}}function k(G){q();u.intervalType="month";if(Util.isEmpty(G)){G="022"}i(0,60,0,5,{symbol:G},function(H,J){var I=x(J,u.intervalType);if(I&&I[I.length-1]){a(I,G)}})}function F(G){q();u.intervalType="week";if(Util.isEmpty(G)){G="022"}i(0,60,1,4,{symbol:G},function(H,J){var I=x(J,u.intervalType);if(I&&I[I.length-1]){a(I,G)}})}function b(G){q();u.intervalType="daily";if(Util.isEmpty(G)){G="022"}i(0,j,0,3,{symbol:G},function(H,J){var I=x(J,u.intervalType);if(I&&I[I.length-1]){a(I,G);!WebUiChart.chartShowed&&(WebUiChart.chartShowed=true)}})}function p(I,H){q();C=I;q();u.intervalType="minute";var G=1;if(isNaN(I)){G=2;if(I=="1h"){I=1}else{if(I=="4h"){I=4}else{return}}}u.interval=I;lastTickRawDate=null;i(0,j,I,G,{symbol:H},function(J,L){if(L==null){return}var K=x(L,u.intervalType);if(K&&K[K.length-1]){a(K,H);u.setPeriodicityV2(1,"1");u.draw()}})}socket.listeners.$after({tick:function(H,K){var J=$("#symbol-select").val();if(d==null||d.Date==null||f==null||J!=K[0].symbol){return}var I=new Date(K[0].dtime*1000);if("minute"==u.intervalType){if(!w()){g.Date=Util.getTime(K[0].dtime,A,u);g.Open=K[0].newP;g.Low=K[0].newP;g.High=K[0].newP;g.Dt=new Date(K[0].dtime*1000);g.Close=K[0].newP;u.appendMasterData([clone(g)])}else{if(I>=f){f=STXMarket.getNextIntervalStartDate(I,u);g.Date=Util.getTime(f.getTime()/1000,A,u);g.Open=K[0].newP;g.Low=K[0].newP;g.High=K[0].newP;g.Dt=f;g.Close=K[0].newP;u.appendMasterData([clone(g)])}else{if(g.Open==0){g.Open==K[0].newP}g.Low=Math.min(g.Low,K[0].newP);g.High=Math.max(g.High,K[0].newP);g.Dt=f;g.Close=K[0].newP;u.appendMasterData([clone(g)])}}}else{var G=STXMarket.getNextIntervalStartDate(I,u);if(!w()){g.Date=Util.getTime(K[0].dtime,E,u);g.Open=K[0].newP;g.Low=K[0].newP;g.High=K[0].newP;g.Dt=new Date(K[0].dtime*1000);g.Close=K[0].newP;u.appendMasterData([clone(g)])}else{if(I>=G){f=G;G=STXMarket.getNextIntervalStartDate(I,u);g.Date=Util.getTime(G.getTime()/1000,E);g.Open=K[0].newP;g.Low=K[0].newP;g.High=K[0].newP;g.Dt=new Date(K[0].dtime*1000);g.Close=K[0].newP;u.appendMasterData([clone(g)])}else{if(g.Open==0){g.Open==K[0].newP}g.High=Math.max(g.High,K[0].newP);g.Low=Math.min(g.Low,K[0].newP);g.Close=K[0].newP;g.Date=Util.getTime(I.getTime()/1000,E);u.appendMasterData([clone(g)])}}}}});function w(){return g&&g.Date&&g.Open>0&&g.High>0&&g.Low>0&&g.Close>0}function z(G){g.High=G[G.length-1].High;g.Low=G[G.length-1].Low;g.Close=G[G.length-1].Close;g.Open=G[G.length-1].Open;g.Date=G[G.length-1].Date;d=G[G.length-1]}function a(G,H){d=G[G.length-1];f=new Date(d.Dm*1000);u.newChart(H,G);if(!u.ma05_study.cancelled){STXStudies.addStudy(u,"ma",l("5"),o("#58D3F7"),null)}if(!u.ma10_study.cancelled){STXStudies.addStudy(u,"ma",l("10"),o("#FF0000"),null)}if(!u.ma20_study.cancelled){STXStudies.addStudy(u,"ma",l("20"),o("#01DF01"),null)}if(!u.ma30_study.cancelled){STXStudies.addStudy(u,"ma",l("30"),o("#FF8000"),null)}if(!u.ma60_study.cancelled){STXStudies.addStudy(u,"ma",l("60"),o("#7401DF"),null)}if(!u.macd_study.cancelled){STXStudies.addStudy(u,"macd",v("12","9","26"),e("#58D3F7","#FF0000"),null)}if(G.length<60){u.setNumberOfCandle(G.length)}else{u.setNumberOfCandle(60)}z(G)}function l(H){var G={Field:"Close",Period:H,Type:"simple",id:"MA ("+H+","+WebUiChartWords.wordLists.defaultWord.Close+","+WebUiChartWords.wordLists.defaultWord.Simple+")"};return G}function o(G){var H={MA:G};return H}function v(J,I,H){var G={"Fast MA Period":J,"Signal Period":I,"Slow MA Period":H,id:"MACD ("+J+","+I+","+H+")"};return G}function e(G,H){var I={MACD:G,Signal:H};return I}function i(H,L,I,K,G,N){var M={time:H,num:L,period_num:I,period_type:K,flag:0,symbol:"022"};for(var J in G){M[J]=G[J]}newsSocket.listeners.$listenSeq(Constant.CMD_QUOTE_QUERY,M,N)}function B(J,H,G,L){var K={time_outdated:J,time_latest:H};for(var I in G){K[I]=G[I]}newsSocket.listeners.$listenSeq(Constant.CMD_QUOTE_PERIOD_QUERY,K,L)}WebUiChart.changePeriodicity=function(H,G){var I=$("#symbol-select").val();$("[lb=tmclick]").each(function(){if(this.id==G){$(this).attr("class","tp-icon-hov tp-icon-on2")}else{$(this).attr("class","tp-icon-hov")}});if("week"==H){F(I)}else{if("day"==H){b(I)}else{if("month"==H){k(I)}else{p(H,I)}}}};WebUiChart.createStudy=function(){STXStudies.go($$("studyDialog"),u)};WebUiChart.setChartTypeById=function(H){var G=H.value;if(G!=""){WebUiChart.setChartType(G)}};WebUiChart.setChartType=function(G){u.setChartType(G)};WebUiChart.changeToolClass=function(H){var G=$("#"+H).attr("class");if(G=="tp-icon-hov"){$(this).attr("class","tp-icon-hov tp-icon-on2")}else{$(this).attr("class","tp-icon-hov")}};WebUiChart.setChartToolCrossHair=function(){WebUiChart.setVectorType("");WebUiChart.crosshairs(true);$("#stx-chart-tool-select").val("crosshairs")};WebUiChart.setChartToolType=function(H){var G=H.value;if("none"==G){WebUiChart.setVectorType("");WebUiChart.crosshairs(false)}else{if("crosshairs"==G){WebUiChart.setVectorType("");WebUiChart.crosshairs(true)}else{if("clearDrawings"==G){WebUiChart.clearDrawings();WebUiChart.setVectorType("");WebUiChart.crosshairs(false)}else{WebUiChart.setVectorType(G)}}}};WebUiChart.crosshairs=function(G){STXDrawingToolbar.crosshairs(u,G)};WebUiChart.clearDrawings=function(){u.clearDrawings()};WebUiChart.setVectorType=function(G){STXDrawingToolbar.setVectorType(u,G)};WebUiChart.studyDialog=function(I){if(!u||u.chart.dataSet.length==0){return}var H=I.value;var G=I.options[I.selectedIndex].text;I.value="";STXStudies.studyDialog(u,H,$$("studyDialog"));STXDialogManager.displayDialog("studyDialog");$("div#studyDialog div.title").html("<b>"+G+"</b>")};function t(){STXThemeManager.builtInThemes={Light:"stx-demo-theme-1.css",Dark:"stx-demo-theme-2.css"};STXDrawingToolbar.initialize();STXDrawingToolbar.setVectorType(u,null)}WebUiChart.toggleFullScreenMode=function(){var I=$$$(".stx-wrapper");if(window.fullScreenMode){var H=u.chart.maxTicks-u.chart.scroll;I.style.position=null;I.style.left=null;I.style.top=null;I.style.width=null;var G=$$("chartContainer");G.style.height=G.style.prevHeight;G.style.width=G.style.prevWidth;I.style.height=null;I.style.width=null;document.getElementById("display_tick_div").style.display="";document.getElementById("display_balance_div").style.display="";document.getElementById("display_investment_box").style.display="";u.resizeChart();u.chart.scroll=u.chart.maxTicks-H;u.draw()}else{I.style.position="absolute";I.style.left="0px";I.style.top="0px";I.style.width="100%";var G=$$("chartContainer");G.style.prevHeight=G.style.height;G.style.prevWidth=G.style.width;document.getElementById("display_tick_div").style.display="none";document.getElementById("display_balance_div").style.display="none";document.getElementById("display_investment_box").style.display="none";D();u.resizeChart()}window.fullScreenMode=!window.fullScreenMode};function h(){var H=u.tickFromPixel(u.backOutX(STXChart.crosshairX),this.chart);var G=u.layout.crosshair?this.chart.dataSet[H]:this.chart.dataSet[this.chart.dataSet.length-1];$$("huOpen").innerHTML="";$$("huClose").innerHTML="";$$("huHigh").innerHTML="";$$("huLow").innerHTML="";$$("huTime").innerHTML="";if(G!=null){if(G){$$("huTime").innerHTML=G.Date;$$("huOpen").innerHTML=this.formatPrice(G.Open);$$("huClose").innerHTML=this.formatPrice(G.Close);$$("huHigh").innerHTML=this.formatPrice(G.High);$$("huLow").innerHTML=this.formatPrice(G.Low)}}}function D(){if(STX.ipad&&STX.isIOS7){STX.appendClassName($$$("html"),"ipad ios7");$$$("body").style.height=pageHeight()+"px"}var G=$$("chartContainer");var I=$$$(".stx-wrapper");var J=$$$(".stx-panel-side");var K=0;if(J&&J.offsetLeft){K=I.offsetWidth-J.offsetLeft}G.style.width=(I.offsetWidth-K)+"px";var H=0;if($$$(".stx-footer")){H=$$$(".stx-footer").offsetHeight}G.style.height=(pageHeight()-getPos(G).y-H)+"px";I.style.height=(pageHeight()-getPos(I).y-H)+"px";if(u&&u.chart.canvas!=null){u.resizeChart()}}WebUiChart.setLine=function(G,H){STXDrawingToolbar.setLine(G,H)};function s(){if(u&&u.chart.canvas!=null){if(window.fullScreenMode){D()}else{u.resizeChart()}}}WebUiChart.getStxChart=function(){return u};window.onresize=s;t()});var CloseCommon={isAllowCloseTradeWindow:false,isSubmittingMarket:false,isResponseMarket:false,isSubmittingorder:false,isResponseorder:false,_$closePostWindowDiv:null,_create:function(){this._$closePostWindowDiv=$("#c_marketAndPendingOrderDiv")},post:null,closePost:function(c){this.post=c;this.post.prdcode=getPrdCodeByPrdId(this.post.prdid);if(isHoliday||isWeekend){alert(WebUIError["10113"]);return false}if(accountBaseInfo.userstatus==4){alert(WebUIError["10120"]);return false}if(!isSymbolTradeOpen(this.post.prdid)){alert(WebUIError["10113"]);return false}try{var a=(this.post.tradedir==1?0:1);this.post.buysell=a;this.openClosePostWindowDiv(this.post)}catch(b){alert("line 24, error:"+b)}},openClosePostWindowDiv:function(a){this.enableTradeLi();this.changeToMarketDiv();var b=(a.prdid==0)?i18n.llg:i18n.lls;b+="--"+Util.simpleOid(a.oid);$("#c-trade-prd-name").html(b);MarketClose.initMarketDiv(a);PeningClose.initPendingOrderDiv(a);$("#c_marketAndPendingOrderDiv").dialog({closeOnEscape:false,resizable:false,autoOpen:false,minWidth:315,width:315,modal:true});FocusManage.dialogFocus("#c_marketAndPendingOrderDiv","#c_marketTable");this.hideCloseBtn("#c_marketAndPendingOrderDiv")},getClosePrice:function(){var c="---";if(this.post){var a=this.post.buysell;var b=this.post.prdcode;if(a==0){if(b=="022"){c=Util.fixToStrTwodecimal(Tick.gold.bid)}if(b=="023"){c=Util.fixToStrTwodecimal(Tick.silver.bid)}}else{if(a==1){if(b=="022"){c=Util.fixToStrTwodecimal(Tick.gold.ask)}if(b=="023"){c=Util.fixToStrTwodecimal(Tick.silver.ask)}}}}return c},validateVolume:function(b){var f=getSymbolArray();var c=null;if(f){for(var a=0;a<f.length;a++){if(f[a].prdcode==b.prdcode){c=f[a];break}}}if(c){minVolume=c.minlot;maxVolume=c.maxlot;var e=$("#c_orderVolumeInput").val();if(this.post.closeType=="market"){e=$("#c_omVolumeInput").val()}if((parseFloat(b.lot)!=parseFloat(e))&&(e==null||isNaN(e)||e==""||e=="0"||Util.getDecimalLen(e)>2)){Alert(WebUIError[10104]);return false}else{var d=Math.mod(e,0.05);if(d!=0){Alert(WebUIError[10104]);return false}if(Number(e)>Number(b.lot)){Alert(WebUIError[10117]);return false}}}return true},changeToMarketDiv:function(){$("#c_marketLi").addClass("on-na");$("#c_pendingOrderLi").removeClass("on-na");$("#c_marketTable").show();$("#c_marketP").show();$("#c_marketSuccessMsg").hide();$("#c_pendingOrderTable").hide();$("#c_pendingOrderP").hide();$("#c_submitedSuccessMarketTable").hide();$("#c_marketC").hide();$("#c_submitedSuccessPendingOrderTable").hide();$("#c_pendingOrderC").hide();$("#c_submitedFailMarketTable").hide();$("#c_marketFC").hide();$("#c_submitedFailedPendingOrderTable").hide();$("#c_pendingOrderFC").hide();CloseCommon.post.closeType="market"},changeToPendingOrderDiv:function(){$("#c_pendingOrderLi").addClass("on-na");$("#c_marketLi").removeClass("on-na");$("#c_pendingOrderTable").show();$("#c_pendingOrderP").show();$("#c_marketTable").hide();$("#c_marketP").hide();$("#c_submitedSuccessMarketTable").hide();$("#c_marketC").hide();$("#c_submitedSuccessPendingOrderTable").hide();$("#c_pendingOrderC").hide();$("#c_submitedFailMarketTable").hide();$("#c_marketFC").hide();$("#c_submitedFailedPendingOrderTable").hide();$("#c_pendingOrderFC").hide();CloseCommon.post.closeType="pending"},closeWindowDiv:function(a){this._$closePostWindowDiv.dialog("close");if(a!=undefined&&($(a).parent("#c_marketC").length>0)){$("#investment-entrust-fl li").get(1).click()}if(a!=undefined&&($(a).parent("#c_pendingOrderC").length>0)){$("#investment-entrust-fl li").get(2).click()}},disableTradeLi:function(){$("#c_marketLi").off();$("#c_pendingOrderLi").off();$("#c_marketLi").css("color","#c_ccc");$("#c_pendingOrderLi").css("color","#c_ccc")},enableTradeLi:function(){$("#c_marketLi").on("click",this.changeToMarketDiv);$("#c_pendingOrderLi").on("click",this.changeToPendingOrderDiv);$("#c_marketLi").css("color","");$("#c_pendingOrderLi").css("color","")},hideCloseBtn:function(){$(".ui-dialog-titlebar-close",CloseCommon._$closePostWindowDiv.parent()).hide()},showCloseBtn:function(){},checkIsMoreThan60sAfterSubmit:function(){if(CloseCommon.isSubmittingorder&&!CloseCommon.isResponseorder){CloseCommon.showCloseBtn();CloseCommon.isSubmittingorder=false;CloseCommon.isResponseorder=true;CloseCommon.isAllowCloseTradeWindow=true;$("#c_pendingOrderErrorMessage").html(WebUIError[10116]);$("#c_submitedFailedPendingOrderTable").show();$("#c_pendOrderPreSubmittingMsg").hide();$("#c_pendOrderSuccessMsg").hide();$("#c_pendingOrderFC").show();$("#c_submitedSuccessPendingOrderTable").hide();$("#c_pendingOrderC").hide();$("#c_pendingOrderTable").hide();$("#c_pendingOrderP").hide()}else{if(CloseCommon.isSubmittingMarket&&!CloseCommon.isResponseMarket){CloseCommon.showCloseBtn();CloseCommon.isSubmittingMarket=false;CloseCommon.isResponseMarket=true;CloseCommon.isAllowCloseTradeWindow=true;$("#c_marketErrorMessage").html(WebUIError[10116]);$("#c_marketPreSubmittingMsg").hide();$("#c_marketSuccessMsg").hide();$("#c_submitedFailMarketTable").show();$("#c_submitedSuccessMarketTable").hide();$("#c_marketC").hide();$("#c_marketFC").show();$("#c_marketTable").hide();$("#c_marketP").hide()}}}};$(function(){CloseCommon._create()});var MarketClose={isSubmit:false,initMarketDiv:function(b,a){this._settingMarketDiv(b,a)},_settingMarketDiv:function(a){var c=a.buysell;var b;if(c==0){b=i18n.trade.buyType}else{if(c==1){b=i18n.trade.askType}else{b="---"}}$("#c_omDefaultTradeType").html(b);this.refresh();$("#c_omVolumeInput").val(Util.fixToStrTwodecimal(a.lot));this._calculateTransactionRange(a.prdcode)},refresh:function(){$("#c_tradePrice").html(CloseCommon.getClosePrice())},submitMarketClose:function(){var a=CloseCommon.post;if(a==null){alert("data null, pls retry.");return}if(!this.checkMarketSubmit(a)){return false}this.doSubmitMarketCloseAndCancelPendingOrder(a)},doSubmitMarketCloseAndCancelPendingOrder:function(j){var c=Util.fixToStrTwodecimal($("#c_omVolumeInput").val());var a=j.lot;var d=parseFloat(a)-parseFloat(c);var b=this.doSubmitMarketClose;var e=[];var h=0;for(var f=0;f<PendingOrder.orders.length;f++){var g=PendingOrder.orders[f];if(j.oid==g.targetoid&&g.tradestatus==0){e.push(g);h=h+g.lot}}if(d<h){var k=function(){b(j)};$("#cancelorder_confirm_tips").html(i18n.confirmCancelOrder);$("#cancelorder_confirm").dialog();$("#cancelorder_confirm_title").html("");$(".ui-dialog-titlebar-close",$("#cancelorder_confirm").parent()).hide();$("#cancelorder_confirm_btn_yes").unbind("click");$("#cancelorder_confirm_btn_no").unbind("click");$("#cancelorder_confirm_btn_yes").on("click",function(){$("#cancelorder_confirm").dialog("close");QuotationGTS.callCancelPendingOrderWithoutConfirm(e,k)});$("#cancelorder_confirm_btn_no").on("click",function(){$("#cancelorder_confirm").dialog("close")})}else{this.doSubmitMarketClose(j)}},doSubmitMarketClose:function(j){if(!Validator.checkMarketPrice(j.prdcode)){return}d=Util.fixToStrTwodecimal($("#c_omVolumeInput").val());if(d===""||typeof d==="undefined"||d===null||isNaN(d)){Alert(i18n.trade.volumeValid);return false}try{var d,k,f,c,g;CloseCommon.isSubmittingMarket=true;CloseCommon.isResponseMarket=false;d=Util.fixToStrTwodecimal($("#c_omVolumeInput").val());$("#c_submitedVolumeSpan").text(d);k=Util.getRandomSeq();j.marketSeq=k;var h=Tick.gold.time;if(j.prdid==1){h=Tick.silver.time}f=$("#c_transactionRange").spinner("value");if(f===""||typeof f==="undefined"||f===null){f="0"}$("#c_submitedTransactionRangeSpan").text(parseFloat(f));c=(j.buysell==0)?1:0;g=CloseCommon.getClosePrice();$("#c_submitedSuccessMarketTable").show();$("#c_marketSuccessMsg").hide();$("#c_marketPreSubmittingMsg").show();$("#c_marketPreSubmittingMsg").html(i18n.trade.sumitting);$("#c_doneRange").show();$("#c_uidId").hide();$("#c_marketC").hide();$("#c_submitedFailMarketTable").hide();$("#c_marketFC").hide();$("#c_marketTable").hide();$("#c_marketP").hide();var b;if(c==0){b=i18n.trade.tip_label_sell}else{if(c==1){b=i18n.trade.tip_label_buy}else{b="---"}}$("#c_tradeTypeTitleTd").html(b);$("#c_tradeTypeTitleTd").show();$("#c_submitedTradePriceSpan").html(g);$("#c_submitedTradePriceSpan").show();CloseCommon.disableTradeLi();CloseCommon.isAllowCloseTradeWindow=false;CloseCommon.hideCloseBtn();var a={prdid:j.prdid,lot:d,price:g,range:f,tradedir:c,ordertime:h,validtime:0,closeid:j.oid,margin:j.margin,charge:0};socket.emit("request",65793,a);MarketClose.isSubmit=true;tradeTimeOutObj=setTimeout(function(){CloseCommon.checkIsMoreThan60sAfterSubmit()},60*1000)}catch(i){alert("144"+i)}},GTShandleMarketRequestR:function(a){MarketClose.isSubmit=false;CloseCommon.isAllowCloseTradeWindow=true;showCloseBtn();if(CloseCommon.isResponseMarket){CloseCommon.isSubmittingMarket=false;return}else{CloseCommon.isSubmittingMarket=false;CloseCommon.isResponseMarket=true}if(a.code==0){$("#c_submitedFailMarketTable").hide();$("#c_marketFC").hide();$("#c_submitedMarketUIDSpan").html(Util.simpleOid(a.oid));$("#c_marketPreSubmittingMsg").hide();$("#c_marketSuccessMsg").show();$("#c_marketSuccessMsg").html(i18n.trade.sumitedSuccess);$("#c_marketTable").hide();$("#c_marketP").hide();$("#c_submitedSuccessMarketTable").show();$("#c_doneRange").hide();$("#c_uidId").show();$("#c_marketC").show()}else{$("#c_marketErrorMessage").html(WebUIError[a.code]);$("#c_marketPreSubmittingMsg").hide();$("#c_marketSuccessMsg").hide();$("#c_submitedFailMarketTable").show();$("#c_submitedSuccessMarketTable").hide();$("#c_marketC").hide();$("#c_marketFC").show();$("#c_marketTable").hide();$("#c_marketP").hide()}CloseCommon.showCloseBtn();clearTimeout(tradeTimeOutObj)},checkMarketSubmit:function(a){if(CloseCommon.validateVolume(a)){return true}return false},_validateTransRange:function(){var b=marketAndOrderObj.officePriceDights;var a=marketAndOrderObj.pipsDigits;var d=$("#c_transactionRange").spinner("value");var c=_getTransactionRangeFromServer(marketAndOrderObj.maxTransactionRange,marketAndOrderObj.officePriceDights,marketAndOrderObj.pipsDigits);if(d==null||isNaN(d)||d<0||d>c){Alert(i18n.trade.transRangeValid.format(0,Util.fixToStr(c,(b-a))));return false}return true},_calculateTransactionRange:function(c){var f=getSymbolArray();var d=null;if(f){for(var a=0;a<f.length;a++){if(f[a].prdcode==c){d=f[a];break}}if(d){var b=d.defmprange;var e=d.maxmprange;marketAndOrderObj.maxTransactionRange=e;marketAndOrderObj.defaultTransactionRange=b;$("#c_transactionRange").spinner({numberFormat:"n",step:0.01,min:0,max:e});$("#c_transactionRange").val(parseFloat(b));$("#c_transactionRangeSpan").html("0-"+parseFloat(e))}}},_changeMarketVolume:function(){$("#c_omVolumeInput").val(Util.fixToStr($(this).val()))},_changeMarketVolumeInput:function(){Util.allowNumKeyUp(document.getElementById("c_omVolumeInput"))}};$(function(){$("#c_investmentQuota").on("keypress",function(a){return Util.allowMaxValueKeyPress(a,document.getElementById("c_investmentQuota"),marketAndOrderObj.investmentQuotaMax)&&Util.allowMaxDightsLenKeyPress(a,document.getElementById("c_investmentQuota"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("c_investmentQuota"),Util.getIntLen(marketAndOrderObj.investmentQuotaMax))});$("#c_investmentQuota").on("keyup",function(a){Util.allowNumKeyUp(document.getElementById("c_investmentQuota"))});$("#c_transactionRange").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("c_transactionRange"),2)});$("#c_transactionRange").on("keyup",function(b){Util.allowNumKeyUp(document.getElementById("c_transactionRange"));var a=$("#c_transactionRange").val();if(Util.isNotBlank(a)&&parseFloat(a)>parseFloat(marketAndOrderObj.maxTransactionRange)){$("#c_transactionRange").val(marketAndOrderObj.maxTransactionRange)}});$("#c_transactionRange").on("blur",function(b){Util.allowNumKeyUp(document.getElementById("c_transactionRange"));var a=$("#c_transactionRange").val();if(Util.isNotBlank(a)&&parseFloat(a)>parseFloat(marketAndOrderObj.maxTransactionRange)){$("#c_transactionRange").val(marketAndOrderObj.maxTransactionRange)}});$("#c_omVolumeInput").on("keypress",function(a){return Util.allowMaxValueKeyPress(a,document.getElementById("c_omVolumeInput"),marketAndOrderObj.maximalVolume)&&Util.allowMaxDightsLenKeyPress(a,document.getElementById("c_omVolumeInput"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("c_omVolumeInput"),5)});$("#c_investmentQuota,#transactionRange,#omVolumeInput").on({dragenter:function(a){return false},paste:function(a){return false}});$("#c_omVolumeInput").on("keyup",function(){MarketClose._changeMarketVolumeInput()});$("#c_btnOmOK").on("click",function(){MarketClose.submitMarketClose()});socket.listeners.$after({tick:function(a,b){MarketClose.refresh()}});socket.listeners.$add({MarketCloseRet:function(a,b){MarketClose.GTShandleMarketRequestR(a)}})});var PeningClose={initPendingOrderDiv:function(g){var d=g.buysell;var b="---";if(d==0){b=i18n.buy}else{if(d==1){b=i18n.sell}}$("#c_pendingOrderTradedType").html(b);$("#c_orderBusiTypeSel").empty();this.initPendingOrderType();var j=CloseCommon.getClosePrice();var f=QuotationGTS.getSymbolArrayByPrdcode(CloseCommon.post.prdcode);if(!f){console.log("data lost , reload...");window.location.reload();return}var h=f.limitspread;var k=f.triggerspread;if(d==0){$("#c_limitOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(j,h)));$("#c_limitPrice").val(Util.fixToStrTwodecimal(Util.accSub(j,h)));$("#c_stopOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(j,k)));$("#c_stopPrice").val(Util.fixToStrTwodecimal(Util.accAdd(j,k)));$("#c_buyLimitMax").val(Util.fixToStrTwodecimal(Util.accSub(j,h)));$("#c_buyStopMin").val(Util.fixToStrTwodecimal(Util.accAdd(j,k)))}else{if(d==1){$("#c_limitOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(j,h)));$("#c_limitPrice").val(Util.fixToStrTwodecimal(Util.accAdd(j,h)));$("#c_stopOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(j,k)));$("#c_stopPrice").val(Util.fixToStrTwodecimal(Util.accSub(j,k)));$("#c_askLimitMin").val(Util.fixToStrTwodecimal(Util.accAdd(j,h)));$("#c_askStopMax").val(Util.fixToStrTwodecimal(Util.accSub(j,k)))}}this.refresh();this._showLimitOrStopByBusiType(1);$("#c_orderVolumeInput").val(Util.fixToStrTwodecimal(g.lot));var a=document.getElementsByName("c_radioExpir");for(var e=0;e<a.length;e++){var c=a[e];if(c.value==0){c.checked=true}}},refresh:function(){if("undefined"===typeof CloseCommon.post||CloseCommon.post==null){return}var e=CloseCommon.getClosePrice();var a=QuotationGTS.getSymbolArrayByPrdcode(CloseCommon.post.prdcode);var c=a.limitspread;var d=a.triggerspread;var b=CloseCommon.post.buysell;if(b==0){$("#c_limitOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(e,c)));$("#c_stopOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(e,d)));$("#c_buyLimitMax").val(Util.fixToStrTwodecimal(Util.accSub(e,c)));$("#c_buyStopMin").val(Util.fixToStrTwodecimal(Util.accAdd(e,d)))}else{if(b==1){$("#c_limitOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(e,c)));$("#c_stopOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(e,d)));$("#c_askLimitMin").val(Util.fixToStrTwodecimal(Util.accAdd(e,c)));$("#c_askStopMax").val(Util.fixToStrTwodecimal(Util.accSub(e,d)))}}},initPendingOrderType:function(){var a="";a+="<option value='"+pendingOrdertype.LIMIT+"'>"+i18n.trade.limitType+"</option>";a+="<option value='"+pendingOrdertype.STOP+"'>"+i18n.trade.stopType+"</option>";a+="<option value='"+pendingOrdertype.BUY_OCO+"'>"+i18n.trade.buyOcoType+"</option>";$("#c_orderBusiTypeSel").append(a)},getPendingOrderTypeValue:function(){var c=$("#c_orderBusiTypeSel").val();var a=CloseCommon.post.buysell;var b=(a==0)?1:0;if(b==0){if(c==pendingOrdertype.LIMIT){return OrderType.BUY_LIMIT}else{if(c==pendingOrdertype.STOP){return OrderType.BUY_STOP}else{if(c==pendingOrdertype.BUY_OCO){return OrderType.BUY_OCO}else{return OrderType.BUY_LIMIT}}}}else{if(c==pendingOrdertype.LIMIT){return OrderType.SELL_LIMIT}else{if(c==pendingOrdertype.STOP){return OrderType.SELL_STOP}else{if(c==pendingOrdertype.BUY_OCO){return OrderType.SELL_OCO}else{return OrderType.SELL_LIMIT}}}}},validatePrice:function(){var a=$("#c_orderBusiTypeSel").val();var b=CloseCommon.post.buysell;var j=CloseCommon.getClosePrice();var e=QuotationGTS.getSymbolArrayByPrdcode(CloseCommon.post.prdcode);var g=e.limitspread;var k=e.triggerspread;var d=e.maxrange;var f=$("#c_limitPrice").val();var i=$("#c_stopPrice").val();var h=/XX/g;var c=/YY/g;if(b==0){c_limit_min=Number(Util.accSub(j,d));c_limit_max=Number(Util.accSub(j,g));c_stop_min=Number(Util.accAdd(j,k));c_stop_max=Number(Util.accAdd(j,d));if((a==pendingOrdertype.BUY_OCO)){if(isNaN(f)){Alert(WebUIError[10112].replace(h,d));return false}if(f<c_limit_min){Alert(WebUIError[10112].replace(h,d));return false}if(f>c_limit_max){Alert(WebUIError[10110].replace(h,g).replace(c,k));return false}if(isNaN(i)){Alert(WebUIError[10110].replace(h,g).replace(c,k));return false}if(i<c_stop_min){Alert(WebUIError[10110].replace(h,g).replace(c,k));return false}if(i>c_stop_max){Alert(WebUIError[10112].replace(h,d));return false}}if((a==pendingOrdertype.LIMIT)||(a==pendingOrdertype.BUY_OCO)){if(isNaN(f)){Alert(WebUIError[10112].replace(h,d));return false}if(f<c_limit_min){Alert(WebUIError[10112].replace(h,d));return false}if(f>c_limit_max){Alert(WebUIError[10106].replace(h,g));return false}}if((a==pendingOrdertype.STOP)||(a==pendingOrdertype.BUY_OCO)){if(isNaN(i)){Alert(WebUIError[10108].replace(h,k));return false}if(i<c_stop_min){Alert(WebUIError[10108].replace(h,k));return false}if(i>c_stop_max){Alert(WebUIError[10112].replace(h,d));return false}}}else{c_limit_min=Number(Util.accAdd(j,g));c_limit_max=Number(Util.accAdd(j,d));c_stop_min=Number(Util.accSub(j,d));c_stop_max=Number(Util.accSub(j,k));if((a==pendingOrdertype.BUY_OCO)){if(isNaN(f)){Alert(WebUIError[10111].replace(h,g).replace(c,k));return false}if(f<c_limit_min){Alert(WebUIError[10111].replace(h,g).replace(c,k));return false}if(f>c_limit_max){Alert(WebUIError[10112].replace(h,d));return false}if(isNaN(i)){Alert(WebUIError[10112].replace(h,d));return false}if(i<c_stop_min){Alert(WebUIError[10112].replace(h,d));return false}if(i>c_stop_max){Alert(WebUIError[10111].replace(h,g).replace(c,k));return false}}if((a==pendingOrdertype.LIMIT)||(a==pendingOrdertype.BUY_OCO)){if(isNaN(f)){Alert(WebUIError[10107].replace(h,k));return false}if(f<c_limit_min){Alert(WebUIError[10107].replace(h,k));return false}if(f>c_limit_max){Alert(WebUIError[10112].replace(h,d));return false}}if((a==pendingOrdertype.STOP)||(a==pendingOrdertype.BUY_OCO)){if(isNaN(i)){Alert(WebUIError[10112].replace(h,d));return false}if(i<c_stop_min){Alert(WebUIError[10112].replace(h,d));return false}if(i>c_stop_max){Alert(WebUIError[10109].replace(h,k));return false}}}return true},submitPendingOrder:function(){var a=CloseCommon.post;if(!this.checkPendingOrderSubmit(a)){return false}this.doSubmitPendCloseAndCancelPendingOrder(a)},checkPendingOrderSubmit:function(b){var a=CloseCommon.validateVolume(b);if(a){a=this.validatePrice()}return a},doSubmitPendCloseAndCancelPendingOrder:function(h){if(!Validator.checkMarketPrice(h.prdcode)){return}var b=Util.fixToNum($("#c_orderVolumeInput").val());var a=h.lot;var c=parseFloat(a)-parseFloat(b);var d=[];var g=0;for(var e=0;e<PendingOrder.orders.length;e++){var f=PendingOrder.orders[e];if(h.oid==f.targetoid&&f.tradestatus==0){d.push(f);g=g+f.lot}}if(c<g){var j=function(){PeningClose.doSubmitPendingOrder(h)};$("#cancelorder_confirm_tips").html(i18n.confirmCancelOrder);$("#cancelorder_confirm").dialog();$("#cancelorder_confirm_title").html("");$(".ui-dialog-titlebar-close",$("#cancelorder_confirm").parent()).hide();$("#cancelorder_confirm_btn_yes").unbind("click");$("#cancelorder_confirm_btn_no").unbind("click");$("#cancelorder_confirm_btn_yes").on("click",function(){$("#cancelorder_confirm").dialog("close");QuotationGTS.callCancelPendingOrderWithoutConfirm(d,j)});$("#cancelorder_confirm_btn_no").on("click",function(){$("#cancelorder_confirm").dialog("close")})}else{this.doSubmitPendingOrder(h)}},doSubmitPendingOrder:function(m){var c=0;var b=0;var k=null;CloseCommon.orderSubmitStartTime=new Date().getTime();CloseCommon.isSubmittingorder=true;CloseCommon.isResponseorder=false;var p=getSymbolArray();var g=null;if(p){for(var h=0;h<p.length;h++){if(p[h].prdcode==m.prdcode){g=p[h];break}}}this._getPendingOrderSuccessSubmitedData(m,g);var j=Util.fixToNum($("#c_orderVolumeInput").val());var q=Util.getRandomSeq();m.pendingOrderSeq=q;var l=parseInt($("input[name='c_radioExpir']:checked").val());var a=this.getPendingOrderTypeValue();if(a==OrderType.BUY_LIMIT||a==OrderType.SELL_LIMIT){k=$("#c_limitPrice").spinner("value");c=k}if(a==OrderType.BUY_STOP||a==OrderType.SELL_STOP){k=$("#c_stopPrice").spinner("value");b=k}if(a==OrderType.BUY_OCO||a==OrderType.SELL_OCO){b=$("#c_stopPrice").spinner("value");c=$("#c_limitPrice").spinner("value")}$("#c_pendOrderSuccessMsg").hide();$("#c_pendOrderPreSubmittingMsg").show();$("#c_pendOrderPreSubmittingMsg").html(i18n.trade.sumitting);$("#c_orderUID").hide();$("#c_pendingOrderC").hide();$("#c_submitedFailedPendingOrderTable").hide();$("#c_submitedSuccessPendingOrderTable").show();$("#c_pendingOrderFC").hide();$("#c_pendingOrderTable").hide();$("#c_pendingOrderP").hide();CloseCommon.disableTradeLi();CloseCommon.isAllowCloseTradeWindow=false;CloseCommon.hideCloseBtn();var o="--";if(m.prdcode=="022"){o=0}else{if(m.prdcode=="023"){o=1}}var f=m.buysell;var e=f;var d={open_close:1,oid:"",targetoid:m.oid,roid:"",prdid:o,optype:a,tradedir:e,positiondir:1,tradestatus:0,validtype:l,validflag:0,lot:j,time:g.dtime,price:Number(b),limitprice:Number(c),range:0,tradeunit:0};socket.emit("request",Request.pendingOrder.cmd,d);tradeTimeOutObj=setTimeout(function(){CloseCommon.checkIsMoreThan60sAfterSubmit()},60*1000)},handlePendingOrderRequestR:function(a){var b=CloseCommon.post;if(b!=null&&a!=null){CloseCommon.isAllowCloseTradeWindow=true;CloseCommon.showCloseBtn();if(CloseCommon.isResponseorder){CloseCommon.isSubmittingorder=false;return}else{CloseCommon.isSubmittingorder=false;CloseCommon.isResponseorder=true}if(a.code==0){$("#c_orderUID").show();$("#c_submitedPendingOrderUIDSpan").html(Util.simpleOid(a.oid));$("#c_pendOrderPreSubmittingMsg").hide();$("#c_pendOrderSuccessMsg").show();$("#c_pendOrderSuccessMsg").html(i18n.trade.sumitedSuccess);$("#c_submitedSuccessPendingOrderTable").show();$("#c_pendingOrderC").show();$("#c_pendingOrderTable").hide();$("#c_pendingOrderP").hide();$("#c_submitedFailedPendingOrderTable").hide();$("#c_pendingOrderFC").hide()}else{if(a.ret==1026||a.ret=="1026"){$("#c_pendingOrderErrorMessage").html(WebUIError[a.code].format(364))}else{if(a.ret==155||a.ret=="155"){$("#c_pendingOrderErrorMessage").html(WebUIError[a.code].format(Util.fixToStrTwodecimal(368)))}else{$("#c_pendingOrderErrorMessage").html(WebUIError[a.code])}}$("#c_submitedFailedPendingOrderTable").show();$("#c_pendOrderPreSubmittingMsg").hide();$("#c_pendOrderSuccessMsg").hide();$("#c_pendingOrderFC").show();$("#c_submitedSuccessPendingOrderTable").hide();$("#c_pendingOrderC").hide();$("#c_pendingOrderTable").hide();$("#c_pendingOrderP").hide()}}clearTimeout(tradeTimeOutObj)},_getPendingOrderSuccessSubmitedData:function(o,f){var k="",m="",g="",h;var a=Util.fixToStrTwodecimal($("#c_limitPrice").spinner("value"),f.officePriceDights);var j=Util.fixToStrTwodecimal($("#c_stopPrice").spinner("value"),f.officePriceDights);var l=Util.fixToStrTwodecimal($("#c_orderVolumeInput").val());var i=parseInt($("input[name='c_radioExpir']:checked").val())==0?i18n.trade.dayEffective:i18n.trade.weekEffective;$("#c_submitedSuccessPendingOrderTable tr").not("#c_submitedSuccessPendingOrderTr").remove();var b=this.getPendingOrderTypeValue();var d=o.buysell;var e="";var c="";if(d==0){g=i18n.trade.tip_label_buy;e=i18n.trade.limitBuyTxt;c=i18n.trade.stopBuyTxt}else{g=i18n.trade.tip_label_sell;e=i18n.trade.limitAskTxt;c=i18n.trade.stopAskTxt}if(b==OrderType.BUY_LIMIT||b==OrderType.SELL_LIMIT||b==OrderType.BUY_STOP||b==OrderType.SELL_STOP){if(b==OrderType.BUY_LIMIT){m=i18n.trade.typeLimit;h=a}else{if(b==OrderType.SELL_LIMIT){m=i18n.trade.typeLimit;h=a}else{if(b==OrderType.BUY_STOP){m=i18n.trade.typeStop;h=j}else{m=i18n.trade.typeStop;h=j}}}k="<tr><td><ul class='subm-info'><li>"+m+"</li><li>"+g+Util.fixToStrTwodecimal(h)+"</li><li>"+i18n.trade.volumeTxt+l+"</li><li>"+i18n.trade.expirTxt+i+"</li><li id='c_orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='c_submitedPendingOrderUIDSpan'></span></li></ul></td></tr>";$("#c_submitedSuccessPendingOrderTr").after(k)}else{if(b==OrderType.BUY_OCO||OrderType.SELL_OCO){m=i18n.trade.typeBuyOco;k="<tr><td><ul class='subm-info'><li>"+m+"</li><li>"+e+Util.fixToStrTwodecimal(a)+"</li><li>"+c+Util.fixToStrTwodecimal(j)+"</li><li>"+i18n.trade.volumeTxt+l+"</li><li>"+i18n.trade.expirTxt+i+"</li><li id='c_orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='c_submitedPendingOrderUIDSpan'></span></li></ul></td></tr>";$("#c_submitedSuccessPendingOrderTr").after(k)}}},_changeOrderBusiType:function(){var a=this.getPendingOrderTypeValue();this._showLimitOrStopByBusiType(a)},_showLimitOrStopByBusiType:function(a){if(a==OrderType.BUY_LIMIT||a==OrderType.SELL_LIMIT){$("#c_limitPrice").spinner("enable");$("#c_stopPrice").spinner("disable");$("#c_limitPrice").attr("disabled",false);$("#c_stopPrice").attr("disabled",true)}if(a==OrderType.BUY_STOP||a==OrderType.SELL_STOP){$("#c_limitPrice").spinner("disable");$("#c_stopPrice").spinner("enable");$("#c_limitPrice").attr("disabled",true);$("#c_stopPrice").attr("disabled",false)}if(a==OrderType.BUY_OCO||a==OrderType.SELL_OCO){$("#c_limitPrice").spinner("enable");$("#c_stopPrice").spinner("enable");$("#c_limitPrice").attr("disabled",false);$("#c_stopPrice").attr("disabled",false)}}};$(function(){$("#c_limitPrice").spinner({step:0.01,numberFormat:"n"});$("#c_stopPrice").spinner({step:0.01,numberFormat:"n"});$("#c_limitPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("c_limitPrice"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("c_limitPrice"),5)});$("#c_limitPrice").on("keyup",function(a){Util.allowNumKeyUp(document.getElementById("c_limitPrice"))});$("#c_stopPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("c_stopPrice"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("c_stopPrice"),5)});$("#c_stopPrice").on("keyup",function(a){Util.allowNumKeyUp(document.getElementById("stopPrice"))});$("#c_pendingOrderInvestmentQuota").on("keypress",function(a){return Util.allowMaxValueKeyPress(a,document.getElementById("c_pendingOrderInvestmentQuota"),marketAndOrderObj.investmentQuotaMax)&&Util.allowMaxDightsLenKeyPress(a,document.getElementById("c_pendingOrderInvestmentQuota"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("c_pendingOrderInvestmentQuota"),Util.getIntLen(marketAndOrderObj.investmentQuotaMax))});$("#c_pendingOrderInvestmentQuota").on("keyup",function(a){Util.allowNumKeyUp(document.getElementById("c_pendingOrderInvestmentQuota"))});$("#c_orderVolumeInput").on("keypress",function(a){return Util.allowMaxValueKeyPress(a,document.getElementById("c_orderVolumeInput"),marketAndOrderObj.maximalVolume)&&Util.allowMaxDightsLenKeyPress(a,document.getElementById("c_orderVolumeInput"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("c_orderVolumeInput"),5)});$("#c_orderVolumeInput").on("keyup",function(a){Util.allowNumKeyUp(document.getElementById("c_orderVolumeInput"))});$("#c_limitPrice,#stopPrice,#c_pendingOrderInvestmentQuota,#c_orderVolumeInput").on({dragenter:function(a){return false},paste:function(a){return false}});$("#c_orderBusiTypeSel").on("change",function(){PeningClose._changeOrderBusiType()});$("#c_btnOrderOK").on("click",function(){PeningClose.submitPendingOrder()});socket.listeners.$after({tick:function(a,b){PeningClose.refresh()}});socket.listeners.$add({PendingOrderRet:function(a,b){PeningClose.handlePendingOrderRequestR(a)}})});$(function(){$("#dialog:ui-dialog").dialog("destroy");$("#modify_marketAndPendingOrderDiv").dialog({closeOnEscape:false,resizable:false,autoOpen:false,minWidth:315,width:315,closable:true,modal:true})});openModifyTradeWindowDiv=function(a,c,b){pendingOrderObjModify.clear();advPendingOrderObjModify.clear();marketAndOrderObj.isSubmittingMarket=false;marketAndOrderObj.isResponseMarket=false;marketAndOrderObj.isSubmittingorder=false;marketAndOrderObj.isResponseorder=false;marketAndOrderObj.isAllowCloseTradeWindow=true;showCloseBtn("#modify_marketAndPendingOrderDiv");pendingOrderObjModify.setModifyPendingOrderData(a);if(typeof(c)!="undefined"){advPendingOrderObjModify.setModifyAdvancePendingOrderData(c)}var d=b.prdname;d+="--"+Util.simpleOid(a.oid);$("#modify-trade-prd-name").html(d);if(typeof(c)=="undefined"||c[1].validflag==2){initModifyPendingOrderDiv(a,b);changeToModifyPendingDiv()}else{initModifyAdvancePendingOrderDiv(c,b);changeToModifyAdvPendingDiv()}FocusManage.dialogFocus("#modify_marketAndPendingOrderDiv","#modify_pendingOrderTable");hideCloseBtn("#modify_marketAndPendingOrderDiv")};changeToModifyPendingDiv=function(){$("#modify_pendingOrderLi").addClass("on-na");$("#modify_pendingOrderTable").show();$("#modify_submitedSuccessPendingOrderTable").hide();$("#modify_submitedSuccessAdvancePendingOrderTable").hide();$("#modify_submitedFailedAdvancePendingOrderTable").hide();$("#modify_pendingOrderC").hide();$("#modify_submitedFailedPendingOrderTable").hide();$("#modify_pendingOrderFC").hide();$("#modify_advance_pendingOrderC").hide();$("#modify_advance_pendingOrderFC").hide();$("#modify_advamcePendingOrderP").hide();$("#modify_pendingOrderP").show();$("#pendingOrderTable tr[name='unadvance']").show();$("#pendingOrderTable tr[name='advance']").hide()};changeToModifyAdvPendingDiv=function(){$("#modify_pendingOrderLi").addClass("on-na");$("#modify_pendingOrderTable").show();$("#modify_submitedSuccessPendingOrderTable").hide();$("#modify_submitedSuccessAdvancePendingOrderTable").hide();$("#modify_submitedFailedAdvancePendingOrderTable").hide();$("#modify_pendingOrderC").hide();$("#modify_submitedFailedPendingOrderTable").hide();$("#modify_pendingOrderFC").hide();$("#modify_advance_pendingOrderC").hide();$("#modify_advance_pendingOrderFC").hide();$("#modify_advamcePendingOrderP").hide();$("#modify_pendingOrderP").show();$("#pendingOrderTable tr[name='unadvance']").hide();$("#pendingOrderTable tr[name='advance']").show()};refreshTrade=function(){if(marketAndOrderObj&&marketAndOrderObj.symbol!=null){var a=getSymbol4Code(marketAndOrderObj.symbol);refreshMarketDiv(a);refreshPendingOrderDiv(a)}};clearTradeData=function(){amsSymbolConfigInfo={};marketAndOrderObj.clear();QuotationGTS.currentSymbolKey=""};closeWindowDiv=function(a){if(marketAndOrderObj.isAllowCloseTradeWindow){$(a).dialog("close");clearTradeData()}};hideCloseBtn=function(a){$(".ui-dialog-titlebar-close",$(a).parent()).hide()};showCloseBtn=function(a){};initBaseSpinnerById=function(a){$(a).spinner({numberFormat:"n"})};var marketAndOrderObj={isOpenTradeWindow:false,defaultTradeType:"0",dtime:"",ask:"",buy:"",prdcode:"",produceName:"",minDistance:"",maxslrange:"",limitAndStopStep:"",pipsDigits:"",officePriceDights:"",symbol:"",eachPointPrice:"",investmentQuotaMin:"",investmentQuotaMax:"",investmentQuotaStep:"",defaultInvestmentQuota:"",volumeListSize:"",volumeLotinfo:"",minimalVolume:"",maximalVolume:"",volumeStep:"",defaultVolume:"",defaultTransactionRange:"",maxTransactionRange:"",transactionRangeStep:"",marketSeq:"",pendingOrderSeq:"",commission:"",buyinterest:"",sellinterest:"",isPosition:false,isInvestment:false,positionOrder:{},isAllowCloseTradeWindow:false,marketSubmitStartTime:"",isSubmittingMarket:false,isResponseMarket:false,orderSubmitStartTime:"",isSubmittingorder:false,isResponseorder:false,unitMargin:"",orderspread:"",maxrange:"",limitspread:"",triggerspread:"",setMarketAndPendingOrderData:function(g){this.defaultTradeType=g.buySell==null||g.buySell==undefined?"0":g.buySell;var e=g.bid==null||g.bid==undefined?"":g.bid;this.buy=Util.fixToStr(e);var a=g.ask==null||g.ask==undefined?"":g.ask;this.ask=Util.fixToStr(a);var d=g.prdname==null||g.prdname==undefined?"":g.prdname;this.produceName=d;var f=g.prdcode==null||g.prdcode==undefined?"":g.prdcode;this.prdcode=f;this.dtime=g.dtime;this.buyinterest=g.buyinterest;this.sellinterest=g.sellinterest;this.symbol=g.prdcode;var c=g.lotinfo;var b=[];if(c){b=c.split(",")}this.volumeListSize=b.length;this.volumeLotinfo=b;this.minimalVolume=g.minlot;this.maximalVolume=g.maxlot;this.volumeStep=g.unitlot;this.defaultTransactionRange=g.defmprange;this.maxTransactionRange=g.maxmprange;this.unitMargin=g.inimargin;this.orderspread=g.orderspread;this.maxrange=g.maxrange;this.maxmprange=g.maxmprange;this.limitspread=g.limitspread;this.triggerspread=g.triggerspread;this.lotlimit=g.lotlimit},refreshMarketAndPendingOrderData:function(c){this.buyinterest=c.buyinterest;this.sellinterest=c.sellinterest;var b=c.lotinfo;var a=[];if(b){a=b.split(",")}this.volumeListSize=a.length;this.volumeLotinfo=a;this.minimalVolume=c.minlot;this.maximalVolume=c.maxlot;this.volumeStep=c.unitlot;this.defaultTransactionRange=c.defmprange;this.maxTransactionRange=c.maxmprange;this.unitMargin=c.inimargin;this.orderspread=c.orderspread;this.maxrange=c.maxrange;this.maxmprange=c.maxmprange;this.limitspread=c.limitspread;this.triggerspread=c.triggerspread},clear:function(){this.isOpenTradeWindow=false;this.defaultTradeType="0";this.dtime="";this.ask="";this.buy="";this.prdcode="";this.produceName="";this.minDistance="";this.maxslrange="";this.limitAndStopStep="";this.pipsDigits="";this.officePriceDights="";this.symbol="";this.eachPointPrice="";this.investmentQuotaMin="";this.investmentQuotaMax="";this.investmentQuotaStep="";this.defaultInvestmentQuota="";this.volumeListSize="";this.volumeLotinfo="";this.minimalVolume="";this.maximalVolume="";this.volumeStep="";this.defaultVolume="";this.defaultTransactionRange="";this.maxTransactionRange="";this.transactionRangeStep="";this.marketSeq="";this.pendingOrderSeq="";this.commission="";this.buyinterest="";this.sellinterest="";this.isPosition=false;this.isInvestment=false;this.positionOrder={};this.isAllowCloseTradeWindow=false;this.marketSubmitStartTime="";this.isSubmittingMarket=false;this.isResponseMarket=false;this.orderSubmitStartTime="";this.isSubmittingorder=false;this.isResponseorder=false;this.unitMargin="";this.orderspread="";this.maxrange="";this.limitspread="";this.triggerspread=""}};var pendingOrderObjModify={oid:"",targetoid:"",roid:"",prdid:"",optype:"",tradedir:"",positiondir:"",validtype:"",validflag:"",lot:"",limitprice:"",price:"",prdcode:"",produceName:"",setModifyPendingOrderData:function(a){this.oid=a.oid;this.targetoid=a.targetoid;this.roid=a.roid;this.prdid=a.prdid;this.optype=a.optype;this.tradedir=a.tradedir;this.positiondir=a.positiondir;this.validtype=a.validtype;this.validflag=a.validflag;this.lot=a.lot;this.price=a.price;this.prdcode=a.prdcode},clear:function(){this.oid=null;this.targetoid=null;this.roid=null;this.prdid=null;this.optype=null;this.tradedir=null;this.positiondir=null;this.validtype=null;this.validflag=null;this.lot=null;this.price=null;this.prdcode=null}};var advPendingOrderObjModify={data:[{oid:"",targetoid:"",roid:"",prdid:"",optype:"",tradedir:"",positiondir:"",validtype:"",validflag:"",lot:"",limitprice:"",price:"",prdcode:"",produceName:""},{oid:"",targetoid:"",roid:"",prdid:"",optype:"",tradedir:"",positiondir:"",validtype:"",validflag:"",lot:"",limitprice:"",price:"",prdcode:"",produceName:""}],setModifyAdvancePendingOrderData:function(c){var a=c[0];this.data[0].oid=a.oid;this.data[0].targetoid=a.targetoid;this.data[0].roid=a.roid;this.data[0].prdid=a.prdid;this.data[0].optype=a.optype;this.data[0].tradedir=a.tradedir;this.data[0].positiondir=a.positiondir;this.data[0].validtype=a.validtype;this.data[0].validflag=a.validflag;this.data[0].lot=a.lot;this.data[0].limitprice=a.limitprice;this.data[0].price=a.price;this.data[0].prdcode=a.prdcode;var b=c[1];this.data[1].oid=b.oid;this.data[1].targetoid=b.targetoid;this.data[1].roid=b.roid;this.data[1].prdid=b.prdid;this.data[1].optype=b.optype;this.data[1].tradedir=b.tradedir;this.data[1].positiondir=b.positiondir;this.data[1].validtype=b.validtype;this.data[1].validflag=b.validflag;this.data[1].lot=b.lot;this.data[1].limitprice=b.limitprice;this.data[1].price=b.price;this.data[1].prdcode=b.prdcode},clear:function(){this.data[0]={};this.data[1]={}}};$(function(){$("#transactionRange").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("transactionRange"),2)});$("#transactionRange").on("keyup",function(b){var a=$("#transactionRange").val();if(Util.isNotBlank(a)&&parseFloat(a)>parseFloat(marketAndOrderObj.maxTransactionRange)){$("#transactionRange").val(marketAndOrderObj.maxTransactionRange)}});$("#omVolumeInput").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("omVolumeInput"),2)});$("#omVolumeInput").on("keyup",function(b){Util.allowNumKeyUp(document.getElementById("omVolumeInput"));var a=$("#omVolumeInput").val();if(Util.isNotBlank(a)&&parseFloat(a)>parseFloat(marketAndOrderObj.maximalVolume)){$("#omVolumeInput").val(marketAndOrderObj.maximalVolume)}calculateOMMargin($("#omVolumeInput").val())});$("#omVolumeSel-btn").on("click",function(){var a=$("#omVolumeSel li");a.removeClass("sxc-lihov");a.each(function(){if($(this).attr("tv")==$("#omVolumeInput").val()){$(this).addClass("sxc-lihov")}});$("#omVolumeSel").toggle()});$("#btnOmOK").unbind("click").on("click",submitMarket)});initMarketDiv=function(a){_settingMarketDiv(a)};_settingMarketDiv=function(c){var b=marketAndOrderObj.defaultTradeType;var a;if(b==0){a=i18n.trade.label_buy}else{if(b==1){a=i18n.trade.label_sell}else{a="---"}}$("#omDefaultTradeType").html(a);var e;if(b==0){e=Util.fixToStrTwodecimal(marketAndOrderObj.buy)}else{if(b==1){e=Util.fixToStrTwodecimal(marketAndOrderObj.ask)}else{e="---"}}$("#tradePrice").html(e);initMarketVolume();var d=parseFloat($("#omVolumeInput").val())*getUserMargin(marketAndOrderObj.prdcode);$("#omMargin").html(Util.fixToStrTwodecimal(d));initTransactionRange()};initMarketVolume=function(){_setVolumeList("#omVolumeSel","#omVolumeInput","#volumeRange","#omVolumeSelSpan");var e=SystemCookie.getTradeVol(marketAndOrderObj.prdcode);if(Util.isNotBlank(e)){var c=parseFloat(e);var b=parseFloat(marketAndOrderObj.minimalVolume);var a=parseFloat(marketAndOrderObj.maximalVolume);var f=Util.accMul(marketAndOrderObj.volumeStep,100);if(c<b||c>a||Util.accMul(Util.accSub(c,b),100)%f!=0){$("#omVolumeSel").val(Util.fixToStr(marketAndOrderObj.minimalVolume));$("#omVolumeInput").val(c);document.getElementsByName("defaultOmVolumeCheckbox")[0].checked=true}else{$("#omVolumeSel").val(e);$("#omVolumeInput").val(e);document.getElementsByName("defaultOmVolumeCheckbox")[0].checked=true}}else{var d=marketAndOrderObj.volumeLotinfo;$("#omVolumeInput").val(Util.fixToStr(d[0]));$("#defaultOmVolumeCheckbox").attr("checked",false)}};refreshMarketDiv=function(b){if(!$("#marketAndPendingOrderDiv").dialog("isOpen")){return}marketAndOrderObj.setMarketAndPendingOrderData(b);var c=marketAndOrderObj.produceName;$("#marketAndPendingOrderDiv").dialog("option","title",c);var a=marketAndOrderObj.defaultTradeType;var d;if(a==0){d=Util.fixToStrTwodecimal(marketAndOrderObj.buy)}else{if(a==1){d=Util.fixToStrTwodecimal(marketAndOrderObj.ask)}else{d="---"}}$("#tradePrice").html(d)};submitMarket=function(){if(!_validateTransRange()){return false}if(!_checkMarketSubmit()){return false}doSubmitMarket()};doSubmitMarket=function(){var c,i,d,b,e,f;marketAndOrderObj.marketSubmitStartTime=new Date().getTime();marketAndOrderObj.isSubmittingMarket=true;marketAndOrderObj.isResponseMarket=false;c=Util.fixToStrTwodecimal($("#omVolumeInput").val());$("#submitedVolumeSpan").text(c);f=$("#omMargin").text();i=Util.getRandomSeq();marketAndOrderObj.marketSeq=i;d=$("#transactionRange").spinner("value");if(d===""||typeof d==="undefined"||d===null){d="0"}$("#submitedTransactionRangeSpan").text(parseFloat(d));$("#submitedMargin").text($("#omMargin").text());if(marketAndOrderObj.defaultTradeType=="0"){b=0;e=parseFloat(marketAndOrderObj.buy);$("#tradeTypeTitleTd").html(i18n.trade.tip_label_buy);$("#submitedTradePriceSpan").html(e)}else{b=1;e=parseFloat(marketAndOrderObj.ask);$("#tradeTypeTitleTd").empty();$("#tradeTypeTitleTd").html(i18n.trade.tip_label_sell);$("#submitedTradePriceSpan").html(e)}var h=marketAndOrderObj.prdcode;var g;if(h=="022"){g=0}else{if(h=="023"){g=1}}$("#marketSuccessMsg").hide();$("#marketPreSubmittingMsg").show();$("#marketPreSubmittingMsg").html(i18n.trade.sumitting);$("#marketC").hide();$("#submitedSuccessMarketTable").show();$("#submitedFailMarketTable").hide();$("#marketFC").hide();$("#marketTable").hide();$("#marketP").hide();$("#uidId").hide();$("#doneRange").show();disableTradeLi();marketAndOrderObj.isAllowCloseTradeWindow=false;hideCloseBtn("#marketAndPendingOrderDiv");var a={prdid:g,lot:c,price:e,range:d,tradedir:b,ordertime:marketAndOrderObj.dtime,validtime:0,closeid:"",margin:f,charge:0};Log.debug(a);socket.emit("request",65792,a);tradeTimeOutObj=setTimeout(checkIsMoreThan60sAfterSubmit,60*1000)};GTShandleMarketRequestR=function(a){marketAndOrderObj.isAllowCloseTradeWindow=true;showCloseBtn("#marketAndPendingOrderDiv");if(marketAndOrderObj.isResponseMarket){marketAndOrderObj.isSubmittingMarket=false;return}else{marketAndOrderObj.isSubmittingMarket=false;marketAndOrderObj.isResponseMarket=true}if(a.code==0){var b=$("#defaultOmVolumeCheckbox");SystemCookie.setTradeVol(marketAndOrderObj.prdcode,(b.is(":checked")?Util.fixToStrTwodecimal($("#omVolumeInput").val()):null));$("#submitedMarketUIDSpan").html(Util.simpleOid(a.oid));$("#marketPreSubmittingMsg").hide();$("#marketSuccessMsg").show();$("#marketSuccessMsg").html(i18n.trade.sumitedSuccess);$("#marketTable").hide();$("#marketP").hide();$("#submitedSuccessMarketTable").show();$("#marketC").show();$("#submitedFailMarketTable").hide();$("#marketFC").hide();$("#uidId").show()}else{$("#marketErrorMessage").html(WebUIError[a.code].replace("XX",marketAndOrderObj.lotlimit));$("#marketPreSubmittingMsg").hide();$("#marketSuccessMsg").hide();$("#submitedFailMarketTable").show();$("#submitedSuccessMarketTable").hide();$("#marketC").hide();$("#marketFC").show();$("#marketTable").hide();$("#marketP").hide()}clearTimeout(tradeTimeOutObj)};_checkMarketSubmit=function(){if(_validateVolume("#omVolumeInput")){return true}return false};_validateMarketInvestmentIsEnough=function(b){var a=parseFloat($(b).spinner("value"));var e=parseFloat(marketAndOrderObj.investmentQuotaMin);var f=parseFloat($("#balance").html());var d=parseFloat($("#serviceChargeS").html());if(-d>f){Alert(WebUIError[10235]);return false}if(marketAndOrderObj.isInvestment){var c=parseFloat(marketAndOrderObj.positionOrder.amount);var g=a-c;if(g>f){Alert(WebUIError[10235]);return false}if(g-d>f){Confirm({content:i18n.trade.investmentValidIsEnough.format(Util.fixToStr(c+(f+d))),okValue:i18n.ok,ok:function(){$(b).val(Util.fixToStr(c+(f+d)));doSubmitMarket();return true},cancelValue:i18n.cancel,cancel:false})}else{return true}}else{if(a>f){Alert(WebUIError[10235]);return false}if(a-d>f){if(f+d<e){Alert(WebUIError[10235]);return false}else{Confirm({content:i18n.trade.investmentValidIsEnough.format(Util.fixToStr(f+d)),okValue:i18n.ok,ok:function(){$(b).val(Util.fixToStr(f+d));doSubmitMarket();return true},cancelValue:i18n.cancel,cancel:false})}}else{return true}}};_validateTransRange=function(){var b=marketAndOrderObj.officePriceDights;var a=marketAndOrderObj.pipsDigits;var d=$("#transactionRange").spinner("value");var c=_getTransactionRangeFromServer(marketAndOrderObj.maxTransactionRange,marketAndOrderObj.officePriceDights,marketAndOrderObj.pipsDigits);if(d==null||isNaN(d)||d<0||d>c){Alert(WebUIError[10105].format(0,Util.fixToStr(c,(b-a))));return false}return true};initTransactionRange=function(){var a=marketAndOrderObj.defaultTransactionRange;var b=marketAndOrderObj.maxTransactionRange;$("#transactionRange").spinner({numberFormat:"n",step:0.01,min:0,max:b});$("#transactionRange").val(parseFloat(a));$("#transactionRangeSpan").html("0-"+parseFloat(b))};refreshTransactionRange=function(b,d){var a=marketAndOrderObj.defaultTransactionRange;var c=marketAndOrderObj.maxTransactionRange;$("#"+b).spinner({numberFormat:"n",min:0,max:c});$("#"+b).val(parseFloat(a));$("#"+d).html("0-"+parseFloat(c))};_getTransactionRangeFromServer=function(c,b,a){return c*(Math.pow(10,a-b))};_getSubmitToServerTransactionRange=function(c,b,a){return c*(Math.pow(10,b-a))};_onAdjustInvestmentQuota=function(){var a=$("#adjustInvestmentQuota");if(a.is(":checked")){$("#investmentQuota").spinner("enable");$("#investmentQuotaSpan").show()}else{$("#investmentQuota").spinner("disable");$("#investmentQuotaSpan").hide()}};_changeMarketVolumeInput=function(){Util.allowNumKeyUp(document.getElementById("omVolumeInput"));calculateOMMargin($("#omVolumeInput").val())};calculateOMMargin=function(a){var b=a*getUserMargin(marketAndOrderObj.prdcode);$("#omMargin").html(Util.fixToStrTwodecimal(b))};$(function(){$("#limitPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("limitPrice"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("limitPrice"),5)});$("#limitPrice").on("keyup",function(a){Util.allowNumKeyUp(document.getElementById("limitPrice"))});$("#stopPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("stopPrice"),2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("stopPrice"),5)});$("#stopPrice").on("keyup",function(a){Util.allowNumKeyUp(document.getElementById("stopPrice"))});$("#orderVolumeInput").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("orderVolumeInput"),2)});$("#orderVolumeInput").on("keyup",function(b){Util.allowNumKeyUp(document.getElementById("orderVolumeInput"));var a=$("#orderVolumeInput").val();if(Util.isNotBlank(a)&&parseFloat(a)>parseFloat(marketAndOrderObj.maximalVolume)){$("#orderVolumeInput").val(marketAndOrderObj.maximalVolume)}else{_changeOrderVolumeForInputText()}});$("#advance_open_orderVolumeInput").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,document.getElementById("advance_open_orderVolumeInput"),2)});$("#advance_open_orderVolumeInput").on("keyup",function(b){Util.allowNumKeyUp(document.getElementById("advance_open_orderVolumeInput"));var a=$("#advance_open_orderVolumeInput").val();if(Util.isNotBlank(a)&&parseFloat(a)>parseFloat(marketAndOrderObj.maximalVolume)){$("#advance_open_orderVolumeInput").val(marketAndOrderObj.maximalVolume)}else{_changeAdvanceOrderVolumeForInputText()}});$("#modify_limitPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("modify_limitPrice"),5)});$("#modify_stopPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("modify_stopPrice"),5)});$("#modify_advance_open_limitPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("modify_advance_open_limitPrice"),5)});$("#modify_advance_open_stopPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("modify_advance_open_stopPrice"),5)});$("#modify_advance_close_limitPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("modify_advance_close_limitPrice"),5)});$("#modify_advance_close_stopPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("modify_advance_close_stopPrice"),5)});$("#advance_open_limitPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("advance_open_limitPrice"),5)});$("#advance_open_stopPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("advance_open_stopPrice"),5)});$("#advance_close_limitPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("advance_close_limitPrice"),5)});$("#advance_close_stopPrice").on("keypress",function(a){return Util.allowMaxDightsLenKeyPress(a,this,2)&&Util.allowMaxIntLenKeyPress(a,document.getElementById("advance_close_stopPrice"),5)});$("#orderVolumeSel-btn").on("click",function(){var a=$("#orderVolumeSel li");a.removeClass("sxc-lihov");a.each(function(){if($(this).attr("tv")==$("#orderVolumeInput").val()){$(this).addClass("sxc-lihov")}});$("#orderVolumeSel").toggle()});$("#advance_open_orderVolumeSel-btn").on("click",function(){var a=$("#advance_open_orderVolumeSel li");a.removeClass("sxc-lihov");a.each(function(){if($(this).attr("tv")==$("#advance_open_orderVolumeInput").val()){$(this).addClass("sxc-lihov")}});$("#advance_open_orderVolumeSel").toggle()});$("#advance_open_orderVolumeInput").on("keyup",_changeAdvanceOrderVolumeForInput);$("#orderBusiTypeSel").on("change",_changeOrderBusiType);$("#advance_open_orderBusiTypeSel").on("change",_changeAdvanceOpenOrderBusiType);$("#advance_open_limitPrice").blur(_changeAdvanceOpenOrderBusiType);$("#advance_open_stopPrice").blur(_changeAdvanceOpenOrderBusiType);$("#advance_open_limitPrice").on("keyup",_changeAdvanceOpenOrderBusiType);$("#advance_open_stopPrice").on("keyup",_changeAdvanceOpenOrderBusiType);$("#modify_advance_open_limitPrice").blur(_changeModifyAdvanceOpenOrderBusiType);$("#modify_advance_open_limitPrice").on("keyup",_changeModifyAdvanceOpenOrderBusiType);$("#modify_advance_open_stopPrice").blur(_changeModifyAdvanceOpenOrderBusiType);$("#modify_advance_open_stopPrice").on("keyup",_changeModifyAdvanceOpenOrderBusiType);$("#advance_close_orderBusiTypeSel").on("change",_changeAdvanceCloseOrderBusiType);$("#btnOrderOK").unbind("click").on("click",submitPendingOrder);$("#btnAdvanceOrderOK").unbind("click").on("click",submitAdvancePendingOrder);$("#modify_btnOrderOK").unbind("click").on("click",submitModifyPendingOrder)});initModifyAdvancePendingOrderDiv=function(a,e){$("#modify_pendingOrderTable tr[name='unadvance']").hide();$("#modify_pendingOrderTable tr[name='advance']").show();var h=a[0];var j=a[1];var u=h.optype;var k=h.limitprice;var C=h.price;var d=h.lot;var q=h.tradedir;var z=j.optype;var x=j.limitprice;var m=j.price;var r=j.validtype;var l=j.tradedir;if(u==1){open_price=k}else{if(u==2){open_price=C}}if(z==1){close_price=x}else{if(z==2){close_price=m}}$("#modify_orderBusiType").html(i18n.dynamic.advpending);var f=e.orderspread;var s=e.maxrange;var b=e.limitspread;var c=e.triggerspread;var p="---";if(u==1){p=i18n.dynamic.limitprice}else{if(u==2){p=i18n.dynamic.stop}}$("#modify_advance_open_orderBusiType").html(p);var i;var g;var D;var w;if(q==0){w=Util.fixToStrTwodecimal(e.bid)}else{if(q==1){w=Util.fixToStrTwodecimal(e.ask)}else{w="---"}}if(q==0){i=i18n.trade.tip_label_buy;g=i18n.trade.tip_label_sell;D=i18n.trade.sell;$("#modify_advance_open_limitOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(Number(w),Number(b))));$("#modify_advance_open_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(w),Number(b))));$("#modify_advance_open_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(w),Number(s))));$("#modify_advance_open_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}});$("#modify_advance_open_stopOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(Number(w),Number(c))));$("#modify_advance_open_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(w),Number(s))));$("#modify_advance_open_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(w),Number(c))));$("#modify_advance_open_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}})}else{if(q==1){i=i18n.trade.tip_label_sell;g=i18n.trade.tip_label_buy;D=i18n.trade.buy;$("#modify_advance_open_limitOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(Number(w),Number(b))));$("#modify_advance_open_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(w),Number(s))));$("#modify_advance_open_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(w),Number(b))));$("#modify_advance_open_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}});$("#modify_advance_open_stopOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(Number(w),Number(c))));$("#modify_advance_open_Stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(w),Number(c))));$("#modify_advance_open_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(w),Number(s))));$("#modify_advance_open_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}})}else{i="---"}}if(u==1){$("#modify_advance_open_pendingOrderTradedType_limitPrice").html(i);$("#modify_advance_open_limitPrice").val(Util.fixToStrTwodecimal(k));$("#modify_advance_open_pendingOrder_limitPrice").show();$("#modify_advance_open_pendingOrder_stopPrice").hide()}else{if(u==2){$("#modify_advance_open_pendingOrderTradedType_stopPrice").html(i);$("#modify_advance_open_stopPrice").val(Util.fixToStrTwodecimal(C));$("#modify_advance_open_pendingOrder_limitPrice").hide();$("#modify_advance_open_pendingOrder_stopPrice").show()}}$("#modify_advance_orderVolumeSpan").html(Util.fixToStrTwodecimal(d));var o=getUserMargin(e.prdcode);$("#modify_advance_pendingMargin").html(Util.fixToStrTwodecimal(o*d)+"&nbsp;USD");var A;if(z==1){A=i18n.dynamic.limitprice}else{if(z==2){A=i18n.dynamic.stop}else{if(z==3){A=i18n.dynamic.autoreplace}}}$("#modify_advance_close_orderBusiType").html(A);if(q==0){var v=$("#modify_advance_open_limitPrice").val();var t=$("#modify_advance_open_stopPrice").val();if(u==OrderType.BUY_LIMIT){$("#modify_advance_close_limitOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(v),Number(f)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(v),Number(s))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(v),Number(f))));$("#modify_advance_close_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}});$("#modify_advance_close_stopOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(v),Number(f)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(v),Number(f))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(v),Number(s))));$("#modify_advance_close_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}})}else{if(u==OrderType.BUY_STOP){$("#modify_advance_close_limitOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(t),Number(f)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(t),Number(s))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(t),Number(f))));$("#modify_advance_open_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}});$("#modify_advance_close_stopOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(t),Number(f)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(t),Number(s))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(t),Number(f))));$("#modify_advance_open_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}})}}}else{if(q==1){var v=$("#modify_advance_open_limitPrice").val();var t=$("#modify_advance_open_stopPrice").val();var y=getAdvancePendingOrderTypeValue("close");if(u==OrderType.BUY_LIMIT){$("#modify_advance_close_limitOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(v),Number(f)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(v),Number(f))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(v),Number(s))));$("#modify_advance_close_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}});$("#modify_advance_close_stopOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(v),Number(f)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(v),Number(s))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(v),Number(f))));$("#modify_advance_close_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}})}else{if(u==OrderType.BUY_STOP){$("#modify_advance_close_limitOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(t),Number(f)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(t),Number(f))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(t),Number(s))));$("#modify_advance_close_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}});$("#modify_advance_close_stopOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(t),Number(f)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(t),Number(s))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(t),Number(f))));$("#modify_advance_close_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(E,F){_changeModifyAdvanceOpenOrderBusiType()}})}}}}if(z==1){$("#modify_advance_close_pendingOrderTradedType_limitPrice").html(g);$("#modify_advance_close_limitPrice").val(Util.fixToStrTwodecimal(x));$("#modify_advance_close_pendingOrder_limitPrice").show();$("#modify_advance_close_pendingOrder_stopPrice").hide()}else{if(z==2){$("#modify_advance_close_pendingOrderTradedType_stopPrice").html(g);$("#modify_advance_close_stopPrice").val(Util.fixToStrTwodecimal(m));$("#modify_advance_close_pendingOrder_limitPrice").hide();$("#modify_advance_close_pendingOrder_stopPrice").show()}else{if(z==3){$("#modify_advance_close_pendingOrderTradedType_limitPrice").html(i18n.dynamic.limitprice+D+"：");$("#modify_advance_close_pendingOrderTradedType_stopPrice").html(i18n.dynamic.stop+D+"：");$("#modify_advance_close_limitPrice").val(Util.fixToStrTwodecimal(x));$("#modify_advance_close_stopPrice").val(Util.fixToStrTwodecimal(m));$("#modify_advance_close_pendingOrder_limitPrice").show();$("#modify_advance_close_pendingOrder_stopPrice").show()}}}var B;if(r==0){B=i18n.report.effectiveInDate}else{if(r==1){B=i18n.report.effectiveInWeekly}else{B="---"}}$("#modify_advance_defaultExpir").html(B)};initModifyPendingOrderDiv=function(g,e){$("#modify_pendingOrderTable tr[name='unadvance']").show();$("#modify_pendingOrderTable tr[name='advance']").hide();var b=g.prdid;var u=g.optype;var k=g.tradedir;var o=g.validtype;var d=g.lot;var l=g.limitprice;var s=g.price;var m;if(u==1){m=i18n.dynamic.limitprice}else{if(u==2){m=i18n.dynamic.stop}else{if(u==3){m=i18n.dynamic.autoreplace}}}$("#modify_orderBusiType").html(m);var f=e.orderspread;var p=e.maxrange;var a=e.limitspread;var c=e.triggerspread;var j;var q;var r;var v;var h;if(k==0){r=Util.fixToStrTwodecimal(e.bid)}else{if(k==1){r=Util.fixToStrTwodecimal(e.ask)}else{r="---"}}if(k==0){j=i18n.trade.tip_label_buy;tradeTypeNameForCoc=i18n.trade.buy;q=i18n.trade.tip_label_sell;v=Util.fixToStrTwodecimal(Util.accSub(Number(r),Number(a)));$("#modify_limitOperate").html("≤"+v);$("#modify_limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(r),Number(a))));$("#modify_limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(r),Number(p))));$("#modify_limitPrice").spinner({step:0.01,numberFormat:"n"});h=Util.fixToStrTwodecimal(Util.accAdd(Number(r),Number(c)));$("#modify_stopOperate").html("≥"+h);$("#modify_stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(r),Number(p))));$("#modify_stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(r),Number(c))));$("#modify_stopPrice").spinner({step:0.01,numberFormat:"n"})}else{if(k==1){j=i18n.trade.tip_label_sell;tradeTypeNameForCoc=i18n.trade.sell;q=i18n.trade.tip_label_buy;v=Util.fixToStrTwodecimal(Util.accAdd(Number(r),Number(a)));$("#modify_limitOperate").html("≥"+v);$("#modify_limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(r),Number(p))));$("#modify_limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(r),Number(a))));$("#modify_limitPrice").spinner({step:0.01,numberFormat:"n"});h=Util.fixToStrTwodecimal(Util.accSub(Number(r),Number(c)));$("#modify_stopOperate").html("≤"+h);$("#modify_stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(r),Number(c))));$("#modify_stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(r),Number(p))));$("#modify_stopPrice").spinner({step:0.01,numberFormat:"n"})}else{j="---"}}if(u==1){$("#modify_pendingOrderTradedType_limitPrice").html(j);$("#modify_limitPrice").val(l);$("#modify_pendingOrder_limitPrice").show();$("#modify_pendingOrder_stopPrice").hide()}else{if(u==2){$("#modify_pendingOrderTradedType_stopPrice").html(j);$("#modify_stopPrice").val(s);$("#modify_pendingOrder_limitPrice").hide();$("#modify_pendingOrder_stopPrice").show()}else{if(u==3){$("#modify_pendingOrderTradedType_limitPrice").html(i18n.dynamic.limitprice+tradeTypeNameForCoc+"：");$("#modify_pendingOrderTradedType_stopPrice").html(i18n.dynamic.stop+tradeTypeNameForCoc+"：");$("#modify_limitPrice").val(l);$("#modify_stopPrice").val(s);$("#modify_pendingOrder_limitPrice").show();$("#modify_pendingOrder_stopPrice").show()}}}$("#modify_orderVolumeSpan").html(Util.fixToStrTwodecimal(d));var i=getUserMargin(e.prdcode);$("#modify_pendingMargin").html(Util.fixToStrTwodecimal(i*d));var t;if(o==0){t=i18n.report.effectiveInDate}else{if(o==1){t=i18n.report.effectiveInWeekly}else{t="---"}}$("#modify_defaultExpir").html(t)};initPendingOrderDiv=function(a,b){_settingPendingOrderDiv(b)};_settingPendingOrderDiv=function(h){var f=marketAndOrderObj.defaultTradeType;var e;var d;if(f==0){e=i18n.trade.buy;d=i18n.trade.sell}else{if(f==1){e=i18n.trade.sell;d=i18n.trade.buy}else{e="---"}}$("#pendingOrderTradedType").html(e);$("#advance_open_pendingOrderTradedType").html(e);$("#advance_close_pendingOrderTradedType").html(d);var f=marketAndOrderObj.defaultTradeType;refreshOrInitPendingOrderPrice(f,1);refreshOrInitAdvancePendingOrderPrice(f,1);initPendingOrderSelType();_showLimitOrStopByBusiType(getPendingOrderTypeValue());_showAdvanceOpenLimitOrStopByBusiType(getPendingOrderTypeValue("open"));_showAdvanceCloseLimitOrStopByBusiType(getPendingOrderTypeValue("close"));initPendingOrderVolume();initAdvancePendingOrderVolume();var c=parseFloat($("#orderVolumeInput").val())*getUserMargin(marketAndOrderObj.prdcode);$("#pendingMargin").html(Util.fixToStrTwodecimal(c));$("#advance_open_pendingMargin").html(Util.fixToStrTwodecimal(c));var g=document.getElementsByName("radioExpir");for(var b=0;b<g.length;b++){var a=g[b];if(a.value==0){a.checked=true}}var g=document.getElementsByName("advance_radioExpir");for(var b=0;b<g.length;b++){var a=g[b];if(a.value==0){a.checked=true}}};refreshOrInitPendingOrderPrice=function(c,h){var b=Number(marketAndOrderObj.limitspread);var g=Number(marketAndOrderObj.triggerspread);var d=Number(marketAndOrderObj.maxrange);var f;if(c==0){f=Number(Util.fixToStrTwodecimal(marketAndOrderObj.buy))}else{if(c==1){f=Number(Util.fixToStrTwodecimal(marketAndOrderObj.ask))}else{f="---"}}var e;var a;if(c==0){e=Util.fixToStrTwodecimal(Util.accSub(f,b));$("#limitOperate").html("≤"+e);$("#limit_max").val(Util.fixToStrTwodecimal(Util.accSub(f,b)));$("#limit_min").val(Util.fixToStrTwodecimal(Util.accSub(f,d)));a=Util.fixToStrTwodecimal(Util.accAdd(f,g));$("#stopOperate").html("≥"+a);$("#stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(f,d)));$("#stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(f,g)))}else{if(c==1){e=Util.fixToStrTwodecimal(Util.accAdd(f,b));$("#limitOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(f,b))));$("#limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(f,d)));$("#limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(f,b)));a=Util.fixToStrTwodecimal(Util.accSub(f,g));$("#stopOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(f,g))));$("#stop_max").val(Util.fixToStrTwodecimal(Util.accSub(f,g)));$("#stop_min").val(Util.fixToStrTwodecimal(Util.accSub(f,d)))}}if(h==1){$("#limitPrice").val(e);$("#limitPrice").spinner({step:0.01,min:0,max:10000,numberFormat:"n"});$("#stopPrice").val(a);$("#stopPrice").spinner({step:0.01,min:0,max:10000,numberFormat:"n"})}};refreshOrInitAdvancePendingOrderPrice=function(b,e){var m;if(b==0){m=Util.fixToStrTwodecimal(marketAndOrderObj.buy)}else{if(b==1){m=Util.fixToStrTwodecimal(marketAndOrderObj.ask)}else{m="---"}}var f=marketAndOrderObj.orderspread;var d=marketAndOrderObj.maxrange;var l=marketAndOrderObj.limitspread;var o=marketAndOrderObj.triggerspread;var k=$("#advance_open_limitPrice").val();var a=$("#advance_open_stopPrice").val();var j;var g;var h;var c;if(b==0){j=Util.fixToStrTwodecimal(Util.accSub(Number(m),Number(l)));$("#advance_open_limitOperate").html("≤"+j);$("#advance_open_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(m),Number(l))));$("#advance_open_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(m),Number(d))));g=Util.fixToStrTwodecimal(Util.accAdd(Number(m),Number(o)));$("#advance_open_stopOperate").html("≥"+g);$("#advance_open_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(m),Number(d))));$("#advance_open_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(m),Number(o))));if(e==1){$("#advance_open_limitPrice").val(j);$("#advance_open_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(p,q){_changeAdvanceOpenOrderBusiType()}});$("#advance_open_stopPrice").val(g);$("#advance_open_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(p,q){_changeAdvanceOpenOrderBusiType()}});k=$("#advance_open_limitPrice").val();a=$("#advance_open_stopPrice").val()}var i=getAdvancePendingOrderTypeValue("open");if(i==OrderType.BUY_LIMIT){h=Util.fixToStrTwodecimal(Util.accAdd(Number(k),Number(f)));$("#advance_close_limitOperate").html("≥"+h);$("#advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(k),Number(d))));$("#advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(k),Number(f))));c=Util.fixToStrTwodecimal(Util.accSub(Number(k),Number(f)));$("#advance_close_stopOperate").html("≤"+c);$("#advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(k),Number(f))));$("#advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(k),Number(d))))}else{if(i==OrderType.BUY_STOP){h=Util.fixToStrTwodecimal(Util.accAdd(Number(a),Number(f)));$("#advance_close_limitOperate").html("≥"+h);$("#advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(a),Number(d))));$("#advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(a),Number(f))));c=Util.fixToStrTwodecimal(Util.accSub(Number(a),Number(f)));$("#advance_close_stopOperate").html("≤"+c);$("#advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(a),Number(f))));$("#advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(a),Number(d))))}}}else{if(b==1){j=Util.fixToStrTwodecimal(Util.accAdd(Number(m),Number(l)));$("#advance_open_limitOperate").html("≥"+j);$("#advance_open_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(m),Number(d))));$("#advance_open_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(m),Number(l))));g=Util.fixToStrTwodecimal(Util.accSub(Number(m),Number(o)));$("#advance_open_stopOperate").html("≤"+g);$("#advance_open_Stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(m),Number(o))));$("#advance_open_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(m),Number(d))));if(e==1){$("#advance_open_limitPrice").val(j);$("#advance_open_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(p,q){_changeAdvanceOpenOrderBusiType()}});$("#advance_open_stopPrice").val(g);$("#advance_open_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(p,q){_changeAdvanceOpenOrderBusiType()}});k=$("#advance_open_limitPrice").val();a=$("#advance_open_stopPrice").val()}var i=getAdvancePendingOrderTypeValue("open");if(i==OrderType.BUY_LIMIT){h=Util.fixToStrTwodecimal(Util.accSub(Number(k),Number(f)));$("#advance_close_limitOperate").html("≤"+h);$("#advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(k),Number(f))));$("#advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(k),Number(d))));c=Util.fixToStrTwodecimal(Util.accAdd(Number(k),Number(f)));$("#advance_close_stopOperate").html("≥"+c);$("#advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(k),Number(d))));$("#advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(k),Number(f))))}else{if(i==OrderType.BUY_STOP){h=Util.fixToStrTwodecimal(Util.accSub(Number(a),Number(f)));$("#advance_close_limitOperate").html("≤"+h);$("#advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(a),Number(f))));$("#advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(a),Number(d))));c=Util.fixToStrTwodecimal(Util.accAdd(Number(a),Number(f)));$("#advance_close_stopOperate").html("≥"+c);$("#advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(a),Number(d))));$("#advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(a),Number(f))))}}}}if(e==1){$("#advance_close_limitPrice").val(h);$("#advance_close_limitPrice").spinner({step:0.01,numberFormat:"n",spin:function(p,q){_changeAdvanceOpenOrderBusiType()}});$("#advance_close_stopPrice").val(c);$("#advance_close_stopPrice").spinner({step:0.01,numberFormat:"n",spin:function(p,q){_changeAdvanceOpenOrderBusiType()}})}};initPendingOrderSelType=function(){$("#orderBusiTypeSel").empty();$("#advance_open_orderBusiTypeSel").empty();$("#advance_close_orderBusiTypeSel").empty();var b="";b+="<option value='"+pendingOrdertype.LIMIT+"'>"+i18n.trade.limitType+"</option>";b+="<option value='"+pendingOrdertype.STOP+"'>"+i18n.trade.stopType+"</option>";b+="<option value='"+pendingOrdertype.BUY_OCO+"'>"+i18n.trade.buyOcoType+"</option>";b+="<option value='"+pendingOrdertype.ADVANCE+"'>"+i18n.dynamic.advpending+"</option>";$("#orderBusiTypeSel").append(b);var a="";a+="<option value='"+pendingOrdertype.LIMIT+"'>"+i18n.trade.limitType+"</option>";a+="<option value='"+pendingOrdertype.STOP+"'>"+i18n.trade.stopType+"</option>";$("#advance_open_orderBusiTypeSel").append(a);var c="";c+="<option value='"+pendingOrdertype.LIMIT+"'>"+i18n.trade.limitType+"</option>";c+="<option value='"+pendingOrdertype.STOP+"'>"+i18n.trade.stopType+"</option>";c+="<option value='"+pendingOrdertype.BUY_OCO+"'>"+i18n.trade.buyOcoType+"</option>";$("#advance_close_orderBusiTypeSel").append(c)};getPendingOrderTypeValue=function(){var b=$("#orderBusiTypeSel").val();var a=marketAndOrderObj.defaultTradeType;if(a==0){if(b==pendingOrdertype.LIMIT){return OrderType.BUY_LIMIT}else{if(b==pendingOrdertype.STOP){return OrderType.BUY_STOP}else{if(b==pendingOrdertype.BUY_OCO){return OrderType.BUY_OCO}else{if(b==pendingOrdertype.ADVANCE){return OrderType.BUY_advance}else{return OrderType.BUY_LIMIT}}}}}else{if(b==pendingOrdertype.LIMIT){return OrderType.SELL_LIMIT}else{if(b==pendingOrdertype.STOP){return OrderType.SELL_STOP}else{if(b==pendingOrdertype.BUY_OCO){return OrderType.SELL_OCO}else{if(b==pendingOrdertype.ADVANCE){return OrderType.SELL_advance}else{return OrderType.SELL_LIMIT}}}}}};getAdvancePendingOrderTypeValue=function(b){var c;if(b=="open"){c=$("#advance_open_orderBusiTypeSel").val()}else{if(b=="close"){c=$("#advance_close_orderBusiTypeSel").val()}else{return}}var a=marketAndOrderObj.defaultTradeType;if(a==0){if(c==pendingOrdertype.LIMIT){return OrderType.BUY_LIMIT}else{if(c==pendingOrdertype.STOP){return OrderType.BUY_STOP}else{if(c==pendingOrdertype.BUY_OCO){return OrderType.BUY_OCO}else{if(c==pendingOrdertype.ADVANCE){return OrderType.BUY_advance}else{return OrderType.BUY_LIMIT}}}}}else{if(c==pendingOrdertype.LIMIT){return OrderType.SELL_LIMIT}else{if(c==pendingOrdertype.STOP){return OrderType.SELL_STOP}else{if(c==pendingOrdertype.BUY_OCO){return OrderType.SELL_OCO}else{if(c==pendingOrdertype.ADVANCE){return OrderType.SELL_advance}else{return OrderType.SELL_LIMIT}}}}}};initPendingOrderVolume=function(){_setVolumeList("#orderVolumeSel","#orderVolumeInput","#orderVolumeRange","#orderVolumeSelSpan");var e=SystemCookie.getTradeVol(marketAndOrderObj.prdcode);if(Util.isNotBlank(e)){var c=parseFloat(Util.fixToStrTwodecimal(e));var b=parseFloat(marketAndOrderObj.minimalVolume);var a=parseFloat(marketAndOrderObj.maximalVolume);var f=Util.accMul(marketAndOrderObj.volumeStep,100);if(c<b||c>a||Util.accMul(Util.accSub(c,b),100)%f!=0){$("#orderVolumeSel").val(Util.fixToStrTwodecimal(marketAndOrderObj.minimalVolume));$("#orderVolumeInput").val(c);document.getElementsByName("defaultOrderVolumeCheckbox")[0].checked=true}else{$("#orderVolumeSel").val(Util.fixToStrTwodecimal(e));$("#orderVolumeInput").val(Util.fixToStrTwodecimal(e));document.getElementsByName("defaultOrderVolumeCheckbox")[0].checked=true}}else{var d=marketAndOrderObj.volumeLotinfo;$("#orderVolumeInput").val(Util.fixToStrTwodecimal(d[0]));$("#defaultOrderVolumeCheckbox").attr("checked",false)}};initAdvancePendingOrderVolume=function(){_setVolumeList("#advance_open_orderVolumeSel","#advance_open_orderVolumeInput","#advance_open_orderVolumeRange","#advance_open_orderVolumeSelSpan");var e=SystemCookie.getTradeVol(marketAndOrderObj.prdcode);if(Util.isNotBlank(e)){var c=parseFloat(Util.fixToStrTwodecimal(e));var b=parseFloat(marketAndOrderObj.minimalVolume);var a=parseFloat(marketAndOrderObj.maximalVolume);var f=Util.accMul(marketAndOrderObj.volumeStep,100);if(c<b||c>a||Util.accMul(Util.accSub(c,b),100)%f!=0){$("#advance_open_orderVolumeSel").val(Util.fixToStrTwodecimal(marketAndOrderObj.minimalVolume));$("#advance_open_orderVolumeInput").val(c);document.getElementsByName("defaultOrderVolumeCheckbox")[0].checked=true}else{$("#advance_open_orderVolumeSel").val(Util.fixToStrTwodecimal(e));$("#advance_open_orderVolumeInput").val(Util.fixToStrTwodecimal(e));document.getElementsByName("advance_open_defaultOrderVolumeCheckbox")[0].checked=true}}else{var d=marketAndOrderObj.volumeLotinfo;$("#advance_open_orderVolumeInput").val(Util.fixToStrTwodecimal(d[0]));$("#advance_open_defaultOrderVolumeCheckbox").attr("checked",false)}};refreshModifyAdvPendingOrderDiv=function(g){if(!$("#modify_marketAndPendingOrderDiv").dialog("isOpen")){return}var e=g.orderspread;var d=g.maxrange;var i=g.limitspread;var k=g.triggerspread;var c=pendingOrderObjModify.tradedir;var f=advPendingOrderObjModify.data[0];var b=advPendingOrderObjModify.data[1];var a=f.tradedir;var h=b.tradedir;var j;if(a==0){j=Util.fixToStrTwodecimal(g.bid)}else{if(a==1){j=Util.fixToStrTwodecimal(g.ask)}else{j="---"}}if(a==0){$("#modify_advance_open_limitOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(i))));$("#modify_advance_open_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(i))));$("#modify_advance_open_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(d))));$("#modify_advance_open_stopOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(k))));$("#modify_advance_open_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(d))));$("#modify_advance_open_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(k))))}else{if(a==1){$("#modify_advance_open_limitOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(i))));$("#modify_advance_open_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(d))));$("#modify_advance_open_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(i))));$("#modify_advance_open_stopOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(k))));$("#modify_advance_open_Stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(k))));$("#modify_advance_open_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(d))))}}};refreshModifyPendingOrderDiv=function(b){if(!$("#modify_marketAndPendingOrderDiv").dialog("isOpen")){return}var a=b.orderspread;var d=b.maxrange;var c=b.limitspread;var g=b.triggerspread;var f=pendingOrderObjModify.tradedir;var e;if(f==0){e=Util.fixToStrTwodecimal(b.bid)}else{if(f==1){e=Util.fixToStrTwodecimal(b.ask)}else{e="---"}}if(f==0){$("#modify_limitOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(Number(e),Number(c))));$("#modify_limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(e),Number(c))));$("#modify_limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(e),Number(d))));$("#modify_stopOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(Number(e),Number(g))));$("#modify_stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(e),Number(d))));$("#modify_stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(e),Number(g))))}else{if(f==1){$("#modify_limitOperate").html("≥"+Util.fixToStrTwodecimal(Util.accAdd(Number(e),Number(c))));$("#modify_limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(e),Number(d))));$("#modify_limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(e),Number(c))));$("#modify_stopOperate").html("≤"+Util.fixToStrTwodecimal(Util.accSub(Number(e),Number(g))));$("#modify_stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(e),Number(g))));$("#modify_stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(e),Number(d))))}else{tradeTypeName="---"}}};refreshPendingOrderDiv=function(b){if(!$("#marketAndPendingOrderDiv").dialog("isOpen")){return}marketAndOrderObj.setMarketAndPendingOrderData(b);var c=marketAndOrderObj.produceName;$("#marketAndPendingOrderDiv").dialog("option","title",c);var a=marketAndOrderObj.defaultTradeType;refreshOrInitPendingOrderPrice(a);refreshOrInitAdvancePendingOrderPrice(a)};refreshPendingOrderLimit=function(i){var g=marketAndOrderObj.minDistance;var b=marketAndOrderObj.maxslrange;if(i==0||i=="0"){var e=marketAndOrderObj.ask;var h=Util.fixToStrTwodecimal(Util.accSub(e,b));var c=Util.fixToStrTwodecimal(Util.accSub(e,g));$("#askLimitMin").val(h);$("#askLimitMax").val(c);$("#limitOperate").html(" ≤ "+formatLimitPrice(c))}else{var d=marketAndOrderObj.buy;var f=Util.accaccAdd(d,g);var a=Util.accaccAdd(d,b);$("#buyLimitMin").val(f);$("#buyLimitMax").val(a);$("#limitOperate").html(" ≥ "+formatLimitPrice(f))}};submitModifyPendingOrder=function(){if((pendingOrderObjModify.validflag==1||pendingOrderObjModify.validflag==2)&&advPendingOrderObjModify.data[1].validflag!=2&&typeof advPendingOrderObjModify.data[1].validflag!="undefined"){if(validateModifyAdvPendingOrderPrice()){doSubmitModifyAdvPendingOrder()}}else{if(pendingOrderObjModify.validflag==0||advPendingOrderObjModify.data[1].validflag==2||typeof advPendingOrderObjModify.data[1].validflag=="undefined"){if(validateModifyPendingOrderPrice()){doSubmitModifyPendingOrder()}}}};doSubmitModifyAdvPendingOrder=function(){_getModifyAdvancePendingOrderSuccessSubmitedData();var c=advPendingOrderObjModify.data[0];var j=advPendingOrderObjModify.data[1];var f=c.optype;var g=j.optype;var e="";var b="";if(f==1){e=$("#modify_advance_open_limitPrice").val()}else{if(f==2){b=$("#modify_advance_open_stopPrice").val()}}var h="";var i="";if(g==1){h=$("#modify_advance_close_limitPrice").val()}else{if(g==2){i=$("#modify_advance_close_stopPrice").val()}else{if(g==3){h=$("#modify_advance_close_limitPrice").val();i=$("#modify_advance_close_stopPrice").val()}}}var a=new Date().getTime();$("#modify_pendOrderSuccessMsg").hide();$("#modify_pendOrderPreSubmittingMsg").show();$("#modify_pendOrderPreSubmittingMsg").html(i18n.trade.sumitting);$("#modify_orderUID").hide();$("#modify_pendingOrderC").hide();$("#modify_submitedSuccessPendingOrderTable").show();$("#modify_submitedFailedPendingOrderTable").hide();$("#modify_pendingOrderFC").hide();$("#modify_pendingOrderTable").hide();$("#modify_pendingOrderP").hide();var d={oid:c.oid,targetoid:"",roid:c.roid,prdid:c.prdid,optype:c.optype,tradedir:c.tradedir,positiondir:c.positiondir,tradestatus:0,validtype:c.validtype,validflag:2,lot:c.lot,time:a,limitprice:Number(e),price:Number(b),range:1,tradeunit:1,ext_info:{oid:j.oid,targetoid:"",roid:j.roid,prdid:j.prdid,optype:j.optype,tradedir:j.tradedir,positiondir:j.positiondir,tradestatus:0,validtype:j.validtype,validflag:1,lot:c.lot,time:a,limitprice:Number(h),price:Number(i),range:1,tradeunit:1}};socket.emit("request",65805,d);tradeTimeOutObj=setTimeout(checkIsMoreThan60sAfterSubmit,60*1000)};doSubmitModifyPendingOrder=function(){_getModifyPendingOrderSuccessSubmitedData();var c=new Date().getTime();var b;var a;if(pendingOrderObjModify.optype==1){b=$("#modify_limitPrice").val()}else{if(pendingOrderObjModify.optype==2){a=$("#modify_stopPrice").val()}else{if(pendingOrderObjModify.optype==3){b=$("#modify_limitPrice").val();a=$("#modify_stopPrice").val()}}}$("#modify_pendOrderSuccessMsg").hide();$("#modify_pendOrderPreSubmittingMsg").show();$("#modify_pendOrderPreSubmittingMsg").html(i18n.trade.sumitting);$("#modify_orderUID").hide();$("#modify_pendingOrderC").hide();$("#modify_submitedSuccessPendingOrderTable").show();$("#modify_submitedFailedPendingOrderTable").hide();$("#modify_pendingOrderFC").hide();$("#modify_pendingOrderTable").hide();$("#modify_pendingOrderP").hide();var d={open_close:pendingOrderObjModify.positiondir,oid:pendingOrderObjModify.oid,targetoid:"",roid:"",prdid:pendingOrderObjModify.prdid,optype:pendingOrderObjModify.optype,tradedir:pendingOrderObjModify.tradedir,positiondir:pendingOrderObjModify.positiondir,tradestatus:0,validtype:pendingOrderObjModify.validtype,validflag:0,lot:pendingOrderObjModify.lot,time:c,limitprice:(isNaN(b))?0:Number(b),price:(isNaN(a))?0:Number(a),range:1,tradeunit:1};socket.emit("request",65796,d);tradeTimeOutObj=setTimeout(checkIsMoreThan60sAfterSubmit,60*1000)};submitPendingOrder=function(){if(!_checkPendingOrderSubmit()){return false}ispendingSubmit=true;doSubmitPendingOrder()};doSubmitPendingOrder=function(){marketAndOrderObj.orderSubmitStartTime=new Date().getTime();marketAndOrderObj.isSubmittingorder=true;marketAndOrderObj.isResponseorder=false;_getPendingOrderSuccessSubmitedData();var e=Util.fixToNum($("#orderVolumeInput").val());var i=marketAndOrderObj.prdcode;var h=getPrdIdByPrdCode(i);var d=marketAndOrderObj.defaultTradeType;var j=Util.getRandomSeq();marketAndOrderObj.pendingOrderSeq=j;var b=0;var f=0;var a=getPendingOrderTypeValue();if(a==OrderType.BUY_LIMIT||a==OrderType.SELL_LIMIT){b=$("#limitPrice").val()}if(a==OrderType.BUY_STOP||a==OrderType.SELL_STOP){f=$("#stopPrice").val()}if(a==OrderType.BUY_OCO||a==OrderType.SELL_OCO){b=$("#limitPrice").val();f=$("#stopPrice").val()}var g=parseInt($("input[name='radioExpir']:checked").val());$("#pendOrderSuccessMsg").hide();$("#pendOrderPreSubmittingMsg").show();$("#pendOrderPreSubmittingMsg").html(i18n.trade.sumitting);$("#orderUID").hide();$("#pendingOrderC").hide();$("#submitedSuccessPendingOrderTable").show();$("#submitedFailedPendingOrderTable").hide();$("#pendingOrderFC").hide();$("#pendingOrderTable").hide();$("#pendingOrderP").hide();disableTradeLi();marketAndOrderObj.isAllowCloseTradeWindow=false;hideCloseBtn("#marketAndPendingOrderDiv");var c={open_close:0,oid:"",targetoid:"",roid:"",tradestatus:0,validflag:0,tradeunit:0,time:marketAndOrderObj.dtime,range:0,prdid:h,optype:a,tradedir:d,positiondir:0,limitprice:Number(b),price:Number(f),validtype:g,lot:e};console.log("%o",c);socket.emit("request",65794,c);tradeTimeOutObj=setTimeout(checkIsMoreThan60sAfterSubmit,60*1000)};submitAdvancePendingOrder=function(){if(!_checkAdvancePendingOrderSubmit()){return false}doSubmitAdvancePendingOrder()};doSubmitAdvancePendingOrder=function(){marketAndOrderObj.orderSubmitStartTime=new Date().getTime();marketAndOrderObj.isSubmittingorder=true;marketAndOrderObj.isResponseorder=false;_getAdvancePendingOrderSuccessSubmitedData();var f=Util.fixToNum($("#advance_open_orderVolumeInput").val());var m=marketAndOrderObj.prdcode;var l=getPrdIdByPrdCode(m);var a=marketAndOrderObj.defaultTradeType;var b;if(a=="0"){b="1"}else{b="0"}var o=Util.getRandomSeq();marketAndOrderObj.pendingOrderSeq=o;var k=0;var e=0;var h=0;var g=0;var j=getAdvancePendingOrderTypeValue("open");if(j==OrderType.BUY_LIMIT||j==OrderType.SELL_LIMIT){k=$("#advance_open_limitPrice").val()}if(j==OrderType.BUY_STOP||j==OrderType.SELL_STOP){e=$("#advance_open_stopPrice").val()}var d=getAdvancePendingOrderTypeValue("close");if(d==OrderType.BUY_LIMIT||d==OrderType.SELL_LIMIT){h=$("#advance_close_limitPrice").val()}if(d==OrderType.BUY_STOP||d==OrderType.SELL_STOP){g=$("#advance_close_stopPrice").val()}if(d==OrderType.BUY_OCO||d==OrderType.SELL_OCO){h=$("#advance_close_limitPrice").val();g=$("#advance_close_stopPrice").val()}var i=parseInt($("input[name='advance_radioExpir']:checked").val());$("#advance_pendOrderSuccessMsg").hide();$("#advance_pendOrderPreSubmittingMsg").show();$("#advance_pendOrderPreSubmittingMsg").html(i18n.trade.sumitting);$("#advance_orderUID").hide();$("#advance_pendingOrderC").hide();$("#submitedSuccessAdvancePendingOrderTable").show();$("#submitedFailedAdvancePendingOrderTable").hide();$("#advance_pendingOrderFC").hide();$("#pendingOrderTable").hide();$("#advamcePendingOrderP").hide();disableTradeLi();marketAndOrderObj.isAllowCloseTradeWindow=false;hideCloseBtn("#marketAndPendingOrderDiv");var c={oid:"",targetoid:"",roid:"",prdid:l,optype:j,tradedir:a,positiondir:0,tradestatus:0,validtype:i,validflag:2,lot:f,time:marketAndOrderObj.dtime,limitprice:Number(k),price:Number(e),range:0,tradeunit:1,ext_info:{oid:"",targetoid:"",roid:"",prdid:l,optype:d,tradedir:b,positiondir:1,tradestatus:0,validtype:i,validflag:1,lot:f,time:marketAndOrderObj.dtime,limitprice:Number(h),price:Number(g),range:0,tradeunit:1}};socket.emit("request",65804,c);tradeTimeOutObj=setTimeout(checkIsMoreThan60sAfterSubmit,60*1000)};GTShandlePendingOrderRequestR=function(a){ispendingSubmit=false;if(!$("#marketAndPendingOrderDiv").dialog("isOpen")){return}marketAndOrderObj.isAllowCloseTradeWindow=true;showCloseBtn("#marketAndPendingOrderDiv");if(marketAndOrderObj.isResponseorder){marketAndOrderObj.isSubmittingorder=false;return}else{marketAndOrderObj.isSubmittingorder=false;marketAndOrderObj.isResponseorder=true}if(a.code==0){var b=$("#defaultOrderVolumeCheckbox");SystemCookie.setTradeVol(marketAndOrderObj.prdcode,(b.is(":checked")?Util.fixToNum($("#orderVolumeInput").val()):null));$("#orderUID").show();$("#submitedPendingOrderUIDSpan").html(Util.simpleOid(a.oid));$("#pendOrderPreSubmittingMsg").hide();$("#pendOrderSuccessMsg").show();$("#pendOrderSuccessMsg").html(i18n.trade.sumitedSuccess);$("#submitedSuccessPendingOrderTable").show();$("#pendingOrderC").show();$("#pendingOrderTable").hide();$("#pendingOrderP").hide();$("#submitedFailedPendingOrderTable").hide();$("#pendingOrderFC").hide()}else{$("#pendingOrderErrorMessage").html(WebUIError[a.code]);$("#submitedFailedPendingOrderTable").show();$("#pendOrderPreSubmittingMsg").hide();$("#pendOrderSuccessMsg").hide();$("#pendingOrderFC").show();$("#submitedSuccessPendingOrderTable").hide();$("#pendingOrderC").hide();$("#pendingOrderTable").hide();$("#pendingOrderP").hide()}clearTimeout(tradeTimeOutObj)};GTShandleModifyPendingOrderRequestR=function(b,c){if(!$("#modify_marketAndPendingOrderDiv").dialog("isOpen")){return}showCloseBtn("#modify_marketAndPendingOrderDiv");var a=Util.simpleOid(b.oid);if(b.code==0){$("#modify_submitedSuccessPendingOrderTable").show();$("#modify_pendOrderSuccessMsg").show();$("#modify_pendOrderSuccessMsg").html(i18n.trade.sumitedSuccess);$("#modify_orderUID").show();$("#modify_modifyPendingOrderUIDSpan").html(Util.simpleOid(a));$("#modify_pendingOrderC").show();$("#modify_pendingOrderTable").hide();$("#modify_pendingOrderP").hide();$("#modify_advamcePendingOrderP").hide();$("#modify_submitedFailedPendingOrderTable").hide();$("#modify_pendOrderPreSubmittingMsg").hide();$("#modify_pendingOrderFC").hide();$("#modify_submitedSuccessAdvancePendingOrderTable").hide();$("#modify_advance_pendingOrderC").hide();$("#modify_submitedFailedAdvancePendingOrderTable").hide();$("#modify_advance_pendingOrderFC").hide()}else{$("#modify_submitedFailedPendingOrderTable").show();$("#modify_pendingOrderErrorMessage").html(WebUIError[b.code]);$("#modify_pendingOrderFC").show();$("#modify_pendingOrderTable").hide();$("#modify_pendingOrderP").hide();$("#modify_advamcePendingOrderP").hide();$("#modify_submitedSuccessPendingOrderTable").hide();$("#modify_pendOrderPreSubmittingMsg").hide();$("#modify_pendingOrderC").hide();$("#modify_submitedSuccessAdvancePendingOrderTable").hide();$("#modify_advance_pendingOrderC").hide();$("#modify_submitedFailedAdvancePendingOrderTable").hide();$("#modify_advance_pendingOrderFC").hide()}clearTimeout(tradeTimeOutObj)};GTShandleModifyAdvPendingOrderRequestR=function(b,c){if(!$("#modify_marketAndPendingOrderDiv").dialog("isOpen")){return}showCloseBtn("#modify_marketAndPendingOrderDiv");var a=Util.simpleOid(c[0].oid)+"  "+Util.simpleOid(c[1].oid);if(b.code=="0"){$("#modify_submitedSuccessAdvancePendingOrderTable").show();$("#modify_advance_orderUID").show();$("#modify_submitedAdvancePendingOrderUIDSpan").html(a);$("#modify_advance_pendOrderSuccessMsg").show();$("#modify_advance_pendOrderSuccessMsg").html(i18n.trade.sumitedSuccess);$("#modify_advance_pendingOrderC").show();$("#modify_pendingOrderP").hide();$("#modify_advamcePendingOrderP").hide();$("#modify_submitedSuccessPendingOrderTable").hide();$("#modify_pendingOrderC").hide();$("#modify_submitedFailedPendingOrderTable").hide();$("#modify_pendingOrderFC").hide();$("#modify_submitedFailedAdvancePendingOrderTable").hide();$("#modify_advance_pendingOrderFC").hide()}else{$("#modify_submitedFailedAdvancePendingOrderTable").show();$("#modify_advance_pendingOrderErrorMessage").html(WebUIError[b.code]);$("#modify_advance_pendingOrderFC").show();$("#modify_pendingOrderP").hide();$("#modify_advamcePendingOrderP").hide();$("#modify_submitedSuccessPendingOrderTable").hide();$("#modify_pendingOrderC").hide();$("#modify_submitedFailedPendingOrderTable").hide();$("#modify_pendingOrderFC").hide();$("#modify_submitedSuccessAdvancePendingOrderTable").hide();$("#modify_advance_pendingOrderC").hide()}clearTimeout(tradeTimeOutObj)};GTShandleAdvancePendingOrderRequestR=function(b,c){marketAndOrderObj.isAllowCloseTradeWindow=true;showCloseBtn("#marketAndPendingOrderDiv");if(marketAndOrderObj.isResponseorder){marketAndOrderObj.isSubmittingorder=false;return}else{marketAndOrderObj.isSubmittingorder=false;marketAndOrderObj.isResponseorder=true}if(b.code==0){var d=$("#advance_open_defaultOrderVolumeCheckbox");SystemCookie.setTradeVol(marketAndOrderObj.prdcode,(d.is(":checked")?Util.fixToNum($("#advance_open_orderVolumeInput").val()):null));var a=Util.simpleOid(c[0].oid)+"  "+Util.simpleOid(c[1].oid);$("#advance_orderUID").show();$("#submitedAdvancePendingOrderUIDSpan").html(a);$("#advance_pendOrderPreSubmittingMsg").hide();$("#advance_pendOrderSuccessMsg").show();$("#advance_pendOrderSuccessMsg").html(i18n.trade.sumitedSuccess);$("#submitedSuccessAdvancePendingOrderTable").show();$("#advance_pendingOrderC").show();$("#pendingOrderTable").hide();$("#pendingOrderP").hide();$("#submitedFailedAdvancePendingOrderTable").hide();$("#advance_pendingOrderFC").hide()}else{$("#pendingOrderErrorMessage").html(WebUIError[b.code]);$("#submitedFailedPendingOrderTable").show();$("#advance_pendOrderPreSubmittingMsg").hide();$("#advance_pendOrderSuccessMsg").hide();$("#advance_pendingOrderFC").show();$("#submitedSuccessAdvancePendingOrderTable").hide();$("#advance_pendingOrderC").hide();$("#pendingOrderTable").hide();$("#pendingOrderP").hide()}clearTimeout(tradeTimeOutObj)};handlePendingOrderRequestR=function(a){if(a.seq==marketAndOrderObj.pendingOrderSeq){marketAndOrderObj.isAllowCloseTradeWindow=true;showCloseBtn("#marketAndPendingOrderDiv");if(marketAndOrderObj.isResponseorder){marketAndOrderObj.isSubmittingorder=false;return}else{marketAndOrderObj.isSubmittingorder=false;marketAndOrderObj.isResponseorder=true}if(a.ret==Constant.RET_CODE_PENDING_SUCCESS){var e=$("#defaultOrderVolumeCheckbox");SystemCookie.setTradeVol(marketAndOrderObj.prdcode,(e.is(":checked")?Util.Util.fixToNum($("#orderVolumeInput").val()):null));$("#orderUID").show();var c=getOrderUpdate4OrderId(a.order_id);$("#submitedPendingOrderUIDSpan").html(c.uid);$("#pendOrderPreSubmittingMsg").hide();$("#pendOrderSuccessMsg").show();$("#pendOrderSuccessMsg").html(i18n.trade.sumitedSuccess);$("#submitedSuccessPendingOrderTable").show();$("#pendingOrderC").show();$("#pendingOrderTable").hide();$("#pendingOrderP").hide();$("#submitedFailedPendingOrderTable").hide();$("#pendingOrderFC").hide()}else{if(a.ret==1026||a.ret=="1026"){var b=getGroupOrderlimitData();$("#pendingOrderErrorMessage").html(WebUIError[a.ret].format(b.limitOrders))}else{if(a.ret==155||a.ret=="155"){var d=getAmsSymbolConfig4Code(marketAndOrderObj.prdcode);$("#pendingOrderErrorMessage").html(WebUIError[a.ret].format(Util.fixToStrTwodecimal(d.holdlimit)))}else{$("#pendingOrderErrorMessage").html(WebUIError[a.ret])}}$("#submitedFailedPendingOrderTable").show();$("#pendOrderPreSubmittingMsg").hide();$("#pendOrderSuccessMsg").hide();$("#pendingOrderFC").show();$("#submitedSuccessPendingOrderTable").hide();$("#pendingOrderC").hide();$("#pendingOrderTable").hide();$("#pendingOrderP").hide()}}clearTimeout(tradeTimeOutObj)};_getModifyPendingOrderSuccessSubmitedData=function(){var k="",m="",f="",g,i,h;var a=$("#modify_limitPrice").val();var j=$("#modify_stopPrice").val();var p=pendingOrderObjModify.optype;var o=pendingOrderObjModify.tradedir;var l=pendingOrderObjModify.lot;var e=pendingOrderObjModify.validtype;var c=$("#modify_pendingMargin").html();if(e==0){h=i18n.report.effectiveInDate}else{if(e==1){h=i18n.report.effectiveInWeekly}else{h="---"}}$("#modify_submitedSuccessPendingOrderTable tr").not("#modify_submitedSuccessPendingOrderTr").remove();if(o==0){f=i18n.trade.tip_label_buy}else{if(o==1){f=i18n.trade.tip_label_sell}}if(p==1){i=i18n.pendingorder.limitprice}else{if(p==2){i=i18n.pendingorder.lost}else{if(p==3){i=i18n.dynamic.autoreplace}}}if(p==OrderType.BUY_LIMIT||p==OrderType.SELL_LIMIT||p==OrderType.BUY_STOP||p==OrderType.SELL_STOP){if(p==OrderType.BUY_LIMIT){m=i18n.trade.typeLimit;g=a}else{if(p==OrderType.SELL_LIMIT){m=i18n.trade.typeLimit;g=a}else{if(p==OrderType.BUY_STOP){m=i18n.trade.typeStop;g=j}else{m=i18n.trade.typeStop;g=j}}}k="<tr><td><ul class='subm-info'><li>"+m+"</li><li>"+f+Util.fixToStrTwodecimal(g)+"</li><li>"+i18n.trade.volumeTxt+Util.fixToStrTwodecimal(l)+"</li><li>"+i18n.trade.margin+c+"USD</li><li>"+i18n.trade.expirTxt+h+"</li><li id='modify_orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='modify_modifyPendingOrderUIDSpan'></span></li></ul></td></tr>";$("#modify_submitedSuccessPendingOrderTr").after(k)}else{if(p==OrderType.BUY_OCO||OrderType.SELL_OCO){var d="";var b="";if(p==OrderType.BUY_OCO){m=i18n.trade.typeBuyOco;d=i18n.trade.limitAskTxt;b=i18n.trade.stopAskTxt}else{if(p==OrderType.SELL_OCO){m=i18n.trade.typeBuyOco;d=i18n.trade.limitBuyTxt;b=i18n.trade.stopBuyTxt}}k="<tr><td><ul class='subm-info'><li>"+m+"</li><li>"+d+Util.fixToStrTwodecimal(a)+"</li><li>"+b+Util.fixToStrTwodecimal(j)+"</li><li>"+i18n.trade.volumeTxt+Util.fixToStrTwodecimal(l)+"</li><li>"+i18n.trade.margin+c+"USD</li><li>"+i18n.trade.expirTxt+h+"</li><li id='modify_orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='modify_modifyPendingOrderUIDSpan'></span></li></ul></td></tr>";$("#modify_submitedSuccessPendingOrderTr").after(k)}}};_getModifyAdvancePendingOrderSuccessSubmitedData=function(){var j="";var q=$("#modify_advance_open_limitPrice").val();var f=$("#modify_advance_open_stopPrice").val();var o="";var g=$("#modify_advance_close_limitPrice").val();var c=$("#modify_advance_close_stopPrice").val();var p=Util.fixToStrTwodecimal($("#modify_advance_orderVolumeSpan").text());var a=$("#modify_advance_pendingMargin").text();var e=advPendingOrderObjModify.data[0].optype;var b=advPendingOrderObjModify.data[1].optype;var r="";var m="";if(e==OrderType.BUY_LIMIT||e==OrderType.SELL_LIMIT||e==OrderType.BUY_STOP||e==OrderType.SELL_STOP||e==OrderType.SELL_OCO||e==OrderType.BUY_OCO){if(e==OrderType.BUY_LIMIT){r=i18n.trade.opentypeLimit;j=q}else{if(e==OrderType.SELL_LIMIT){r=i18n.trade.opentypeLimit;j=q}else{if(e==OrderType.BUY_STOP){r=i18n.trade.opentypeStop;j=f}else{if(e==OrderType.SELL_STOP){r=i18n.trade.opentypeStop;j=f}}}}}if(b==OrderType.BUY_LIMIT||b==OrderType.SELL_LIMIT||b==OrderType.BUY_STOP||b==OrderType.SELL_STOP||b==OrderType.SELL_OCO||b==OrderType.BUY_OCO){if(b==OrderType.BUY_LIMIT){m=i18n.trade.closetypeLimit;o=g}else{if(b==OrderType.SELL_LIMIT){m=i18n.trade.closetypeLimit;o=g}else{if(b==OrderType.BUY_STOP){m=i18n.trade.closetypeStop;o=c}else{if(b==OrderType.SELL_STOP){m=i18n.trade.closetypeStop;o=c}else{if(b==OrderType.SELL_OCO){m=i18n.trade.closetypeBuyOco}else{if(b==OrderType.SELL_OCO){m=i18n.trade.closetypeBuyOco}}}}}}}var l=$("#modify_advance_defaultExpir").text();$("#modify_submitedSuccessAdvancePendingOrderTable tr").not("#modify_submitedSuccessAdvancePendingOrderTr").remove();var i="";var k="";var h=advPendingOrderObjModify.data[0].tradedir;if(h==1){i=i18n.trade.tip_label_sell;k=i18n.trade.tip_label_buy}else{if(h==0){i=i18n.trade.tip_label_buy;k=i18n.trade.tip_label_sell}}var d="<tr><td><ul class='subm-info'><li>"+i18n.trade.typeBuyAdvance+"</li><li>"+r+"</li><li>"+i+j+"</li><li>"+i18n.trade.volumeTxt+p+"</li><li>"+i18n.trade.margin+a+"</li>";if(b==OrderType.BUY_LIMIT||b==OrderType.SELL_LIMIT||b==OrderType.BUY_STOP||b==OrderType.SELL_STOP){d=d+"<li>"+m+"</li><li>"+k+o+"</li>"}else{d=d+"<li>"+m+"</li><li>"+i18n.trade.closetypeLimitLabel+g+"</li><li>"+i18n.trade.closetypeStopLabel+c+"</li>"}d=d+"<li>"+i18n.trade.expirTxt+l+"</li><li id='modify_advance_orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='modify_submitedAdvancePendingOrderUIDSpan'></span></li></ul></td></tr>";$("#modify_submitedSuccessAdvancePendingOrderTr").after(d)};_getPendingOrderSuccessSubmitedData=function(){var k="",m="",g="",h;var a=$("#limitPrice").val();var j=$("#stopPrice").val();var l=Util.fixToStrTwodecimal($("#orderVolumeInput").val());var i=parseInt($("input[name='radioExpir']:checked").val())==0?i18n.trade.dayEffective:i18n.trade.weekEffective;var c=$("#pendingMargin").text();$("#submitedSuccessPendingOrderTable tr").not("#submitedSuccessPendingOrderTr").remove();var e=marketAndOrderObj.defaultTradeType;if(e==0){g=i18n.trade.tip_label_buy}else{if(e==1){g=i18n.trade.tip_label_sell}}var b=getPendingOrderTypeValue();if(b==OrderType.BUY_LIMIT||b==OrderType.SELL_LIMIT||b==OrderType.BUY_STOP||b==OrderType.SELL_STOP){if(b==OrderType.BUY_LIMIT){m=i18n.trade.typeLimit;h=a}else{if(b==OrderType.SELL_LIMIT){m=i18n.trade.typeLimit;h=a}else{if(b==OrderType.BUY_STOP){m=i18n.trade.typeStop;h=j}else{m=i18n.trade.typeStop;h=j}}}k="<tr><td><ul class='subm-info'><li>"+m+"</li><li>"+g+Util.fixToStrTwodecimal(h)+"</li><li>"+i18n.trade.volumeTxt+l+"</li><li>"+i18n.trade.margin+c+"USD</li><li>"+i18n.trade.expirTxt+i+"</li><li id='orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='submitedPendingOrderUIDSpan'></span></li></ul></td></tr>";$("#submitedSuccessPendingOrderTr").after(k)}else{if(b==OrderType.BUY_OCO||OrderType.SELL_OCO){var f="";var d="";if(e==1){m=i18n.trade.typeBuyOco;f=i18n.trade.limitAskTxt;d=i18n.trade.stopAskTxt}else{if(e==0){m=i18n.trade.typeBuyOco;f=i18n.trade.limitBuyTxt;d=i18n.trade.stopBuyTxt}}k="<tr><td><ul class='subm-info'><li>"+m+"</li><li>"+f+Util.fixToStrTwodecimal(a)+"</li><li>"+d+Util.fixToStrTwodecimal(j)+"</li><li>"+i18n.trade.volumeTxt+l+"</li><li>"+i18n.trade.margin+c+"USD</li><li>"+i18n.trade.expirTxt+i+"</li><li id='orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='submitedPendingOrderUIDSpan'></span></li></ul></td></tr>";$("#submitedSuccessPendingOrderTr").after(k)}}};_getAdvancePendingOrderSuccessSubmitedData=function(){var s="";var e=$("#advance_open_limitPrice").val();var i=$("#advance_open_stopPrice").val();var l="";var b=$("#advance_close_limitPrice").val();var m=$("#advance_close_stopPrice").val();var f=Util.fixToStrTwodecimal($("#advance_open_orderVolumeInput").val());var q=$("#advance_open_pendingMargin").text();var g=getAdvancePendingOrderTypeValue("open");var r=getAdvancePendingOrderTypeValue("close");var a="";var j="";if(g==OrderType.BUY_LIMIT||g==OrderType.SELL_LIMIT||g==OrderType.BUY_STOP||g==OrderType.SELL_STOP||g==OrderType.SELL_OCO||g==OrderType.BUY_OCO){if(g==OrderType.BUY_LIMIT){a=i18n.trade.opentypeLimit;s=e}else{if(g==OrderType.SELL_LIMIT){a=i18n.trade.opentypeLimit;s=e}else{if(g==OrderType.BUY_STOP){a=i18n.trade.opentypeStop;s=i}else{if(g==OrderType.SELL_STOP){a=i18n.trade.opentypeStop;s=i}}}}}if(r==OrderType.BUY_LIMIT||r==OrderType.SELL_LIMIT||r==OrderType.BUY_STOP||r==OrderType.SELL_STOP||r==OrderType.SELL_OCO||r==OrderType.BUY_OCO){if(r==OrderType.BUY_LIMIT){j=i18n.trade.closetypeLimit;l=b}else{if(r==OrderType.SELL_LIMIT){j=i18n.trade.closetypeLimit;l=b}else{if(r==OrderType.BUY_STOP){j=i18n.trade.closetypeStop;l=m}else{if(r==OrderType.SELL_STOP){j=i18n.trade.closetypeStop;l=m}else{if(r==OrderType.SELL_OCO){j=i18n.trade.closetypeBuyOco}else{if(r==OrderType.SELL_OCO){j=i18n.trade.closetypeBuyOco}}}}}}}var d=parseInt($("input[name='advance_radioExpir']:checked").val())==0?i18n.trade.dayEffective:i18n.trade.weekEffective;$("#submitedSuccessAdvancePendingOrderTable tr").not("#submitedSuccessAdvancePendingOrderTr").remove();var o="";var c="";var k="";var p=marketAndOrderObj.defaultTradeType;if(p==0){o=i18n.trade.tip_label_buy;c=i18n.trade.tip_label_sell;k=i18n.trade.sell}else{if(p==1){o=i18n.trade.tip_label_sell;c=i18n.trade.tip_label_buy;k=i18n.trade.buy}}var h="<tr><td><ul class='subm-info'><li>"+i18n.trade.typeBuyAdvance+"</li><li>"+a+"</li><li>"+o+s+"</li><li>"+i18n.trade.volumeTxt+f+"</li><li>"+i18n.trade.margin+q+"USD</li>";if(r==OrderType.BUY_LIMIT||r==OrderType.SELL_LIMIT||r==OrderType.BUY_STOP||r==OrderType.SELL_STOP){h=h+"<li>"+j+"</li><li>"+c+l+"</li>"}else{h=h+"<li>"+j+"</li><li>"+i18n.trade.limitType+k+"："+b+"</li><li>"+i18n.trade.stopType+k+"："+m+"</li>"}h=h+"<li>"+i18n.trade.expirTxt+d+"</li><li id='advance_orderUID' style='display:none'>"+i18n.trade.pendingOrderNoTxt+"<span id='submitedAdvancePendingOrderUIDSpan'></span></li></ul></td></tr>";$("#submitedSuccessAdvancePendingOrderTr").after(h)};_checkPendingOrderSubmit=function(){var a=false;a=validatePendingOrderPrice();if(a){return _validateVolume("#orderVolumeInput")}return false};validatePendingOrderPrice=function(){var c=parseFloat($("#limitPrice").val());var o=parseFloat($("#limit_max").val());var g=parseFloat($("#limit_min").val());var h=parseFloat($("#stopPrice").val());var f=parseFloat($("#stop_max").val());var b=parseFloat($("#stop_min").val());var a=getPendingOrderTypeValue();var i=QuotationGTS.getSymbolArrayByPrdcode(marketAndOrderObj.prdcode);var j=i.limitspread;var m=i.triggerspread;var e=i.maxrange;var l=/XX/g;var d=/YY/g;var k=marketAndOrderObj.defaultTradeType;if(k==0){if((a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10112].replace(l,e));return false}if(c<g){Alert(WebUIError[10112].replace(l,e));return false}if(c>o){Alert(WebUIError[10110].replace(l,j).replace(d,m));return false}if(isNaN(h)){Alert(WebUIError[10110].replace(l,j).replace(d,m));return false}if(h<b){Alert(WebUIError[10110].replace(l,j).replace(d,m));return false}if(h>f){Alert(WebUIError[10112].replace(l,e));return false}}if((a==OrderType.BUY_LIMIT)||(a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10112].replace(l,e));return false}if(c<g){Alert(WebUIError[10112].replace(l,e));return false}if(c>o){Alert(WebUIError[10106].replace(l,j));return false}}if((a==OrderType.BUY_STOP)||(a==OrderType.BUY_OCO)){if(isNaN(h)){Alert(WebUIError[10108].replace(l,m));return false}if(h<b){Alert(WebUIError[10108].replace(l,m));return false}if(h>f){Alert(WebUIError[10112].replace(l,e));return false}}}if(k==1){if((a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}if(c<g){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}if(c>o){Alert(WebUIError[10112].replace(l,e));return false}if(isNaN(h)){Alert(WebUIError[10112].replace(l,e));return false}if(h<b){Alert(WebUIError[10112].replace(l,e));return false}if(h>f){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}}if((a==OrderType.BUY_LIMIT)||(a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10107].replace(l,m));return false}if(c<g){Alert(WebUIError[10107].replace(l,m));return false}if(c>o){Alert(WebUIError[10112].replace(l,e));return false}}if((a==OrderType.BUY_STOP)||(a==OrderType.BUY_OCO)){if(isNaN(h)){Alert(WebUIError[10112].replace(l,e));return false}if(h<b){Alert(WebUIError[10112].replace(l,e));return false}if(h>f){Alert(WebUIError[10109].replace(l,m));return false}}}return true};validateModifyPendingOrderPrice=function(){var c=parseFloat($("#modify_limitPrice").val());var o=parseFloat($("#modify_limit_max").val());var g=parseFloat($("#modify_limit_min").val());var h=parseFloat($("#modify_stopPrice").val());var f=parseFloat($("#modify_stop_max").val());var b=parseFloat($("#modify_stop_min").val());var a=pendingOrderObjModify.optype;var i=QuotationGTS.getSymbolArrayByPrdcode(pendingOrderObjModify.prdcode);var j=i.limitspread;var m=i.triggerspread;var e=i.maxrange;var l=/XX/g;var d=/YY/g;var k=pendingOrderObjModify.tradedir;if(k==0){if((a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10112].replace(l,e));return false}if(c<g){Alert(WebUIError[10112].replace(l,e));return false}if(c>o){Alert(WebUIError[10110].replace(l,j).replace(d,m));return false}if(isNaN(h)){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}if(h<b){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}if(h>f){Alert(WebUIError[10112].replace(l,e));return false}}if((a==OrderType.BUY_LIMIT)||(a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10112].replace(l,e));return false}if(c<g){Alert(WebUIError[10112].replace(l,e));return false}if(c>o){Alert(WebUIError[10106].replace(l,j));return false}}if((a==OrderType.BUY_STOP)||(a==OrderType.BUY_OCO)){if(isNaN(h)){Alert(WebUIError[10108].replace(l,m));return false}if(h<b){Alert(WebUIError[10108].replace(l,m));return false}if(h>f){Alert(WebUIError[10112].replace(l,e));return false}}}if(k==1){if((a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}if(c<g){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}if(c>o){Alert(WebUIError[10112].replace(l,e));return false}if(isNaN(h)){Alert(WebUIError[10112].replace(l,e));return false}if(h<b){Alert(WebUIError[10112].replace(l,e));return false}if(h>f){Alert(WebUIError[10111].replace(l,j).replace(d,m));return false}}if((a==OrderType.BUY_LIMIT)||(a==OrderType.BUY_OCO)){if(isNaN(c)){Alert(WebUIError[10107].replace(l,j));return false}if(c<g){Alert(WebUIError[10107].replace(l,j));return false}if(c>o){Alert(WebUIError[10112].replace(l,e));return false}}if((a==OrderType.BUY_STOP)||(a==OrderType.BUY_OCO)){if(isNaN(h)){Alert(WebUIError[10112].replace(l,e));return false}if(h<b){Alert(WebUIError[10112].replace(l,e));return false}if(h>f){Alert(WebUIError[10109].replace(l,m));return false}}}return true};validateModifyAdvPendingOrderPrice=function(){var f=advPendingOrderObjModify.data[0];var p=advPendingOrderObjModify.data[1];var q=parseFloat($("#modify_advance_open_limitPrice").val());var m=parseFloat($("#modify_advance_open_Limit_max").val());var j=parseFloat($("#modify_advance_open_Limit_min").val());var o=parseFloat($("#modify_advance_open_stopPrice").val());var k=parseFloat($("#modify_advance_open_Stop_max").val());var i=parseFloat($("#modify_advance_open_Stop_min").val());var s=parseFloat($("#modify_advance_close_limitPrice").val());var v=parseFloat($("#modify_advance_close_Limit_max").val());var r=parseFloat($("#modify_advance_close_Limit_min").val());var u=parseFloat($("#modify_advance_close_stopPrice").val());var g=parseFloat($("#modify_advance_close_Stop_max").val());var e=parseFloat($("#modify_advance_close_Stop_min").val());var h=f.optype;var x=f.tradedir;var d=QuotationGTS.getSymbolArrayByPrdcode(f.prdcode);var a=d.limitspread;var c=d.triggerspread;var b=d.orderspread;var l=d.maxrange;var t=/XX/g;if(x==0){if((h==OrderType.BUY_LIMIT)){if(isNaN(q)){Alert(WebUIError[10112].replace(t,l));return false}if(q<j){Alert(WebUIError[10112].replace(t,l));return false}if(q>m){Alert(WebUIError[10106].replace(t,a));return false}}if((h==OrderType.BUY_STOP)){if(isNaN(o)){Alert(WebUIError[10108].replace(t,c));return false}if(o<i){Alert(WebUIError[10108].replace(t,c));return false}if(o>k){Alert(WebUIError[10112].replace(t,l));return false}}}else{if((h==OrderType.SELL_LIMIT)){if(isNaN(q)){Alert(WebUIError[10107].replace(t,a));return false}if(q<j){Alert(WebUIError[10107].replace(t,a));return false}if(q>m){Alert(WebUIError[10112].replace(t,l));return false}}if((h==OrderType.SELL_STOP)){if(isNaN(o)){Alert(WebUIError[10112].replace(t,l));return false}if(o<i){Alert(WebUIError[10112].replace(t,l));return false}if(o>k){Alert(WebUIError[10109].replace(t,c));return false}}}var w=p.optype;if(x==1){if((w==OrderType.BUY_LIMIT)||(w==OrderType.BUY_OCO)){if(isNaN(s)){Alert(WebUIError[10123].replace(t,b));return false}if(s<r){Alert(WebUIError[10123].replace(t,b));return false}if(s>v){Alert(WebUIError[10122].replace(t,l));return false}}if((w==OrderType.BUY_STOP)||(w==OrderType.BUY_OCO)){if(isNaN(u)){Alert(WebUIError[10122].replace(t,l));return false}if(u<e){Alert(WebUIError[10122].replace(t,l));return false}if(u>g){Alert(WebUIError[10123].replace(t,b));return false}}}if(x==0){if((w==OrderType.SELL_LIMIT)||(w==OrderType.SELL_OCO)){if(isNaN(s)){Alert(WebUIError[10122].replace(t,b));return false}if(s<r){Alert(WebUIError[10122].replace(t,b));return false}if(s>v){Alert(WebUIError[10123].replace(t,l));return false}}if((w==OrderType.SELL_STOP)||(w==OrderType.SELL_OCO)){if(isNaN(u)){Alert(WebUIError[10123].replace(t,l));return false}if(u<e){Alert(WebUIError[10123].replace(t,l));return false}if(u>g){Alert(WebUIError[10122].replace(t,b));return false}}}return true};_checkAdvancePendingOrderSubmit=function(){var a=false;a=validateAdvPendingOrderPrice();if(a){return _validateVolume("#advance_open_orderVolumeInput")}return a};validateAdvPendingOrderPrice=function(){var o=parseFloat($("#advance_open_limitPrice").val());var l=parseFloat($("#advance_open_Limit_max").val());var i=parseFloat($("#advance_open_Limit_min").val());var m=parseFloat($("#advance_open_stopPrice").val());var j=parseFloat($("#advance_open_Stop_max").val());var h=parseFloat($("#advance_open_Stop_min").val());var q=parseFloat($("#advance_close_limitPrice").val());var t=parseFloat($("#advance_close_Limit_max").val());var p=parseFloat($("#advance_close_Limit_min").val());var s=parseFloat($("#advance_close_stopPrice").val());var f=parseFloat($("#advance_close_Stop_max").val());var e=parseFloat($("#advance_close_Stop_min").val());var g=getAdvancePendingOrderTypeValue("open");var c=QuotationGTS.getSymbolArrayByPrdcode(marketAndOrderObj.prdcode);var d=c.orderspread;var a=c.limitspread;var b=c.triggerspread;var k=c.maxrange;var r=/XX/g;var v=marketAndOrderObj.defaultTradeType;if(v==0){if((g==OrderType.BUY_LIMIT)){if(isNaN(o)){Alert(WebUIError[10112].replace(r,k));return false}if(o<i){Alert(WebUIError[10112].replace(r,k));return false}if(o>l){Alert(WebUIError[10106].replace(r,a));return false}}if((g==OrderType.BUY_STOP)){if(isNaN(m)){Alert(WebUIError[10108].replace(r,b));return false}if(m<h){Alert(WebUIError[10108].replace(r,b));return false}if(m>j){Alert(WebUIError[10112].replace(r,k));return false}}}else{if((g==OrderType.SELL_LIMIT)){if(isNaN(o)){Alert(WebUIError[10107].replace(r,a));return false}if(o<i){Alert(WebUIError[10107].replace(r,a));return false}if(o>l){Alert(WebUIError[10112].replace(r,k));return false}}if((g==OrderType.SELL_STOP)){if(isNaN(m)){Alert(WebUIError[10112].replace(r,k));return false}if(m<h){Alert(WebUIError[10112].replace(r,k));return false}if(m>j){Alert(WebUIError[10109].replace(r,b));return false}}}var u=getAdvancePendingOrderTypeValue("close");if(v==1){if((u==OrderType.BUY_LIMIT)||(u==OrderType.BUY_OCO)){if(isNaN(q)){Alert(WebUIError[10123].replace(r,k));return false}if(q<p){Alert(WebUIError[10123].replace(r,k));return false}if(q>t){Alert(WebUIError[10122].replace(r,d));return false}}if((u==OrderType.BUY_STOP)||(u==OrderType.BUY_OCO)){if(isNaN(s)){Alert(WebUIError[10122].replace(r,d));return false}if(s<e){Alert(WebUIError[10122].replace(r,d));return false}if(s>f){Alert(WebUIError[10123].replace(r,k));return false}}}if(v==0){if((u==OrderType.SELL_LIMIT)||(u==OrderType.SELL_OCO)){if(isNaN(q)){Alert(WebUIError[10122].replace(r,d));return false}if(q<p){Alert(WebUIError[10122].replace(r,d));return false}if(q>t){Alert(WebUIError[10123].replace(r,k));return false}}if((u==OrderType.SELL_STOP)||(u==OrderType.SELL_OCO)){if(isNaN(s)){Alert(WebUIError[10123].replace(r,k));return false}if(s<e){Alert(WebUIError[10123].replace(r,k));return false}if(s>f){Alert(WebUIError[10122].replace(r,d));return false}}}return true};_changeOrderBusiType=function(){_showLimitOrStopByBusiType(getPendingOrderTypeValue())};_changeAdvanceOpenOrderBusiType=function(){_showAdvanceOpenLimitOrStopByBusiType(getAdvancePendingOrderTypeValue("open"))};_changeAdvanceCloseOrderBusiType=function(){_showAdvanceCloseLimitOrStopByBusiType(getAdvancePendingOrderTypeValue("close"))};_changeModifyAdvanceOpenOrderBusiType=function(){var h=advPendingOrderObjModify.data[0];var b=advPendingOrderObjModify.data[1];var e=h.prdid;var i;if(e=="0"){i=Tick.gold.symbol}else{if(e=="1"){i=Tick.silver.symbol}}var g=i.orderspread;var f=i.maxrange;var l=i.limitspread;var m=i.triggerspread;var k=b.tradedir;var a=h.optype;if(k==0){var j=$("#modify_advance_open_limitPrice").val();var d=$("#modify_advance_open_stopPrice").val();if(a==OrderType.BUY_LIMIT){$("#modify_advance_close_limitOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(g)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(g))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(f))));$("#modify_advance_close_stopOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(g)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(f))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(g))))}else{if(a==OrderType.BUY_STOP){$("#modify_advance_close_limitOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(d),Number(g)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(d),Number(g))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(d),Number(f))));$("#modify_advance_close_stopOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(d),Number(g)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(d),Number(f))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(d),Number(g))))}}}else{if(k==1){var j=$("#modify_advance_open_limitPrice").val();var d=$("#modify_advance_open_stopPrice").val();var c=getAdvancePendingOrderTypeValue("close");if(a==OrderType.BUY_LIMIT){$("#modify_advance_close_limitOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(g)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(f))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accAdd(Number(j),Number(g))));$("#modify_advance_close_stopOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(g)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(g))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(j),Number(f))))}else{if(a==OrderType.BUY_STOP){$("#modify_advance_close_limitOperate").html("≥"+(Util.fixToStrTwodecimal(Util.accAdd(Number(d),Number(g)))));$("#modify_advance_close_Limit_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(d),Number(f))));$("#modify_advance_close_Limit_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(d),Number(g))));$("#modify_advance_close_stopOperate").html("≤"+(Util.fixToStrTwodecimal(Util.accSub(Number(d),Number(g)))));$("#modify_advance_close_Stop_max").val(Util.fixToStrTwodecimal(Util.accAdd(Number(d),Number(f))));$("#modify_advance_close_Stop_min").val(Util.fixToStrTwodecimal(Util.accSub(Number(d),Number(g))))}}}}};_showAdvanceOpenLimitOrStopByBusiType=function(b){if(b==OrderType.BUY_LIMIT||b==OrderType.SELL_LIMIT){$("#advance_open_limitPrice").attr("disabled",false);$("#advance_open_stopPrice").attr("disabled",true);$("#advance_open_limitPrice").spinner("enable");$("#advance_open_stopPrice").spinner("disable")}if(b==OrderType.BUY_STOP||b==OrderType.SELL_STOP){$("#advance_open_limitPrice").attr("disabled",true);$("#advance_open_stopPrice").attr("disabled",false);$("#advance_open_limitPrice").spinner("disable");$("#advance_open_stopPrice").spinner("enable")}var a=marketAndOrderObj.defaultTradeType;refreshOrInitPendingOrderPrice(a);refreshOrInitAdvancePendingOrderPrice(a)};_showAdvanceCloseLimitOrStopByBusiType=function(b){if(b==OrderType.BUY_LIMIT||b==OrderType.SELL_LIMIT){$("#advance_close_limitPrice").attr("disabled",false);$("#advance_close_stopPrice").attr("disabled",true);$("#advance_close_limitPrice").spinner("enable");$("#advance_close_stopPrice").spinner("disable")}if(b==OrderType.BUY_STOP||b==OrderType.SELL_STOP){$("#advance_close_limitPrice").attr("disabled",true);$("#advance_close_stopPrice").attr("disabled",false);$("#advance_close_limitPrice").spinner("disable");$("#advance_close_stopPrice").spinner("enable")}if(b==OrderType.BUY_OCO||b==OrderType.SELL_OCO){$("#advance_close_limitPrice").attr("disabled",false);$("#advance_close_stopPrice").attr("disabled",false);$("#advance_close_limitPrice").spinner("enable");$("#advance_close_stopPrice").spinner("enable")}var a=marketAndOrderObj.defaultTradeType};_showLimitOrStopByBusiType=function(a){if(a==OrderType.BUY_LIMIT||a==OrderType.SELL_LIMIT){$("#pendingOrderTable tr[name='unadvance']").show();$("#pendingOrderTable tr[name='advance']").hide();$("#limitPrice").attr("disabled",false);$("#limitPrice").spinner("enable");$("#stopPrice").attr("disabled",true);$("#stopPrice").spinner("disable");$("#pendingOrderP").show();$("#advamcePendingOrderP").hide()}if(a==OrderType.BUY_STOP||a==OrderType.SELL_STOP){$("#pendingOrderTable tr[name='unadvance']").show();$("#pendingOrderTable tr[name='advance']").hide();$("#limitPrice").attr("disabled",true);$("#limitPrice").spinner("disable");$("#stopPrice").attr("disabled",false);$("#stopPrice").spinner("enable");$("#pendingOrderP").show();$("#advamcePendingOrderP").hide()}if(a==OrderType.BUY_OCO||a==OrderType.SELL_OCO){$("#pendingOrderTable tr[name='unadvance']").show();$("#pendingOrderTable tr[name='advance']").hide();$("#limitPrice").attr("disabled",false);$("#limitPrice").spinner("enable");$("#stopPrice").attr("disabled",false);$("#stopPrice").spinner("enable");$("#pendingOrderP").show();$("#advamcePendingOrderP").hide()}if(a==OrderType.BUY_advance||a==OrderType.SELL_advance){$("#pendingOrderTable tr[name='unadvance']").hide();$("#pendingOrderTable tr[name='advance']").show();$("#pendingOrderP").hide();$("#advamcePendingOrderP").show()}};_changeOrderVolumeForInputText=function(){calculatePendingMargin($("#orderVolumeInput").val(),"pendingMargin")};_changeAdvanceOrderVolumeForInputText=function(){calculatePendingMargin($("#advance_open_orderVolumeInput").val(),"advance_open_pendingMargin")};calculatePendingMargin=function(a,c){var b=a*getUserMargin(marketAndOrderObj.prdcode);$("#"+c).html(Util.fixToStrTwodecimal(b))};_changeAdvanceOrderVolumeForInput=function(){Util.allowNumKeyUp(document.getElementById("advance_open_orderVolumeInput"));var a=$("#advance_open_orderVolumeInput").val();if(Util.isNotBlank(a)&&parseFloat(a)>parseFloat(marketAndOrderObj.maximalVolume)){$("#advance_open_orderVolumeInput").val(marketAndOrderObj.maximalVolume)}};calculateAdvancePendingMargin=function(b){var a=b*getUserMargin(marketAndOrderObj.prdcode);$("#advance_open_pendingMargin").html(Util.fixToStrTwodecimal(a))};formatLimitPrice=function(a){return Util.fixToStrTwodecimal(a)};formatStopPrice=function(a){return Util.fixToStrTwodecimal(a)};cancelPendingOrderConfirmDialog=function(a,c,b){$("#cancelorder_confirm_tips").html(i18n.confirmCancelCurrentOrder);$("#cancelorder_confirm").dialog();$("#cancelorder_confirm").dialog({title:((b==0)?i18n.llg:i18n.lls)+"-"+Util.simpleOid(c)});$(".ui-dialog-titlebar-close",$("#cancelorder_confirm").parent()).hide();$("#cancelorder_confirm_btn_yes").unbind("click");$("#cancelorder_confirm_btn_no").unbind("click");$("#cancelorder_confirm_btn_yes").on("click",function(){$("#cancelorder_confirm").dialog("close");a()});$("#cancelorder_confirm_btn_no").on("click",function(){$("#cancelorder_confirm").dialog("close")})};cancelPendingOrder=function(b,a,d){var c=function(){var f=new Date().getTime();var g=function(h){var i={open_close:h.positiondir,oid:h.oid,targetoid:"",roid:h.roid,prdid:h.prdid,optype:h.optype,tradedir:h.tradedir,positiondir:h.positiondir,tradestatus:0,validtype:h.validtype,validflag:h.validflag,lot:h.lot=="undefined"?"":h.lot,time:f,limitprice:h.limitprice,price:h.price,range:1,tradeunit:1};socket.listeners.$listenEvent(Constant.CMD_CANCEL_ORDER,i,"CancelOrderRet",function(j,k){if(d!=null&&typeof a=="undefined"){if(j.oid==h.oid){d();return true}return false}return true})};if(!a||typeof a=="undefined"){g(b)}else{for(var e in a){g(a[e])}}};cancelPendingOrderConfirmDialog(c,b.oid,b.prdid)};cancelPendingOrdersRequest=function(b,e){for(var a=0;a<b.length;a++){var d=b[a];c(d)}e();function c(f){var g=new Date().getTime();var h={open_close:f.positiondir,oid:f.oid,targetoid:"",roid:f.roid,prdid:f.prdid,optype:f.optype,tradedir:f.tradedir,positiondir:f.positiondir,tradestatus:0,validtype:f.validtype,validflag:f.validflag,lot:f.lot=="undefined"?"":f.lot,time:g,limitprice:f.limitprice,price:f.price,range:1,tradeunit:1};socket.listeners.$listenEvent(Constant.CMD_CANCEL_ORDER,h,"CancelOrderRet")}};